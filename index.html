<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bleachers & Seats - Operations Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #f8f9fa;
            color: #212529;
        }

        /* Login Screen */
        .login-screen {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .login-card {
            background: white;
            padding: 48px;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 440px;
        }

        .login-logo {
            width: 180px;
            height: 180px;
            margin: 0 auto 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .login-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 16px;
        }

        .login-title {
            text-align: center;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
            display: none; /* Hidden - using logo image instead */
        }

        .login-subtitle {
            text-align: center;
            color: #6c757d;
            margin-bottom: 32px;
        }

        .demo-accounts {
            background: #e7f3ff;
            padding: 16px;
            border-radius: 8px;
            margin-top: 24px;
            font-size: 13px;
        }

        .demo-accounts strong {
            display: block;
            margin-bottom: 8px;
            color: #0066cc;
        }

        .demo-accounts div {
            margin: 4px 0;
            color: #495057;
        }

        /* App Layout */
        .app-layout {
            display: flex;
            height: 100vh;
        }

        .sidebar {
            width: 240px;
            min-width: 240px;
            background: #2d3748;
            color: white;
            display: flex;
            flex-direction: column;
            transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1), min-width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }

        .sidebar.collapsed {
            width: 64px;
            min-width: 64px;
        }

        .sidebar-header {
            padding: 16px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            gap: 12px;
            height: 64px;
            cursor: pointer;
            position: relative;
            flex-shrink: 0;
        }

        .sidebar-header:hover {
            background: rgba(255,255,255,0.05);
        }

        .sidebar-logo-icon {
            width: 36px;
            height: 36px;
            min-width: 36px;
            object-fit: contain;
            border-radius: 6px;
            transition: opacity 0.2s ease, transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0;
            position: absolute;
        }

        .sidebar.collapsed .sidebar-logo-icon {
            opacity: 1;
            transform: rotate(360deg);
        }

        .sidebar-logo-full {
            flex: 1;
            min-width: 0;
            object-fit: contain;
            opacity: 1;
            transition: opacity 0.25s ease;
        }

        .sidebar.collapsed .sidebar-logo-full {
            opacity: 0;
            pointer-events: none;
        }

        .sidebar-close-btn {
            margin-left: auto;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            color: rgba(255,255,255,0.4);
            font-size: 16px;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .sidebar-close-btn:hover {
            color: white;
            background: rgba(255,255,255,0.1);
        }

        .sidebar.collapsed .sidebar-close-btn {
            opacity: 0;
            pointer-events: none;
            width: 0;
            overflow: hidden;
        }

        .sidebar-brand {
            font-size: 18px;
            font-weight: 700;
            color: white;
        }

        .sidebar-logo {
            width: 36px;
            height: 36px;
            object-fit: contain;
            border-radius: 6px;
        }

        .sidebar-nav {
            flex: 1;
            padding: 16px 0;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .nav-item {
            padding: 12px 20px;
            color: rgba(255,255,255,0.7);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 14px;
            white-space: nowrap;
        }

        .sidebar.collapsed .nav-item {
            padding: 12px 0;
            justify-content: center;
        }

        .sidebar.collapsed .nav-item span:last-child {
            display: none;
        }

        .nav-item:hover {
            background: rgba(255,255,255,0.05);
            color: white;
        }

        .nav-item.active {
            background: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
            border-left: 3px solid #4CAF50;
        }

        .sidebar.collapsed .nav-item.active {
            border-left: none;
            border-bottom: 2px solid #4CAF50;
        }

        /* Hide divider label when collapsed */
        .sidebar.collapsed .sidebar-divider span {
            display: none;
        }

        .sidebar-footer {
            padding: 16px 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
            flex-shrink: 0;
            overflow: hidden;
        }

        .sidebar.collapsed .sidebar-footer {
            padding: 12px 8px;
        }

        .sidebar.collapsed .sidebar-footer .user-info > div:last-child {
            display: none;
        }

        .sidebar.collapsed .sidebar-footer .user-info {
            justify-content: center;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px;
            border-radius: 8px;
            cursor: pointer;
        }

        .user-info:hover {
            background: rgba(255,255,255,0.05);
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            background: #4CAF50;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .topbar {
            height: 64px;
            background: white;
            border-bottom: 1px solid #e9ecef;
            padding: 0 32px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .search-box {
            flex: 1;
            max-width: 500px;
        }

        .search-input {
            width: 100%;
            padding: 10px 16px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
        }

        .topbar-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .notification-badge {
            position: relative;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 8px;
            transition: background 0.2s;
        }

        .notification-badge:hover {
            background: #f8f9fa;
        }

        .notification-dot {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 8px;
            height: 8px;
            background: #dc3545;
            border-radius: 50%;
        }

        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 32px;
        }

        .page-header {
            margin-bottom: 32px;
        }

        .page-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .page-subtitle {
            color: #6c757d;
            font-size: 14px;
        }

        /* Alert Boxes */
        .alert-box {
            padding: 16px 20px;
            border-radius: 8px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 14px;
        }

        .alert-warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            color: #856404;
        }

        .alert-danger {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            color: #721c24;
        }

        .alert-info {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            color: #0c5460;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: all 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
        }

        .stat-label {
            font-size: 13px;
            color: #6c757d;
            margin-bottom: 8px;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #212529;
        }

        .stat-subtitle {
            font-size: 13px;
            color: #6c757d;
            margin-top: 4px;
        }

        /* Colored Stat Cards */
        .stat-card.green {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
        }

        .stat-card.green .stat-label,
        .stat-card.green .stat-value,
        .stat-card.green .stat-subtitle {
            color: white;
        }

        .stat-card.blue {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
        }

        .stat-card.blue .stat-label,
        .stat-card.blue .stat-value,
        .stat-card.blue .stat-subtitle {
            color: white;
        }

        .stat-card.purple {
            background: linear-gradient(135deg, #9C27B0, #7B1FA2);
            color: white;
        }

        .stat-card.purple .stat-label,
        .stat-card.purple .stat-value,
        .stat-card.purple .stat-subtitle {
            color: white;
        }

        .stat-card.orange {
            background: linear-gradient(135deg, #FF9800, #F57C00);
            color: white;
        }

        .stat-card.orange .stat-label,
        .stat-card.orange .stat-value,
        .stat-card.orange .stat-subtitle {
            color: white;
        }

        /* Pipeline Status */
        .pipeline-status {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 32px;
        }

        .status-box {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .status-count {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .status-label {
            font-size: 13px;
            color: #6c757d;
            text-transform: uppercase;
            font-weight: 600;
        }

        .status-box.review { background: #fff3e0; color: #e65100; }
        .status-box.ordering { background: #f3e5f5; color: #6a1b9a; }
        .status-box.scheduled { background: #e3f2fd; color: #0d47a1; }
        .status-box.progress { background: #e8f5e9; color: #2e7d32; }

        /* Card */
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 24px;
        }

        .card-header {
            padding: 20px 24px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-title {
            font-size: 18px;
            font-weight: 700;
        }

        .card-body {
            padding: 24px;
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #5a6268;
        }

        .btn-outline {
            background: white;
            color: #4CAF50;
            border: 2px solid #4CAF50;
        }

        .btn-outline:hover:not(:disabled) {
            background: #4CAF50;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-lg {
            padding: 14px 28px;
            font-size: 16px;
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            gap: 12px;
            margin-bottom: 32px;
        }

        /* Table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table thead {
            background: #f8f9fa;
        }

        .data-table th {
            padding: 12px;
            text-align: left;
            font-size: 12px;
            font-weight: 700;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .data-table td {
            padding: 16px 12px;
            border-top: 1px solid #e9ecef;
            font-size: 14px;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        .badge-info {
            background: #d1ecf1;
            color: #0c5460;
        }

        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .badge-pending {
            background: #fff3cd;
            color: #856404;
        }

        /* Form */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: #495057;
            margin-bottom: 8px;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ced4da;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.2s;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* Inspector List Item */
        .inspection-item {
            padding: 16px;
            border-bottom: 1px solid #e9ecef;
            cursor: pointer;
            transition: background 0.2s;
        }

        .inspection-item:hover {
            background: #f8f9fa;
        }

        .inspection-item:last-child {
            border-bottom: none;
        }

        /* Parts Search Results */
        .part-result {
            padding: 16px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .part-result:hover {
            border-color: #4CAF50;
            background: #f1f8f4;
            transform: translateY(-2px);
        }

        .part-number {
            display: inline-block;
            background: #e3f2fd;
            color: #1565c0;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            margin-right: 8px;
        }

        .part-vendor {
            font-size: 12px;
            color: #6c757d;
        }

        .part-description {
            font-size: 14px;
            font-weight: 500;
            margin: 8px 0;
        }

        .part-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .part-category {
            font-size: 12px;
            color: #6c757d;
        }

        .part-price {
            font-size: 16px;
            font-weight: 700;
            color: #4CAF50;
        }

        /* Selected Parts */
        .selected-part {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: start;
        }

        .remove-btn {
            background: none;
            border: none;
            color: #dc3545;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            transition: background 0.2s;
        }

        .remove-btn:hover {
            background: #f8d7da;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .flex {
            display: flex;
        }

        .flex-between {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .gap-2 {
            gap: 16px;
        }

        .mb-2 {
            margin-bottom: 16px;
        }

        .mb-3 {
            margin-bottom: 24px;
        }

        .text-center {
            text-align: center;
        }

        /* Mobile hamburger button */
        .mobile-menu-btn {
            display: none;
            position: fixed;
            top: 12px;
            left: 12px;
            z-index: 1001;
            width: 44px;
            height: 44px;
            border-radius: 10px;
            background: #2d3748;
            border: none;
            cursor: pointer;
            padding: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.25);
            transition: transform 0.2s;
        }

        .mobile-menu-btn:active {
            transform: scale(0.92);
        }

        .mobile-menu-btn img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 6px;
        }

        /* Mobile overlay backdrop */
        .sidebar-backdrop {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .sidebar-backdrop.visible {
            opacity: 1;
        }

        /* Login logo entrance animation */
        @keyframes logoEntrance {
            0% {
                opacity: 0;
                transform: scale(0.3) rotate(-180deg);
            }
            60% {
                opacity: 1;
                transform: scale(1.1) rotate(10deg);
            }
            80% {
                transform: scale(0.95) rotate(-5deg);
            }
            100% {
                opacity: 1;
                transform: scale(1) rotate(0deg);
            }
        }

        .login-logo-animate {
            animation: logoEntrance 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .mobile-menu-btn {
                display: block;
            }

            .sidebar-backdrop {
                display: block;
                pointer-events: none;
            }

            .sidebar-backdrop.visible {
                pointer-events: auto;
            }

            .sidebar {
                position: fixed;
                top: 0;
                left: 0;
                bottom: 0;
                z-index: 1000;
                transform: translateX(-100%);
                transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                width: 260px;
                min-width: 260px;
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }

            /* Override collapsed state on mobile - always show full sidebar when open */
            .sidebar.collapsed.mobile-open {
                width: 260px;
                min-width: 260px;
            }

            .sidebar.collapsed.mobile-open .sidebar-logo-icon {
                opacity: 0;
            }

            .sidebar.collapsed.mobile-open .sidebar-logo-full {
                opacity: 1;
            }

            .sidebar.collapsed.mobile-open .nav-item span:last-child {
                display: inline;
            }

            .sidebar.collapsed.mobile-open .sidebar-close-btn {
                display: block;
            }

            .sidebar.collapsed.mobile-open .sidebar-footer .user-info > div:last-child {
                display: block;
            }

            .sidebar.collapsed.mobile-open .sidebar-divider span {
                display: inline;
            }

            .topbar {
                padding: 0 16px 0 64px;
                position: relative;
            }

            /* Tech dashboard has no topbar, needs top padding for hamburger */
            #techDashboard .content-area {
                padding: 16px;
                padding-top: 68px;
            }

            /* Office dashboard has topbar, just reduce side padding */
            #officeDashboard .content-area {
                padding: 16px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .pipeline-status {
                grid-template-columns: repeat(2, 1fr);
            }

            .page-header {
                margin-top: 0;
            }
        }

        /* Schedule Styles */
        .schedule-tab {
            padding: 12px 24px;
            background: none;
            border: none;
            font-size: 14px;
            font-weight: 500;
            color: #6c757d;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
            transition: all 0.2s;
        }

        .schedule-tab:hover {
            color: #212529;
        }

        .schedule-tab.active {
            color: #4CAF50;
            border-bottom-color: #4CAF50;
        }

        /* Table-based schedule layout */
        .schedule-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            font-size: 13px;
            background: white;
            border: 1px solid #e0e3e8;
            border-radius: 12px;
            overflow: hidden;
            table-layout: fixed;
            box-shadow: 0 1px 3px rgba(0,0,0,0.04), 0 1px 2px rgba(0,0,0,0.06);
        }

        .schedule-table thead th {
            background: linear-gradient(180deg, #f8f9fb 0%, #f0f2f5 100%);
            padding: 10px 12px;
            font-size: 11px;
            font-weight: 700;
            color: #5a6370;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            border-bottom: 2px solid #e0e3e8;
            border-right: 1px solid #e8eaed;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .schedule-table thead th:last-child {
            border-right: none;
        }

        .schedule-table td {
            border-bottom: 1px solid #f0f2f5;
            border-right: 1px solid #f0f2f5;
            padding: 8px 12px;
            vertical-align: top;
            line-height: 1.5;
            color: #3a3f47;
        }

        .schedule-table td:last-child {
            border-right: none;
        }

        .schedule-table tbody tr:last-child td {
            border-bottom: none;
        }


        .schedule-table .col-school {
            width: 200px;
            font-weight: 600;
            color: #212529;
        }

        .schedule-table .col-tech {
            width: 170px;
        }

        .schedule-table .col-parts {
            width: 200px;
        }

        .schedule-day-row {
            background: none;
        }

        .schedule-day-row td {
            background: linear-gradient(135deg, #1a1a2e 0%, #2d2d50 100%);
            color: white;
            font-weight: 700;
            font-size: 13px;
            padding: 10px 14px;
            letter-spacing: 0.3px;
            border-bottom: none;
            border-right: none;
        }

        .schedule-today-row td {
            background: linear-gradient(135deg, #2e7d32 0%, #43a047 100%) !important;
            color: white !important;
        }

        .schedule-note-row {
            background: #fffef5;
        }

        .schedule-note-row td {
            font-weight: 600;
            text-align: center;
            font-style: italic;
            color: #8d6e04;
            border-left: 3px solid #ffd54f;
            background: linear-gradient(90deg, #fffef5 0%, #fff 100%);
        }

        .schedule-continued-row {
            background: #f5f9ff;
        }

        .schedule-continued-row td {
            border-left: 3px solid #64b5f6;
        }

        .schedule-continued-row td:first-child {
            color: #1565c0;
        }

        .schedule-pink-row td:first-child {
            background: #ffe0e6;
            color: #c62828;
            font-weight: 700;
            border-left: 3px solid #e91e63;
        }

        .ready-job-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 16px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background 0.15s;
        }

        .ready-job-item:hover {
            background: #f8f9fa;
        }

        .ready-job-item:last-child {
            border-bottom: none;
        }

        .overnight-tag {
            background: #e3f2fd;
            color: #1565c0;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
        }

        /* Legacy schedule-day styles for My Jobs card view */
        .schedule-day {
            background: white;
            border-radius: 8px;
            margin-bottom: 16px;
            border: 1px solid #e9ecef;
            overflow: hidden;
        }

        .schedule-day-header {
            background: #2d3748;
            color: white;
            padding: 12px 16px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .schedule-day-header.today {
            background: #4CAF50;
        }

        .schedule-day-jobs {
            padding: 0;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-card">
            <div class="login-logo login-logo-animate">
                <img src="bleachers-logo-icon.png" alt="Bleachers & Seats">
            </div>
            <img src="menu-logo-wide.png" alt="Bleachers & Seats" style="max-width: 320px; margin: 0 auto 16px; display: block;">
            <p class="login-subtitle">Professional, Accurate, On-Time</p>

            <div class="form-group">
                <label class="form-label">Email Address</label>
                <input type="email" class="form-input" value="office@bleachers.com" placeholder="you@company.com">
            </div>

            <div class="form-group">
                <label class="form-label">Password</label>
                <input type="password" class="form-input" value="password" placeholder="Enter your password">
            </div>

            <button class="btn btn-primary" onclick="login('office')" style="width: 100%; margin-bottom: 12px;">
                Sign In
            </button>

            <div class="demo-accounts">
                <strong>Demo Accounts (click to login):</strong>
                <div onclick="login('admin')" style="cursor: pointer;">‚Ä¢ <strong>admin@bleachers.com</strong> - Admin</div>
                <div onclick="login('office')" style="cursor: pointer;">‚Ä¢ <strong>office@bleachers.com</strong> - Office Staff</div>
                <div onclick="login('inspector')" style="cursor: pointer;">‚Ä¢ <strong>tech@bleachers.com</strong> - Field Staff</div>
            </div>
        </div>
    </div>

    <!-- Office Dashboard -->
    <div id="officeDashboard" class="hidden">
        <div class="app-layout">
            <button class="mobile-menu-btn" onclick="toggleMobileMenu('officeSidebar')">
                <img src="bleachers-logo-icon.png" alt="Menu">
            </button>
            <div class="sidebar-backdrop" id="officeSidebarBackdrop" onclick="closeMobileMenu('officeSidebar')"></div>
            <div class="sidebar" id="officeSidebar">
                <div class="sidebar-header" onclick="toggleSidebar('officeSidebar')">
                    <img src="bleachers-logo-icon.png" alt="Bleachers & Seats" class="sidebar-logo-icon">
                    <img src="menu-logo-wide.png" alt="Bleachers & Seats" class="sidebar-logo-full">
                    <div class="sidebar-close-btn">‚úï</div>
                </div>
                <div class="sidebar-nav">
                    <div class="sidebar-divider" style="margin: 8px 20px 12px; border-top: 1px solid rgba(255,255,255,0.15); position: relative;">
                        <span style="position: absolute; top: -8px; left: 50%; transform: translateX(-50%); background: #2d3748; padding: 0 8px; font-size: 10px; color: rgba(255,255,255,0.4); white-space: nowrap; text-transform: uppercase; letter-spacing: 1px;">Office & Sales</span>
                    </div>
                    <div class="nav-item active" onclick="showView('dashboard')">
                        <span>üìä</span>
                        <span>Dashboard</span>
                    </div>
                    <div class="nav-item" onclick="showView('estimates')">
                        <span>üìÑ</span>
                        <span>Estimates</span>
                    </div>
                    <div class="nav-item" onclick="showView('projects')">
                        <span>üîÑ</span>
                        <span>Pipeline</span>
                    </div>
                    <div class="nav-item" onclick="showView('accounts')">
                        <span>üè´</span>
                        <span>Accounts</span>
                    </div>
                    <div class="sidebar-divider" style="margin: 12px 20px; border-top: 1px solid rgba(255,255,255,0.15); position: relative;">
                        <span style="position: absolute; top: -8px; left: 50%; transform: translateX(-50%); background: #2d3748; padding: 0 8px; font-size: 10px; color: rgba(255,255,255,0.4); white-space: nowrap; text-transform: uppercase; letter-spacing: 1px;">Inspections & Service</span>
                    </div>
                    <div class="nav-item" onclick="showView('officeSearch')">
                        <span>üîç</span>
                        <span>Search</span>
                    </div>
                    <div class="nav-item" onclick="showView('scheduling')">
                        <span>üìÖ</span>
                        <span>Scheduling</span>
                    </div>
                    <div class="nav-item" onclick="showView('parts')">
                        <span>üì¶</span>
                        <span>Parts & Orders</span>
                    </div>
                    <div class="nav-item" onclick="showView('officeCreate')">
                        <span>+</span>
                        <span>Create</span>
                    </div>
                    <div id="adminNavSection" class="hidden">
                        <div class="sidebar-divider" style="margin: 12px 20px; border-top: 1px solid rgba(255,255,255,0.15); position: relative;">
                            <span style="position: absolute; top: -8px; left: 50%; transform: translateX(-50%); background: #2d3748; padding: 0 8px; font-size: 10px; color: rgba(255,255,255,0.4); white-space: nowrap; text-transform: uppercase; letter-spacing: 1px;">Admin</span>
                        </div>
                        <div class="nav-item" onclick="showView('employees')">
                            <span>üë•</span>
                            <span>Employees</span>
                        </div>
                        <div class="nav-item" onclick="showView('dataManagement')">
                            <span>üóÑÔ∏è</span>
                            <span>Data Management</span>
                        </div>
                    </div>
                </div>
                <div class="sidebar-footer">
                    <div class="user-info" onclick="logout()">
                        <div class="user-avatar" id="officeUserAvatar">OM</div>
                        <div>
                            <div style="font-size: 14px; font-weight: 600;" id="officeUserName">Office Manager</div>
                            <div style="font-size: 12px; opacity: 0.7;">Logout</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="main-content">
                <div class="topbar">
                    <div class="search-box">
                        <input type="text" class="search-input" placeholder="Search accounts, locations, equipment, parts...">
                    </div>
                    <div class="topbar-actions">
                        <div class="notification-badge">
                            üîî
                            <div class="notification-dot"></div>
                        </div>
                    </div>
                </div>

                <div class="content-area">
                    <!-- Dashboard View -->
                    <div id="dashboardView">
                        <div class="page-header">
                            <h1 class="page-title">Office Dashboard</h1>
                            <p class="page-subtitle">Pipeline overview and team activity</p>
                        </div>

                        <div class="alert-box alert-warning">
                            ‚ö†Ô∏è 2 estimates expiring this week
                        </div>

                        <div class="alert-box alert-danger">
                            üî¥ 1 project waiting on parts
                        </div>

                        <div class="alert-box alert-info">
                            ‚ÑπÔ∏è 3 new inspections submitted
                        </div>

                        <div class="stats-grid">
                            <div class="stat-card green">
                                <div class="stat-label">Total Pipeline Value</div>
                                <div class="stat-value">$127,500</div>
                                <div class="stat-subtitle">Across 31 projects</div>
                            </div>
                            <div class="stat-card blue">
                                <div class="stat-label">New Inspections</div>
                                <div class="stat-value" id="totalInspections">0</div>
                                <div class="stat-subtitle">This week</div>
                            </div>
                            <div class="stat-card purple">
                                <div class="stat-label">Active Projects</div>
                                <div class="stat-value" id="totalJobs">0</div>
                                <div class="stat-subtitle">In progress</div>
                            </div>
                            <div class="stat-card orange">
                                <div class="stat-label">Estimates Created</div>
                                <div class="stat-value">8</div>
                                <div class="stat-subtitle">This week</div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Pipeline Status</h2>
                            </div>
                            <div class="card-body">
                                <div class="pipeline-status">
                                    <div class="status-box review">
                                        <div class="status-count">5</div>
                                        <div class="status-label">Review Queue</div>
                                    </div>
                                    <div class="status-box ordering">
                                        <div class="status-count">12</div>
                                        <div class="status-label">Parts Ordering</div>
                                    </div>
                                    <div class="status-box scheduled">
                                        <div class="status-count">8</div>
                                        <div class="status-label">Scheduled</div>
                                    </div>
                                    <div class="status-box progress">
                                        <div class="status-count">6</div>
                                        <div class="status-label">In Progress</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Quick Actions</h2>
                            </div>
                            <div class="card-body">
                                <div class="quick-actions">
                                    <button class="btn btn-primary" onclick="showView('estimates')">üìÑ Review Estimates</button>
                                    <button class="btn btn-outline" onclick="showView('parts')">üì¶ Check Inventory</button>
                                    <button class="btn btn-outline" onclick="showView('scheduling')">üìÖ View Schedule</button>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Recent Activity</h2>
                            </div>
                            <div class="card-body">
                                <div class="inspection-item">
                                    <div class="flex-between">
                                        <div>
                                            <strong>Wilson County Schools</strong>
                                            <p style="font-size: 13px; color: #6c757d; margin-top: 4px;">3 new estimates created</p>
                                        </div>
                                        <span style="font-size: 12px; color: #6c757d;">2h ago</span>
                                    </div>
                                </div>
                                <div class="inspection-item">
                                    <div class="flex-between">
                                        <div>
                                            <strong>Franklin Special SD</strong>
                                            <p style="font-size: 13px; color: #6c757d; margin-top: 4px;">Parts arrived for Project #1847</p>
                                        </div>
                                        <span style="font-size: 12px; color: #6c757d;">4h ago</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Estimates View -->
                    <div id="estimatesView" class="hidden">
                        <div class="page-header">
                            <h1 class="page-title">Estimate Review Dashboard</h1>
                            <p class="page-subtitle">Review parts specifications and create customer estimates</p>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Pending Review (<span id="pendingCount">0</span>)</h2>
                            </div>
                            <div class="card-body" id="estimatesList">
                                <!-- Populated by JavaScript -->
                            </div>
                        </div>
                    </div>

                    <!-- Estimate Detail View -->
                    <div id="estimateDetailView" class="hidden">
                        <div class="page-header">
                            <button class="btn btn-secondary" onclick="showView('estimates')">‚Üê Back to Estimates</button>
                        </div>
                        <div id="estimateDetailContent"></div>
                    </div>

                    <!-- Projects View -->
                    <div id="projectsView" class="hidden">
                        <div class="page-header">
                            <h1 class="page-title">Pipeline</h1>
                            <p class="page-subtitle">All jobs at a glance ‚Äî from estimate to completion</p>
                        </div>

                        <div id="pipelineContent">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Parts View -->
                    <div id="partsView" class="hidden">
                        <div class="page-header">
                            <h1 class="page-title">Parts & Inventory Management</h1>
                            <p class="page-subtitle">Track parts ordering, receiving, and warehouse locations</p>
                        </div>

                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-label">Pending Orders</div>
                                <div class="stat-value">3</div>
                                <div class="stat-subtitle">Awaiting delivery</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Received Items</div>
                                <div class="stat-value">3</div>
                                <div class="stat-subtitle">Ready for jobs</div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Purchase Orders</h2>
                            </div>
                            <div class="card-body">
                                <p style="color: #6c757d;">Purchase order tracking will appear here...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Accounts View -->
                    <div id="accountsView" class="hidden">
                        <div class="page-header">
                            <h1 class="page-title">Accounts & Equipment Registry</h1>
                            <p class="page-subtitle">Manage customer accounts (counties/entities) and their locations (schools)</p>
                        </div>

                        <div style="margin-bottom: 24px;">
                            <input type="text" id="accountSearch" class="form-input" placeholder="Search customers or locations..." oninput="filterAccounts()" style="max-width: 400px;">
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Customer Accounts</h2>
                                <span id="accountCount" style="font-size: 14px; color: #6c757d;">6 customers</span>
                            </div>
                            <div class="card-body">
                                <div id="accountsList"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Customer Detail View -->
                    <div id="customerDetailView" class="hidden">
                        <div class="page-header">
                            <button class="btn btn-secondary" onclick="showView('accounts')">‚Üê Back to Accounts</button>
                            <div style="display: flex; align-items: center; gap: 16px; margin-top: 16px;">
                                <h1 class="page-title" style="margin: 0;" id="custDetailName">Lauderdale County Schools</h1>
                                <span id="custDetailType" class="badge badge-info">County</span>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px;">
                            <!-- Customer Info -->
                            <div class="card">
                                <div class="card-header">
                                    <h2 class="card-title">Customer Information</h2>
                                </div>
                                <div class="card-body">
                                    <div class="form-group">
                                        <label class="form-label">Billing Address</label>
                                        <p id="custDetailAddress" style="font-size: 14px;">100 S Jefferson St, Ripley, TN 38063</p>
                                    </div>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 16px;">
                                        <div class="form-group">
                                            <label class="form-label">Primary Contact</label>
                                            <p id="custDetailContact" style="font-size: 14px;">Mike Mann</p>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Phone</label>
                                            <p id="custDetailPhone" style="font-size: 14px;">(731) 635-2941</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Stats -->
                            <div class="card">
                                <div class="card-header">
                                    <h2 class="card-title">Account Stats</h2>
                                </div>
                                <div class="card-body">
                                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; text-align: center;">
                                        <div>
                                            <div style="font-size: 28px; font-weight: 700; color: #4CAF50;" id="custDetailLocations">4</div>
                                            <div style="font-size: 12px; color: #6c757d;">Locations</div>
                                        </div>
                                        <div>
                                            <div style="font-size: 28px; font-weight: 700; color: #2196F3;" id="custDetailJobs">28</div>
                                            <div style="font-size: 12px; color: #6c757d;">Total Jobs</div>
                                        </div>
                                        <div>
                                            <div style="font-size: 28px; font-weight: 700; color: #9C27B0;" id="custDetailRevenue">$45,230</div>
                                            <div style="font-size: 12px; color: #6c757d;">Revenue</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tabs -->
                        <div class="card">
                            <div class="card-header" style="border-bottom: none; padding-bottom: 0;">
                                <div style="display: flex; gap: 0;">
                                    <button class="btn" id="tabLocations" onclick="showCustomerTab('locations')" style="border-radius: 8px 8px 0 0; border-bottom: 3px solid #4CAF50;">Locations</button>
                                    <button class="btn" id="tabHistory" onclick="showCustomerTab('history')" style="border-radius: 8px 8px 0 0; background: transparent; color: #6c757d;">Service History</button>
                                    <button class="btn" id="tabEquipment" onclick="showCustomerTab('equipment')" style="border-radius: 8px 8px 0 0; background: transparent; color: #6c757d;">Equipment</button>
                                </div>
                            </div>
                            <div class="card-body">
                                <!-- Locations Tab -->
                                <div id="customerLocationsTab">
                                    <div id="custLocationsList"></div>
                                </div>

                                <!-- Service History Tab -->
                                <div id="customerHistoryTab" class="hidden">
                                    <table class="data-table">
                                        <thead>
                                            <tr>
                                                <th>Job #</th>
                                                <th>Type</th>
                                                <th>Location</th>
                                                <th>Description</th>
                                                <th>Status</th>
                                                <th>Date</th>
                                            </tr>
                                        </thead>
                                        <tbody id="custHistoryList">
                                            <tr>
                                                <td><span class="part-number" style="color: #0066cc;">17208</span></td>
                                                <td>Repair</td>
                                                <td>Ripley High School</td>
                                                <td>GOAL 5: Labor to install safety strap</td>
                                                <td><span class="badge badge-success">Completed</span></td>
                                                <td>1/22/2026</td>
                                            </tr>
                                            <tr>
                                                <td><span class="part-number" style="color: #0066cc;">17175</span></td>
                                                <td>Service Call</td>
                                                <td>Ripley High School</td>
                                                <td>Main goal winch isn't operating correctly</td>
                                                <td><span class="badge badge-success">Completed</span></td>
                                                <td>1/22/2026</td>
                                            </tr>
                                            <tr>
                                                <td><span class="part-number" style="color: #0066cc;">15741</span></td>
                                                <td>Service Call</td>
                                                <td>Ripley High School</td>
                                                <td>2025 Indoor Bleacher Inspections</td>
                                                <td><span class="badge badge-success">Completed</span></td>
                                                <td>10/1/2025</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                                <!-- Equipment Tab -->
                                <div id="customerEquipmentTab" class="hidden">
                                    <p style="color: #6c757d; text-align: center; padding: 40px;">Equipment registry coming soon...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Scheduling View -->
                    <div id="schedulingView" class="hidden">
                        <div class="page-header" style="display: flex; justify-content: space-between; align-items: flex-start;">
                            <div>
                                <h1 class="page-title">Scheduling</h1>
                                <p class="page-subtitle">Crew and job assignments</p>
                            </div>
                            <div style="display: flex; gap: 12px; align-items: center;">
                                <button class="btn btn-outline" onclick="previousWeek()" style="padding: 8px 12px;">‚Üê Prev</button>
                                <span id="scheduleWeekLabel" style="font-weight: 600; min-width: 180px; text-align: center;">Week of Jan 6, 2025</span>
                                <button class="btn btn-outline" onclick="nextWeek()" style="padding: 8px 12px;">Next ‚Üí</button>
                                <button class="btn btn-primary" onclick="openAddEntryModal()">+ Add Entry</button>
                            </div>
                        </div>

                        <!-- Territory Tabs -->
                        <div style="display: flex; gap: 0; margin-bottom: 0; border-bottom: 2px solid #dee2e6;">
                            <button class="schedule-tab active" onclick="switchTerritory('original')" id="officeOriginalTab" style="font-weight: 700; font-size: 15px;">Original Territory (KY/TN)</button>
                            <button class="schedule-tab" onclick="switchTerritory('southern')" id="officeSouthernTab" style="font-weight: 700; font-size: 15px;">Southern Territory (AL/FL)</button>
                        </div>

                        <!-- Schedule Tabs -->
                        <div style="display: flex; gap: 0; margin-bottom: 20px; border-bottom: 2px solid #e9ecef; margin-top: 4px;">
                            <button class="schedule-tab active" onclick="switchScheduleTab('thisWeek')" id="thisWeekTab">This Week</button>
                            <button class="schedule-tab" onclick="switchScheduleTab('planning')" id="planningTab">Planning</button>
                            <button class="schedule-tab" onclick="switchScheduleTab('backlog')" id="backlogTab">Backlog <span id="backlogCount" class="badge badge-success" style="margin-left: 6px;">0</span></button>
                            <button class="schedule-tab" onclick="switchScheduleTab('shitList')" id="shitListTab">Shit List <span id="shitListCount" class="badge" style="margin-left: 6px; background: #ffe0e6; color: #c62828;">0</span></button>
                        </div>

                        <!-- This Week View -->
                        <div id="thisWeekView">
                            <div id="weeklyScheduleGrid"></div>
                        </div>

                        <!-- Planning View -->
                        <div id="planningView" class="hidden">
                            <div class="card" style="margin-bottom: 20px; background: #fffde7;">
                                <div class="card-body" style="padding: 16px;">
                                    <div style="display: flex; align-items: center; gap: 12px;">
                                        <span style="font-size: 24px;">üìã</span>
                                        <div>
                                            <strong>Planning Mode</strong>
                                            <p style="font-size: 13px; color: #6c757d; margin-top: 2px;">Build next week's schedule here. Pull jobs from the Backlog or add manually.</p>
                                        </div>
                                        <button class="btn btn-success" style="margin-left: auto;" onclick="publishSchedule()">Publish Schedule</button>
                                    </div>
                                </div>
                            </div>
                            <div id="planningScheduleGrid"></div>
                        </div>

                        <!-- Backlog -->
                        <div id="backlogView" class="hidden">
                            <div class="stats-grid" style="margin-bottom: 20px;">
                                <div class="stat-card green">
                                    <div class="stat-value" id="readyPartsReceived">0</div>
                                    <div class="stat-label">Parts Received</div>
                                </div>
                                <div class="stat-card blue">
                                    <div class="stat-value" id="readyInspectionsOnly">0</div>
                                    <div class="stat-label">Inspections Only</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value" id="readyTotalLabor">$0</div>
                                    <div class="stat-label">Total Labor Value</div>
                                </div>
                            </div>

                            <div class="card">
                                <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                                    <h2 class="card-title">Backlog</h2>
                                    <div style="display: flex; gap: 8px;">
                                        <select id="readyFilterCounty" class="form-input" style="width: 150px; padding: 6px 10px;" onchange="filterReadyJobs()">
                                            <option value="">All Counties</option>
                                        </select>
                                        <select id="readyFilterType" class="form-input" style="width: 130px; padding: 6px 10px;" onchange="filterReadyJobs()">
                                            <option value="">All Types</option>
                                            <option value="Repair">Repair</option>
                                            <option value="Inspection">Inspection</option>
                                            <option value="Service Call">Service Call</option>
                                            <option value="Go See">Go See</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="card-body" id="readyJobsList" style="padding: 0;"></div>
                            </div>
                        </div>

                        <!-- Shit List (Pink Jobs - Incomplete/Return) -->
                        <div id="shitListView" class="hidden">
                            <div style="padding: 16px; background: #fff0f0; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #c62828;">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <span style="font-size: 24px;">&#x1F534;</span>
                                    <div>
                                        <strong style="color: #c62828;">The Shit List</strong>
                                        <p style="font-size: 13px; color: #6c757d; margin-top: 2px;">Jobs that weren't completed - wrong parts, couldn't access site, additional work needed. These need to be rescheduled.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="stats-grid" style="margin-bottom: 20px;">
                                <div class="stat-card" style="background: #fff0f0;">
                                    <div class="stat-value" style="color: #c62828;" id="shitListTotal">0</div>
                                    <div class="stat-label">Total Pink Jobs</div>
                                </div>
                                <div class="stat-card" style="background: #fff3e0;">
                                    <div class="stat-value" style="color: #e65100;" id="shitListWrongPart">0</div>
                                    <div class="stat-label">Wrong/Missing Part</div>
                                </div>
                                <div class="stat-card" style="background: #e3f2fd;">
                                    <div class="stat-value" style="color: #1565c0;" id="shitListOther">0</div>
                                    <div class="stat-label">Other Reasons</div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                                    <h2 class="card-title" style="color: #c62828;">Pink Jobs</h2>
                                    <div style="display: flex; gap: 8px;">
                                        <select id="shitListFilterReason" class="form-input" style="width: 180px; padding: 6px 10px;" onchange="filterShitList()">
                                            <option value="">All Reasons</option>
                                            <option value="Wrong Part">Wrong/Missing Part</option>
                                            <option value="Can't Access">Can't Access Site</option>
                                            <option value="Additional Work">Additional Work Needed</option>
                                            <option value="Equipment Issue">Equipment Issue</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="card-body" id="shitListJobsList" style="padding: 0;"></div>
                            </div>
                        </div>

                        <!-- Add Entry Modal -->
                        <div id="addEntryModal" class="modal hidden">
                            <div class="modal-content" style="max-width: 600px;">
                                <div class="modal-header">
                                    <h2 class="modal-title">Add Schedule Entry</h2>
                                    <button class="modal-close" onclick="closeAddEntryModal()">√ó</button>
                                </div>
                                <div class="modal-body">
                                    <div class="form-group">
                                        <label class="form-label">Entry Type</label>
                                        <select id="entryType" class="form-input" onchange="toggleEntryFields()">
                                            <option value="job">Job from Backlog</option>
                                            <option value="note">Note (Holiday, Stop at Shop, etc.)</option>
                                            <option value="custom">Custom Entry</option>
                                        </select>
                                    </div>

                                    <!-- Job Selection -->
                                    <div id="jobEntryFields">
                                        <div class="form-group">
                                            <label class="form-label">Select Job</label>
                                            <select id="entryJobSelect" class="form-input">
                                                <option value="">-- Select a job --</option>
                                            </select>
                                        </div>
                                    </div>

                                    <!-- Note Entry -->
                                    <div id="noteEntryFields" class="hidden">
                                        <div class="form-group">
                                            <label class="form-label">Note</label>
                                            <input type="text" id="entryNote" class="form-input" placeholder="e.g., Company Holiday, Alex Off, Stop at shop for parts">
                                        </div>
                                    </div>

                                    <!-- Custom Entry -->
                                    <div id="customEntryFields" class="hidden">
                                        <div class="form-group">
                                            <label class="form-label">School/Location</label>
                                            <input type="text" id="entrySchool" class="form-input" placeholder="School name">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Job Description</label>
                                            <textarea id="entryDescription" class="form-input" rows="3" placeholder="What work needs to be done"></textarea>
                                        </div>
                                    </div>

                                    <!-- Common Fields -->
                                    <div class="form-row">
                                        <div class="form-group" style="flex: 1;">
                                            <label class="form-label">Day</label>
                                            <select id="entryDay" class="form-input">
                                                <option value="mon">Monday</option>
                                                <option value="tue">Tuesday</option>
                                                <option value="wed">Wednesday</option>
                                                <option value="thu">Thursday</option>
                                                <option value="fri">Friday (Floating)</option>
                                            </select>
                                        </div>
                                        <div class="form-group" style="flex: 1;">
                                            <label class="form-label">Assigned To</label>
                                            <select id="entryTech" class="form-input">
                                                <option value="">-- Select tech(s) --</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="form-row">
                                        <div class="form-group" style="flex: 1;">
                                            <label class="form-label">Parts Location</label>
                                            <input type="text" id="entryPartsLocation" class="form-input" placeholder="TN Shop, School, etc.">
                                        </div>
                                        <div class="form-group" style="flex: 1;">
                                            <label class="form-label">Confirmation</label>
                                            <select id="entryConfirmation" class="form-input">
                                                <option value="">Not confirmed</option>
                                                <option value="X">X - Attempted</option>
                                                <option value="XX">XX - Confirmed</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">Notes</label>
                                        <input type="text" id="entryNotes" class="form-input" placeholder="Contact info, special instructions, etc.">
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button class="btn btn-secondary" onclick="closeAddEntryModal()">Cancel</button>
                                    <button class="btn btn-primary" onclick="saveScheduleEntry()">Add to Schedule</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Office Inspections View (Field Staff items visible to office) -->
                    <div id="officeInspectionsView" class="hidden">
                        <div class="page-header">
                            <h1 class="page-title">Field Inspections</h1>
                            <p class="page-subtitle">View and manage all field staff inspections</p>
                        </div>

                        <button class="btn btn-primary btn-lg mb-3" onclick="startNewJob()">+ New Inspection Job</button>

                        <div class="stats-grid">
                            <div class="stat-card" style="background: #fff3e0;">
                                <div class="stat-value" style="color: #e65100;" id="officeInProgressCount">0</div>
                                <div class="stat-label">In Progress</div>
                            </div>
                            <div class="stat-card" style="background: #e8f5e9;">
                                <div class="stat-value" style="color: #2e7d32;" id="officeInspectionsCount">0</div>
                                <div class="stat-label">Submitted</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="officeTotalBanks">0</div>
                                <div class="stat-label">Banks Inspected</div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">All Inspection Jobs</h2>
                                <p style="font-size: 13px; color: #6c757d; margin-top: 4px;">Click any job to view details and generate estimate</p>
                            </div>
                            <div class="card-body" id="officeInspectionsList" style="padding: 0;"></div>
                        </div>
                    </div>

                    <!-- Office Work Orders View (Field Staff items visible to office) -->
                    <div id="officeWorkOrdersView" class="hidden">
                        <div class="page-header">
                            <h1 class="page-title">Work Orders</h1>
                            <p class="page-subtitle">View all field staff work orders and assignments</p>
                        </div>

                        <div class="stats-grid" style="margin-bottom: 24px;">
                            <div class="stat-card">
                                <div class="stat-value">3</div>
                                <div class="stat-label">Scheduled</div>
                            </div>
                            <div class="stat-card blue">
                                <div class="stat-value">2</div>
                                <div class="stat-label">In Progress</div>
                            </div>
                            <div class="stat-card green">
                                <div class="stat-value">8</div>
                                <div class="stat-label">Completed</div>
                            </div>
                            <div class="stat-card" style="background: #ffebee;">
                                <div class="stat-value" style="color: #c62828;">1</div>
                                <div class="stat-label" style="color: #c62828;">Pink Jobs</div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Active Work Orders</h2>
                            </div>
                            <div class="card-body" id="workOrdersList">
                                <!-- Sample Work Order 1 -->
                                <div class="inspection-item" onclick="viewWorkOrderDetail('wo1')" style="cursor: pointer;">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                        <div>
                                            <div style="margin-bottom: 8px;">
                                                <span class="part-number" style="color: #0066cc; font-size: 14px;">17208</span>
                                                <span style="margin-left: 8px; font-size: 12px; color: #6c757d;">Repair</span>
                                                <span class="badge badge-success" style="margin-left: 8px;">Parts Ready</span>
                                            </div>
                                            <strong>Ripley High School</strong>
                                            <p style="font-size: 12px; color: #6c757d; margin-top: 2px;">Lauderdale County Schools</p>
                                            <p style="font-size: 13px; margin-top: 8px;">GOAL 5: Labor to install safety strap *Lift rental required*</p>
                                            <div style="margin-top: 12px; padding: 12px; background: #f8f9fa; border-radius: 6px; font-size: 13px;">
                                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                                                    <div><strong>Confirmed with:</strong> Mike Mann</div>
                                                    <div><strong>Confirmed by:</strong> Savannah Kirkland</div>
                                                    <div><strong>Parts Location:</strong> Floyd's house - dropping at Millington HS</div>
                                                    <div><strong>Scheduled:</strong> 1/22/2026</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div style="text-align: right;">
                                            <div style="font-size: 12px; color: #6c757d;">Assigned to</div>
                                            <div style="font-weight: 600;">TNBSTeam 2</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Sample Work Order 2 -->
                                <div class="inspection-item" onclick="viewWorkOrderDetail('wo2')" style="cursor: pointer;">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                        <div>
                                            <div style="margin-bottom: 8px;">
                                                <span class="part-number" style="color: #0066cc; font-size: 14px;">17175</span>
                                                <span style="margin-left: 8px; font-size: 12px; color: #6c757d;">Service Call</span>
                                                <span class="badge badge-warning" style="margin-left: 8px;">In Progress</span>
                                            </div>
                                            <strong>Oak Mountain High School</strong>
                                            <p style="font-size: 12px; color: #6c757d; margin-top: 2px;">Shelby County Schools</p>
                                            <p style="font-size: 13px; margin-top: 8px;">Main goal winch isn't operating correctly *40' lift rental required*</p>
                                            <div style="margin-top: 12px; padding: 12px; background: #f8f9fa; border-radius: 6px; font-size: 13px;">
                                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                                                    <div><strong>Confirmed with:</strong> Janet Williams</div>
                                                    <div><strong>Parts Location:</strong> On truck</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div style="text-align: right;">
                                            <div style="font-size: 12px; color: #6c757d;">Assigned to</div>
                                            <div style="font-weight: 600;">Danny Mendl</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Sample Work Order 3 - Pink Job -->
                                <div class="inspection-item" style="border-left: 4px solid #e91e63; cursor: pointer;" onclick="viewWorkOrderDetail('wo3')">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                        <div>
                                            <div style="margin-bottom: 8px;">
                                                <span class="part-number" style="color: #0066cc; font-size: 14px;">17198</span>
                                                <span style="margin-left: 8px; font-size: 12px; color: #6c757d;">Service Call</span>
                                                <span class="badge badge-danger" style="margin-left: 8px;">Pink</span>
                                            </div>
                                            <strong>Harpeth High School</strong>
                                            <p style="font-size: 12px; color: #6c757d; margin-top: 2px;">Williamson County Schools</p>
                                            <p style="font-size: 13px; margin-top: 8px;">WARRANTY - Side goal not lowering - need U bolt - school provided lift</p>
                                            <div style="margin-top: 12px; padding: 12px; background: #ffebee; border-radius: 6px; font-size: 13px;">
                                                <div style="color: #c62828;"><strong>Issue:</strong> Wrong bracket ordered - need to reorder EC-457 instead of EC-450</div>
                                            </div>
                                        </div>
                                        <div style="text-align: right;">
                                            <div style="font-size: 12px; color: #6c757d;">Assigned to</div>
                                            <div style="font-weight: 600;">Lisa Cunningham</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Office Search View -->
                    <div id="officeSearchView" class="hidden">
                        <div class="page-header">
                            <h1 class="page-title">Search</h1>
                            <p class="page-subtitle">Find any work order, inspection, or scheduled job</p>
                        </div>

                        <div style="margin-bottom: 24px;">
                            <input type="text" id="officeSearchInput" class="form-input" placeholder="Search by school name, job #, or keyword..." style="font-size: 16px; padding: 14px 16px;" oninput="performOfficeSearch()">
                        </div>

                        <div id="officeSearchResults">
                            <div style="text-align: center; padding: 60px 20px; color: #6c757d;">
                                <div style="font-size: 48px; margin-bottom: 16px;">üîç</div>
                                <p style="font-size: 15px;">Search for a school, job number, or keyword to find work orders, inspections, and scheduled jobs.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Office Create View -->
                    <div id="officeCreateView" class="hidden">
                        <div class="page-header">
                            <h1 class="page-title">Create</h1>
                            <p class="page-subtitle">Start a new job</p>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Job Info</h2>
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label class="form-label">What are you creating? *</label>
                                    <select id="officeCreateTypeSelect" class="form-select" onchange="onOfficeCreateTypeChange()" style="font-size: 16px; padding: 14px;">
                                        <option value="">Select...</option>
                                        <option value="parts_spec">Parts Spec Form</option>
                                        <option value="work_order">Work Order</option>
                                        <option value="inspection">Inspection</option>
                                    </select>
                                </div>

                                <div id="officeCreateFormFields" class="hidden">
                                    <div class="form-group">
                                        <label class="form-label">Customer / School *</label>
                                        <select id="officeCreateCustomerSelect" class="form-select" onchange="updateOfficeCreateCustomerInfo()" style="font-size: 16px; padding: 14px;">
                                            <option value="">Select a customer...</option>
                                        </select>
                                    </div>
                                    <div id="officeCreateCustomerInfo" class="hidden" style="background: #f8f9fa; padding: 12px; border-radius: 8px; margin-top: 8px; margin-bottom: 16px;">
                                        <p id="officeCreateAddress" style="font-size: 13px; color: #6c757d;"></p>
                                        <p id="officeCreateContact" style="font-size: 13px; color: #6c757d; margin-top: 4px;"></p>
                                    </div>

                                    <!-- Inspection-only fields -->
                                    <div id="officeCreateInspectionFields" class="hidden">
                                        <div class="form-group">
                                            <label class="form-label">Inspection Type *</label>
                                            <select id="officeCreateInspectionType" class="form-select" style="font-size: 16px; padding: 14px;">
                                                <option value="bleacher">Indoor Bleacher Inspection</option>
                                                <option value="outdoor">Outdoor Aluminum Bleacher Inspection</option>
                                                <option value="basketball">Basketball Goal Inspection</option>
                                            </select>
                                        </div>
                                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                            <div class="form-group">
                                                <label class="form-label">Job Number</label>
                                                <input type="text" id="officeCreateJobNumber" class="form-input" readonly style="background: #e9ecef; font-weight: 700; font-size: 16px;">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Date</label>
                                                <input type="date" id="officeCreateJobDate" class="form-input" style="font-size: 16px; padding: 14px;">
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Work Order-only fields -->
                                    <div id="officeCreateWorkOrderFields" class="hidden">
                                        <div class="form-group">
                                            <label class="form-label">Job Type *</label>
                                            <select id="officeCreateWoJobType" class="form-select" style="font-size: 16px; padding: 14px;">
                                                <option value="Service Call">Service Call</option>
                                                <option value="Repair">Repair</option>
                                                <option value="Inspection">Inspection</option>
                                                <option value="Go See">Go See</option>
                                            </select>
                                        </div>
                                    </div>

                                    <!-- Description (Work Order + Parts Spec) -->
                                    <div id="officeCreateDescriptionGroup" class="hidden">
                                        <div class="form-group">
                                            <label class="form-label">Description *</label>
                                            <textarea id="officeCreateDescription" class="form-input" rows="3" placeholder="What needs to be done..." style="font-size: 16px; padding: 14px;"></textarea>
                                        </div>
                                    </div>

                                    <!-- Notes (all types) -->
                                    <div class="form-group">
                                        <label class="form-label">Notes</label>
                                        <textarea id="officeCreateNotes" class="form-input" rows="2" placeholder="Any additional details..." style="font-size: 16px; padding: 14px;"></textarea>
                                    </div>

                                    <!-- Photo (Work Order + Parts Spec) -->
                                    <div id="officeCreatePhotoGroup" class="hidden">
                                        <div class="form-group">
                                            <label class="form-label">Photo</label>
                                            <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                                                <label style="width: 80px; height: 80px; border: 2px dashed #dee2e6; border-radius: 8px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 24px; color: #adb5bd;">
                                                    üì∑
                                                    <input type="file" accept="image/*" style="display: none;" onchange="handleOfficeCreatePhoto(this)">
                                                </label>
                                                <div id="officeCreatePhotoPreview"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <button id="officeCreateSubmitBtn" class="btn btn-primary btn-lg hidden" onclick="submitOfficeCreate()" style="width: 100%; margin-top: 16px; padding: 16px; font-size: 16px;">Create</button>
                    </div>

                    <!-- Employees View (Admin Only) -->
                    <div id="employeesView" class="hidden">
                        <div class="page-header">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <h1 class="page-title">Employees</h1>
                                    <p class="page-subtitle">Manage team members and roles</p>
                                </div>
                                <button class="btn btn-primary" onclick="showAddEmployeeModal()">+ Add Employee</button>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-body" style="padding: 0;">
                                <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                                    <thead>
                                        <tr style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                                            <th style="padding: 12px 16px; text-align: left; font-weight: 600; color: #495057;">Name</th>
                                            <th style="padding: 12px 16px; text-align: left; font-weight: 600; color: #495057;">Role</th>
                                            <th style="padding: 12px 16px; text-align: left; font-weight: 600; color: #495057;">Email</th>
                                            <th style="padding: 12px 16px; text-align: left; font-weight: 600; color: #495057;">Phone</th>
                                            <th style="padding: 12px 16px; text-align: left; font-weight: 600; color: #495057;">Territory</th>
                                            <th style="padding: 12px 16px; text-align: center; font-weight: 600; color: #495057; width: 100px;">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="employeesTableBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Add/Edit Employee Modal -->
                    <div id="employeeModal" class="hidden" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center;">
                        <div style="background: white; border-radius: 12px; padding: 32px; width: 100%; max-width: 500px; max-height: 90vh; overflow-y: auto;">
                            <h2 style="margin-bottom: 24px; font-size: 20px;" id="employeeModalTitle">Add Employee</h2>
                            <div class="form-group">
                                <label class="form-label">First Name *</label>
                                <input type="text" id="empFirstName" class="form-input" placeholder="First name">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Last Name *</label>
                                <input type="text" id="empLastName" class="form-input" placeholder="Last name">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Role *</label>
                                <select id="empRole" class="form-select">
                                    <option value="Technician">Technician</option>
                                    <option value="Inspector">Inspector</option>
                                    <option value="Office">Office Staff</option>
                                    <option value="Admin">Admin</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Email</label>
                                <input type="email" id="empEmail" class="form-input" placeholder="email@bleachers.com">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Phone</label>
                                <input type="tel" id="empPhone" class="form-input" placeholder="(615) 555-1234">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Territory</label>
                                <select id="empTerritory" class="form-select">
                                    <option value="Original">Original (KY/TN)</option>
                                    <option value="Southern">Southern (AL/FL)</option>
                                    <option value="Both">Both</option>
                                </select>
                            </div>
                            <div style="display: flex; gap: 12px; margin-top: 24px;">
                                <button class="btn btn-primary" onclick="saveEmployee()" style="flex: 1;">Save</button>
                                <button class="btn btn-secondary" onclick="closeEmployeeModal()" style="flex: 1;">Cancel</button>
                            </div>
                        </div>
                    </div>

                    <!-- Data Management View (Admin Only) -->
                    <div id="dataManagementView" class="hidden">
                        <div class="page-header">
                            <h1 class="page-title">Data Management</h1>
                            <p class="page-subtitle">Parts catalog, pricing updates, and vendor management</p>
                        </div>

                        <!-- Tabs -->
                        <div style="display: flex; gap: 0; margin-bottom: 24px; border-bottom: 2px solid #dee2e6;">
                            <button class="btn" id="dmTabParts" onclick="switchDataTab('parts')" style="border: none; border-bottom: 3px solid #4f46e5; border-radius: 0; padding: 12px 24px; font-weight: 600; color: #4f46e5;">Parts Catalog</button>
                            <button class="btn" id="dmTabImport" onclick="switchDataTab('import')" style="border: none; border-bottom: 3px solid transparent; border-radius: 0; padding: 12px 24px; font-weight: 600; color: #6c757d;">Import Pricing</button>
                            <button class="btn" id="dmTabVendors" onclick="switchDataTab('vendors')" style="border: none; border-bottom: 3px solid transparent; border-radius: 0; padding: 12px 24px; font-weight: 600; color: #6c757d;">Vendors</button>
                        </div>

                        <!-- Parts Catalog Tab -->
                        <div id="dmPartsTab">
                            <div style="display: flex; gap: 12px; margin-bottom: 16px;">
                                <input type="text" id="dmPartsSearch" class="form-input" placeholder="Search parts by name, number, or category..." oninput="filterAdminParts()" style="flex: 1;">
                                <select id="dmPartsCategoryFilter" class="form-select" onchange="filterAdminParts()" style="width: 200px;">
                                    <option value="">All Categories</option>
                                </select>
                                <button class="btn btn-primary" onclick="showAddPartModal()">+ Add Part</button>
                            </div>
                            <div class="card">
                                <div class="card-body" style="padding: 0;">
                                    <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                                        <thead>
                                            <tr style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                                                <th style="padding: 10px 12px; text-align: left; font-weight: 600; color: #495057;">Part #</th>
                                                <th style="padding: 10px 12px; text-align: left; font-weight: 600; color: #495057;">Name</th>
                                                <th style="padding: 10px 12px; text-align: left; font-weight: 600; color: #495057;">Category</th>
                                                <th style="padding: 10px 12px; text-align: left; font-weight: 600; color: #495057;">Vendor</th>
                                                <th style="padding: 10px 12px; text-align: right; font-weight: 600; color: #495057;">Price</th>
                                                <th style="padding: 10px 12px; text-align: center; font-weight: 600; color: #495057; width: 100px;">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="dmPartsTableBody"></tbody>
                                    </table>
                                    <div id="dmPartsCount" style="padding: 12px 16px; font-size: 13px; color: #6c757d; border-top: 1px solid #dee2e6;"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Import Pricing Tab -->
                        <div id="dmImportTab" class="hidden">
                            <div class="card">
                                <div class="card-header">
                                    <h2 class="card-title">Import Vendor Pricing CSV</h2>
                                </div>
                                <div class="card-body">
                                    <p style="color: #6c757d; margin-bottom: 16px;">Upload a CSV file from a vendor to update pricing. The CSV should include columns for Part Number and Price at minimum.</p>
                                    <div class="form-group">
                                        <label class="form-label">Vendor</label>
                                        <select id="importVendor" class="form-select">
                                            <option value="">Select vendor...</option>
                                            <option value="Hussey">Hussey Seating Co</option>
                                            <option value="Draper">Draper</option>
                                            <option value="Interkal">Interkal</option>
                                            <option value="Porter">Porter</option>
                                            <option value="Jaypro">Jaypro</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Effective Date</label>
                                        <input type="date" id="importEffectiveDate" class="form-input">
                                    </div>
                                    <div id="csvDropZone" style="border: 2px dashed #dee2e6; border-radius: 12px; padding: 48px; text-align: center; cursor: pointer; margin-bottom: 16px; transition: border-color 0.2s;" onclick="document.getElementById('csvFileInput').click();" ondragover="event.preventDefault(); this.style.borderColor='#4f46e5';" ondragleave="this.style.borderColor='#dee2e6';" ondrop="event.preventDefault(); this.style.borderColor='#dee2e6'; handleCsvDrop(event);">
                                        <div style="font-size: 48px; margin-bottom: 12px;">üìÑ</div>
                                        <p style="font-size: 16px; font-weight: 600; margin-bottom: 4px;">Drop CSV file here or click to browse</p>
                                        <p style="font-size: 13px; color: #6c757d;">Supports .csv files</p>
                                        <input type="file" id="csvFileInput" accept=".csv" style="display: none;" onchange="handleCsvFile(this.files[0])">
                                    </div>
                                    <div id="csvPreview" class="hidden">
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                            <h3 style="font-size: 16px; font-weight: 600;">Preview Changes</h3>
                                            <span id="csvPreviewCount" style="font-size: 13px; color: #6c757d;"></span>
                                        </div>
                                        <div style="max-height: 400px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 8px;">
                                            <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                                                <thead>
                                                    <tr style="background: #f8f9fa; border-bottom: 2px solid #dee2e6; position: sticky; top: 0;">
                                                        <th style="padding: 10px 12px; text-align: left;">Part #</th>
                                                        <th style="padding: 10px 12px; text-align: left;">Name</th>
                                                        <th style="padding: 10px 12px; text-align: right;">Current Price</th>
                                                        <th style="padding: 10px 12px; text-align: right;">New Price</th>
                                                        <th style="padding: 10px 12px; text-align: right;">Change</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="csvPreviewBody"></tbody>
                                            </table>
                                        </div>
                                        <div style="display: flex; gap: 12px; margin-top: 16px;">
                                            <button class="btn btn-primary" onclick="applyCsvImport()">Apply Price Updates</button>
                                            <button class="btn btn-secondary" onclick="cancelCsvImport()">Cancel</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Import History -->
                            <div class="card" style="margin-top: 24px;">
                                <div class="card-header">
                                    <h2 class="card-title">Import History</h2>
                                </div>
                                <div class="card-body" style="padding: 0;">
                                    <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                                        <thead>
                                            <tr style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                                                <th style="padding: 10px 12px; text-align: left;">Date</th>
                                                <th style="padding: 10px 12px; text-align: left;">Vendor</th>
                                                <th style="padding: 10px 12px; text-align: left;">File</th>
                                                <th style="padding: 10px 12px; text-align: right;">Parts Updated</th>
                                                <th style="padding: 10px 12px; text-align: left;">Imported By</th>
                                            </tr>
                                        </thead>
                                        <tbody id="importHistoryBody">
                                            <tr style="border-bottom: 1px solid #f0f2f5;">
                                                <td style="padding: 10px 12px;">Jan 28, 2026</td>
                                                <td style="padding: 10px 12px;">Hussey</td>
                                                <td style="padding: 10px 12px;">2025 Price Guide For BS.csv</td>
                                                <td style="padding: 10px 12px; text-align: right;">2,142</td>
                                                <td style="padding: 10px 12px;">Christian</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Vendors Tab -->
                        <div id="dmVendorsTab" class="hidden">
                            <div style="display: flex; justify-content: flex-end; margin-bottom: 16px;">
                                <button class="btn btn-primary" onclick="showAddVendorModal()">+ Add Vendor</button>
                            </div>
                            <div id="vendorsList"></div>
                        </div>
                    </div>

                    <!-- Add/Edit Part Modal -->
                    <div id="partModal" class="hidden" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center;">
                        <div style="background: white; border-radius: 12px; padding: 32px; width: 100%; max-width: 500px; max-height: 90vh; overflow-y: auto;">
                            <h2 style="margin-bottom: 24px; font-size: 20px;" id="partModalTitle">Add Part</h2>
                            <div class="form-group">
                                <label class="form-label">Part Number</label>
                                <input type="text" id="partNumInput" class="form-input" placeholder="e.g. HUS-12345">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Name / Description *</label>
                                <input type="text" id="partNameInput" class="form-input" placeholder="Part name">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Category</label>
                                <select id="partCategoryInput" class="form-select">
                                    <option value="">Select...</option>
                                    <option value="Power & Electrical">Power & Electrical</option>
                                    <option value="Hardware">Hardware</option>
                                    <option value="Frames & Supports">Frames & Supports</option>
                                    <option value="Rails & Steps">Rails & Steps</option>
                                    <option value="Seating">Seating</option>
                                    <option value="Rollout Parts">Rollout Parts</option>
                                    <option value="Stanchions">Stanchions</option>
                                    <option value="Lumber & Decking">Lumber & Decking</option>
                                    <option value="Portable & Skids">Portable & Skids</option>
                                    <option value="Flex Row Parts">Flex Row Parts</option>
                                    <option value="Panels & Closures">Panels & Closures</option>
                                    <option value="Controls & Safety">Controls & Safety</option>
                                    <option value="Wheels & Bearings">Wheels & Bearings</option>
                                    <option value="Tools">Tools</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Vendor *</label>
                                <select id="partVendorInput" class="form-select">
                                    <option value="Hussey">Hussey</option>
                                    <option value="Draper">Draper</option>
                                    <option value="Interkal">Interkal</option>
                                    <option value="Porter">Porter</option>
                                    <option value="Jaypro">Jaypro</option>
                                    <option value="Irwin">Irwin</option>
                                    <option value="Kodiak">Kodiak</option>
                                    <option value="Duckbill">Duckbill</option>
                                    <option value="APDC">APDC</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Price ($)</label>
                                <input type="number" id="partPriceInput" class="form-input" placeholder="0.00" step="0.01">
                            </div>
                            <div style="display: flex; gap: 12px; margin-top: 24px;">
                                <button class="btn btn-primary" onclick="savePart()" style="flex: 1;">Save</button>
                                <button class="btn btn-secondary" onclick="closePartModal()" style="flex: 1;">Cancel</button>
                            </div>
                        </div>
                    </div>

                    <!-- Add Vendor Modal -->
                    <div id="vendorModal" class="hidden" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center;">
                        <div style="background: white; border-radius: 12px; padding: 32px; width: 100%; max-width: 500px;">
                            <h2 style="margin-bottom: 24px; font-size: 20px;" id="vendorModalTitle">Add Vendor</h2>
                            <div class="form-group">
                                <label class="form-label">Vendor Name *</label>
                                <input type="text" id="vendorNameInput" class="form-input" placeholder="e.g. Hussey Seating Co">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Contact Name</label>
                                <input type="text" id="vendorContactInput" class="form-input" placeholder="Sales rep name">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Phone</label>
                                <input type="tel" id="vendorPhoneInput" class="form-input" placeholder="(555) 555-1234">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Email</label>
                                <input type="email" id="vendorEmailInput" class="form-input" placeholder="vendor@company.com">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Tier</label>
                                <select id="vendorTierInput" class="form-select">
                                    <option value="1">Tier 1 - Primary Partner</option>
                                    <option value="2">Tier 2 - Secondary</option>
                                    <option value="3">Tier 3 - Occasional/Specialty</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Notes</label>
                                <textarea id="vendorNotesInput" class="form-input" rows="2" placeholder="Territory, specialties, etc."></textarea>
                            </div>
                            <div style="display: flex; gap: 12px; margin-top: 24px;">
                                <button class="btn btn-primary" onclick="saveVendor()" style="flex: 1;">Save</button>
                                <button class="btn btn-secondary" onclick="closeVendorModal()" style="flex: 1;">Cancel</button>
                            </div>
                        </div>
                    </div>

                    <!-- Work Order Detail View (Office Staff - Read-only with Edit buttons) -->
                    <div id="workOrderDetailView" class="hidden">
                        <div class="page-header">
                            <button class="btn btn-secondary" onclick="showView('officeSearch')">‚Üê Back</button>
                            <div style="display: flex; align-items: center; gap: 12px; margin-top: 16px;">
                                <h1 class="page-title" style="margin: 0;" id="woJobNumber">Job #17208</h1>
                                <span id="woJobTypeBadge" class="badge badge-info">Repair</span>
                                <span id="woStatusBadge" class="badge badge-success">Parts Received</span>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 300px; gap: 24px;">
                            <!-- Main Column -->
                            <div>
                                <!-- Job Info Card (Read-Only - matches Field Staff layout) -->
                                <div class="card" style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);">
                                    <div class="card-body">
                                        <!-- Location Section -->
                                        <div id="woLocationSection" style="margin-bottom: 20px;">
                                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                                <p style="font-size: 12px; color: #6c757d; margin-bottom: 4px; text-transform: uppercase; font-weight: 600;">Location</p>
                                                <button class="btn btn-sm" onclick="toggleEditSection('location')" style="padding: 4px 12px; font-size: 12px;" id="woLocationEditBtn">Edit</button>
                                            </div>
                                            <!-- Read-only view -->
                                            <div id="woLocationDisplay">
                                                <h2 id="woLocationName" style="font-size: 20px; font-weight: 700; margin-bottom: 4px;">Ripley High School</h2>
                                                <p id="woLocationAddress" style="font-size: 14px; color: #495057;">254 S Jefferson St, Ripley, TN 38063</p>
                                                <a id="woDirectionsLink" href="https://maps.google.com/?q=254+S+Jefferson+St+Ripley+TN+38063" target="_blank"
                                                   style="display: inline-flex; align-items: center; gap: 6px; margin-top: 8px; color: #0066cc; font-weight: 600; text-decoration: none;">
                                                    üó∫Ô∏è Get Directions
                                                </a>
                                            </div>
                                            <!-- Edit view -->
                                            <div id="woLocationEdit" class="hidden" style="margin-top: 8px;">
                                                <select id="woCustomerLocation" class="form-select" style="font-size: 16px; font-weight: 600; margin-bottom: 8px;" onchange="updateOfficeWorkOrderLocation()">
                                                    <option value="">Select customer & location...</option>
                                                </select>
                                                <input type="text" id="woLocationAddressInput" class="form-input" placeholder="Address" style="margin-top: 8px;">
                                                <div style="margin-top: 12px;">
                                                    <button class="btn btn-primary btn-sm" onclick="saveSection('location')" style="margin-right: 8px;">Save</button>
                                                    <button class="btn btn-secondary btn-sm" onclick="cancelEditSection('location')">Cancel</button>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Site Contact Section -->
                                        <div id="woContactSection" style="margin-bottom: 20px; padding: 12px; background: white; border-radius: 8px;">
                                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                                <p style="font-size: 12px; color: #6c757d; margin-bottom: 4px; text-transform: uppercase; font-weight: 600;">Site Contact</p>
                                                <button class="btn btn-sm" onclick="toggleEditSection('contact')" style="padding: 4px 12px; font-size: 12px;" id="woContactEditBtn">Edit</button>
                                            </div>
                                            <!-- Read-only view -->
                                            <div id="woContactDisplay">
                                                <p id="woContactName" style="font-size: 16px; font-weight: 600; margin-bottom: 4px;">Chris McCorkle</p>
                                                <a id="woContactPhoneLink" href="tel:7316352642" style="color: #0066cc; font-weight: 600; text-decoration: none;">üìû <span id="woContactPhone">(731) 635-2642</span></a>
                                            </div>
                                            <!-- Edit view -->
                                            <div id="woContactEdit" class="hidden" style="margin-top: 8px;">
                                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                                                    <input type="text" id="woContactNameInput" class="form-input" placeholder="Contact name">
                                                    <input type="tel" id="woContactPhoneInput" class="form-input" placeholder="Phone number">
                                                </div>
                                                <div style="margin-top: 12px;">
                                                    <button class="btn btn-primary btn-sm" onclick="saveSection('contact')" style="margin-right: 8px;">Save</button>
                                                    <button class="btn btn-secondary btn-sm" onclick="cancelEditSection('contact')">Cancel</button>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Job Description Section -->
                                        <div id="woDescriptionSection" style="margin-bottom: 20px; padding: 16px; background: white; border-radius: 8px; border-left: 4px solid #4CAF50;">
                                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                                <p style="font-size: 12px; color: #6c757d; margin-bottom: 8px; text-transform: uppercase; font-weight: 600;">What They're Doing</p>
                                                <button class="btn btn-sm" onclick="toggleEditSection('description')" style="padding: 4px 12px; font-size: 12px;" id="woDescriptionEditBtn">Edit</button>
                                            </div>
                                            <!-- Read-only view -->
                                            <div id="woDescriptionDisplay">
                                                <p id="woDescription" style="font-size: 16px; line-height: 1.5;">Install safety strap on Goal 5. Lift rental required - 40' lift will be on site.</p>
                                            </div>
                                            <!-- Edit view -->
                                            <div id="woDescriptionEdit" class="hidden">
                                                <textarea id="woDescriptionInput" class="form-input" rows="3" style="font-size: 16px; line-height: 1.5;" placeholder="Job description..."></textarea>
                                                <div style="margin-top: 12px;">
                                                    <button class="btn btn-primary btn-sm" onclick="saveSection('description')" style="margin-right: 8px;">Save</button>
                                                    <button class="btn btn-secondary btn-sm" onclick="cancelEditSection('description')">Cancel</button>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Parts Location Section -->
                                        <div id="woPartsSection" style="padding: 12px; background: #fff3e0; border-radius: 8px; border-left: 4px solid #ff9800;">
                                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                                <p style="font-size: 12px; color: #e65100; margin-bottom: 4px; text-transform: uppercase; font-weight: 600;">üì¶ Parts Location</p>
                                                <button class="btn btn-sm" onclick="toggleEditSection('parts')" style="padding: 4px 12px; font-size: 12px;" id="woPartsEditBtn">Edit</button>
                                            </div>
                                            <!-- Read-only view -->
                                            <div id="woPartsDisplay">
                                                <p id="woPartsLocation" style="font-size: 14px; font-weight: 600; color: #e65100;">Floyd's house - dropping at Millington HS</p>
                                            </div>
                                            <!-- Edit view -->
                                            <div id="woPartsEdit" class="hidden">
                                                <input type="text" id="woPartsLocationInput" class="form-input" placeholder="Where are the parts?" style="background: white;">
                                                <div style="margin-top: 12px;">
                                                    <button class="btn btn-primary btn-sm" onclick="saveSection('parts')" style="margin-right: 8px;">Save</button>
                                                    <button class="btn btn-secondary btn-sm" onclick="cancelEditSection('parts')">Cancel</button>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Special Instructions Section -->
                                        <div id="woInstructionsSection" style="margin-top: 16px; padding: 12px; background: #e3f2fd; border-radius: 8px; border-left: 4px solid #2196F3;">
                                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                                <p style="font-size: 12px; color: #1565c0; margin-bottom: 4px; text-transform: uppercase; font-weight: 600;">‚ö†Ô∏è Special Instructions</p>
                                                <button class="btn btn-sm" onclick="toggleEditSection('instructions')" style="padding: 4px 12px; font-size: 12px;" id="woInstructionsEditBtn">Edit</button>
                                            </div>
                                            <!-- Read-only view -->
                                            <div id="woInstructionsDisplay">
                                                <p id="woSpecialInstructions" style="font-size: 14px; color: #1565c0;">Customer will have gym cleared by 8am. Enter through back door - front office doesn't open until 9.</p>
                                            </div>
                                            <!-- Edit view -->
                                            <div id="woInstructionsEdit" class="hidden">
                                                <textarea id="woSpecialInstructionsInput" class="form-input" rows="2" placeholder="Equipment needs, access instructions, etc." style="background: white;"></textarea>
                                                <div style="margin-top: 12px;">
                                                    <button class="btn btn-primary btn-sm" onclick="saveSection('instructions')" style="margin-right: 8px;">Save</button>
                                                    <button class="btn btn-secondary btn-sm" onclick="cancelEditSection('instructions')">Cancel</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Scheduling & Assignment Card -->
                                <div class="card">
                                    <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                                        <h2 class="card-title" style="margin: 0;">Scheduling & Assignment</h2>
                                        <button class="btn btn-sm" onclick="toggleEditSection('scheduling')" style="padding: 4px 12px; font-size: 12px;" id="woSchedulingEditBtn">Edit</button>
                                    </div>
                                    <div class="card-body">
                                        <!-- Read-only view -->
                                        <div id="woSchedulingDisplay">
                                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px;">
                                                <div>
                                                    <p style="font-size: 12px; color: #6c757d; margin-bottom: 4px;">Scheduled Date</p>
                                                    <p id="woScheduledDateDisplay" style="font-weight: 600;">Jan 22, 2026</p>
                                                </div>
                                                <div>
                                                    <p style="font-size: 12px; color: #6c757d; margin-bottom: 4px;">Scheduled Time</p>
                                                    <p id="woScheduledTimeDisplay" style="font-weight: 600;">8:00 AM</p>
                                                </div>
                                                <div>
                                                    <p style="font-size: 12px; color: #6c757d; margin-bottom: 4px;">Assigned To</p>
                                                    <p id="woAssignedToDisplay" style="font-weight: 600;">TNBSTeam 2</p>
                                                </div>
                                            </div>
                                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; margin-top: 16px;">
                                                <div>
                                                    <p style="font-size: 12px; color: #6c757d; margin-bottom: 4px;">Confirmed With</p>
                                                    <p id="woConfirmedWithDisplay" style="font-weight: 600;">Mike Mann</p>
                                                </div>
                                                <div>
                                                    <p style="font-size: 12px; color: #6c757d; margin-bottom: 4px;">Confirmed By</p>
                                                    <p id="woConfirmedByDisplay" style="font-weight: 600;">Savannah Kirkland</p>
                                                </div>
                                                <div>
                                                    <p style="font-size: 12px; color: #6c757d; margin-bottom: 4px;">Confirmation Date</p>
                                                    <p id="woConfirmedDateDisplay" style="font-weight: 600;">Jan 23, 2026</p>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- Edit view -->
                                        <div id="woSchedulingEdit" class="hidden">
                                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px;">
                                                <div class="form-group">
                                                    <label class="form-label">Scheduled Date</label>
                                                    <input type="date" id="woScheduledDate" class="form-input" value="2026-01-22">
                                                </div>
                                                <div class="form-group">
                                                    <label class="form-label">Scheduled Time</label>
                                                    <input type="time" id="woScheduledTime" class="form-input" value="08:00">
                                                </div>
                                                <div class="form-group">
                                                    <label class="form-label">Assigned To</label>
                                                    <select id="woAssignedTo" class="form-select">
                                                        <option value="">Select tech/team</option>
                                                        <option value="TNBSTeam 1">TNBSTeam 1</option>
                                                        <option value="TNBSTeam 2" selected>TNBSTeam 2</option>
                                                        <option value="ALBSTeam 1">ALBSTeam 1</option>
                                                        <option value="ALBSTeam 2">ALBSTeam 2</option>
                                                        <option value="Danny Mendl">Danny Mendl</option>
                                                        <option value="Floyd Jackson">Floyd Jackson</option>
                                                        <option value="Lisa Cunningham">Lisa Cunningham</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; margin-top: 16px;">
                                                <div class="form-group">
                                                    <label class="form-label">Confirmed With</label>
                                                    <input type="text" id="woConfirmedWith" class="form-input" placeholder="Customer contact">
                                                </div>
                                                <div class="form-group">
                                                    <label class="form-label">Confirmed By</label>
                                                    <input type="text" id="woConfirmedBy" class="form-input" placeholder="Office staff">
                                                </div>
                                                <div class="form-group">
                                                    <label class="form-label">Confirmation Date</label>
                                                    <input type="date" id="woConfirmedDate" class="form-input">
                                                </div>
                                            </div>
                                            <div style="margin-top: 16px;">
                                                <button class="btn btn-primary btn-sm" onclick="saveSection('scheduling')" style="margin-right: 8px;">Save</button>
                                                <button class="btn btn-secondary btn-sm" onclick="cancelEditSection('scheduling')">Cancel</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Completion Summary Card (Office View) -->
                                <div class="card">
                                    <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                                        <h2 class="card-title" style="margin: 0;">Completion Summary</h2>
                                        <button class="btn btn-sm" onclick="toggleEditSection('completionSummary')" style="padding: 4px 12px; font-size: 12px;" id="woCompletionSummaryEditBtn">Edit</button>
                                    </div>
                                    <div class="card-body">
                                        <!-- Read-only view -->
                                        <div id="woCompletionSummaryDisplay">
                                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px;">
                                                <div>
                                                    <p style="font-size: 12px; color: #6c757d; margin-bottom: 4px;">Job Status</p>
                                                    <p id="woCompletedDisplay" style="font-weight: 600;">‚Äî</p>
                                                </div>
                                                <div>
                                                    <p style="font-size: 12px; color: #6c757d; margin-bottom: 4px;">Hours Worked</p>
                                                    <p id="woHoursWorkedDisplay" style="font-weight: 600;">‚Äî</p>
                                                </div>
                                                <div>
                                                    <p style="font-size: 12px; color: #6c757d; margin-bottom: 4px;">Completed By</p>
                                                    <p id="woCompletedByDisplay" style="font-weight: 600;">‚Äî</p>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- Edit view -->
                                        <div id="woCompletionSummaryEdit" class="hidden">
                                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px;">
                                                <div class="form-group">
                                                    <label class="form-label">Job Status</label>
                                                    <select id="woCompleted" class="form-select">
                                                        <option value="">Select...</option>
                                                        <option value="yes">Completed</option>
                                                        <option value="no">Not Completed (Pink Job)</option>
                                                    </select>
                                                </div>
                                                <div class="form-group">
                                                    <label class="form-label">Hours Worked</label>
                                                    <input type="number" id="woHoursWorked" class="form-input" step="0.5" placeholder="e.g., 4.5">
                                                </div>
                                                <div class="form-group">
                                                    <label class="form-label">Completed By</label>
                                                    <input type="text" id="woCompletedBy" class="form-input" placeholder="Tech name(s)">
                                                </div>
                                            </div>
                                            <div style="margin-top: 16px;">
                                                <button class="btn btn-primary btn-sm" onclick="saveSection('completionSummary')" style="margin-right: 8px;">Save</button>
                                                <button class="btn btn-secondary btn-sm" onclick="cancelEditSection('completionSummary')">Cancel</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Completion Photos Card (Matches Field Staff) -->
                                <div class="card">
                                    <div class="card-header" style="background: #4CAF50; color: white;">
                                        <h2 class="card-title" style="color: white; margin: 0;">üì∑ Completion Photos & Notes</h2>
                                    </div>
                                    <div class="card-body">
                                        <!-- Required Photo Upload -->
                                        <div class="form-group">
                                            <label class="form-label" style="font-weight: 700;">
                                                üì∑ Completed Work Photo <span style="color: #dc3545;">*Required</span>
                                            </label>
                                            <p style="font-size: 13px; color: #6c757d; margin-bottom: 12px;">Photo showing the completed work</p>
                                            <div id="woPhotoUploadArea" style="border: 2px dashed #dee2e6; border-radius: 8px; padding: 40px; text-align: center; cursor: pointer; background: #f8f9fa;"
                                                 onclick="document.getElementById('woPhotoInput').click()">
                                                <div style="font-size: 48px; margin-bottom: 12px;">üì∑</div>
                                                <p style="font-weight: 600; color: #495057;">Click to upload photo</p>
                                                <input type="file" id="woPhotoInput" accept="image/*" style="display: none;" onchange="handleOfficePhotoUpload(event, 'main')">
                                            </div>
                                            <div id="woPhotoPreview" class="hidden" style="margin-top: 12px;"></div>
                                        </div>

                                        <!-- Additional Photos -->
                                        <div class="form-group" style="margin-top: 20px;">
                                            <label class="form-label">üì∑ Additional Photos (Optional)</label>
                                            <p style="font-size: 13px; color: #6c757d; margin-bottom: 12px;">Add more photos if needed (issues found, before/after, etc.)</p>
                                            <div style="border: 2px dashed #dee2e6; border-radius: 8px; padding: 20px; text-align: center; cursor: pointer; background: #f8f9fa;"
                                                 onclick="document.getElementById('woAdditionalPhotos').click()">
                                                <p style="color: #6c757d;">+ Add more photos</p>
                                                <input type="file" id="woAdditionalPhotos" accept="image/*" multiple style="display: none;" onchange="handleOfficePhotoUpload(event, 'additional')">
                                            </div>
                                            <div id="woAdditionalPhotosPreview" style="display: flex; flex-wrap: wrap; gap: 12px; margin-top: 12px;"></div>
                                        </div>

                                        <!-- Required Notes -->
                                        <div class="form-group" style="margin-top: 20px;">
                                            <label class="form-label" style="font-weight: 700;">
                                                üìù Completion Notes <span style="color: #dc3545;">*Required</span>
                                            </label>
                                            <p style="font-size: 13px; color: #6c757d; margin-bottom: 12px;">Describe work completed</p>
                                            <textarea id="woCompletionNotes" class="form-input" rows="4"
                                                      placeholder="Example: Installed safety strap on Goal 5. Tested operation - working properly. No additional issues found."
                                                      style="font-size: 16px;"></textarea>
                                        </div>

                                        <!-- Action Buttons -->
                                        <div style="margin-top: 24px;">
                                            <button class="btn btn-primary btn-lg" onclick="submitOfficeJobCompleted()"
                                                    style="width: 100%; padding: 16px; font-size: 16px; background: #4CAF50; border-color: #4CAF50;">
                                                ‚úÖ Mark Job Completed
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Not Completed Section (Matches Field Staff) -->
                                <div class="card">
                                    <div class="card-header" style="background: #dc3545; color: white;">
                                        <h2 class="card-title" style="color: white; margin: 0;">‚ùå Job Not Completed</h2>
                                    </div>
                                    <div class="card-body">
                                        <p style="font-size: 14px; color: #6c757d; margin-bottom: 16px;">If the job couldn't be completed, document what happened:</p>

                                        <!-- Reason Buttons -->
                                        <div id="woReasonButtons" style="display: flex; flex-direction: column; gap: 10px;">
                                            <button type="button" onclick="selectOfficeNotCompletedReason('wrong_part')" class="reason-btn"
                                                    style="padding: 16px 20px; border: 2px solid #dee2e6; border-radius: 8px; background: white; text-align: left; cursor: pointer; font-size: 15px; transition: all 0.15s;">
                                                <span style="font-size: 20px; margin-right: 12px;">üîß</span>
                                                <strong>Wrong or Missing Part</strong>
                                            </button>
                                            <button type="button" onclick="selectOfficeNotCompletedReason('access')" class="reason-btn"
                                                    style="padding: 16px 20px; border: 2px solid #dee2e6; border-radius: 8px; background: white; text-align: left; cursor: pointer; font-size: 15px; transition: all 0.15s;">
                                                <span style="font-size: 20px; margin-right: 12px;">üö™</span>
                                                <strong>Can't Access Site</strong>
                                            </button>
                                            <button type="button" onclick="selectOfficeNotCompletedReason('more_work')" class="reason-btn"
                                                    style="padding: 16px 20px; border: 2px solid #dee2e6; border-radius: 8px; background: white; text-align: left; cursor: pointer; font-size: 15px; transition: all 0.15s;">
                                                <span style="font-size: 20px; margin-right: 12px;">‚ö†Ô∏è</span>
                                                <strong>Additional Work Needed</strong>
                                            </button>
                                            <button type="button" onclick="selectOfficeNotCompletedReason('equipment')" class="reason-btn"
                                                    style="padding: 16px 20px; border: 2px solid #dee2e6; border-radius: 8px; background: white; text-align: left; cursor: pointer; font-size: 15px; transition: all 0.15s;">
                                                <span style="font-size: 20px; margin-right: 12px;">üèóÔ∏è</span>
                                                <strong>Equipment Issue</strong>
                                            </button>
                                            <button type="button" onclick="selectOfficeNotCompletedReason('other')" class="reason-btn"
                                                    style="padding: 16px 20px; border: 2px solid #dee2e6; border-radius: 8px; background: white; text-align: left; cursor: pointer; font-size: 15px; transition: all 0.15s;">
                                                <span style="font-size: 20px; margin-right: 12px;">üìù</span>
                                                <strong>Other</strong>
                                            </button>
                                        </div>
                                        <input type="hidden" id="woNotCompletedReason" value="">

                                        <!-- Details Section (shown after reason selected) -->
                                        <div id="woReasonDetails" class="hidden" style="margin-top: 20px;">

                                            <!-- Selected reason header -->
                                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; padding: 12px; background: #ffebee; border-radius: 8px;">
                                                <span id="woSelectedReasonText" style="font-weight: 600; color: #c62828;"></span>
                                                <button type="button" onclick="changeOfficeReason()" style="background: none; border: none; color: #1976d2; cursor: pointer; font-size: 14px;">Change</button>
                                            </div>

                                            <!-- Wrong Part Section -->
                                            <div id="woWrongPartSection" class="hidden" style="margin-bottom: 16px; padding: 16px; background: #fff8e1; border-radius: 8px; border: 2px solid #ff9800;">
                                                <h4 style="font-size: 15px; font-weight: 700; color: #e65100; margin-bottom: 16px;">üìê Measurements & Photo Required</h4>

                                                <div class="form-group">
                                                    <label class="form-label" style="font-weight: 600;">Measurements of Correct Part</label>
                                                    <textarea id="woWrongPartMeasurements" class="form-input" rows="3"
                                                              placeholder="Length, width, thickness, hole spacing, bolt size..."
                                                              style="font-size: 16px;"></textarea>
                                                </div>

                                                <div class="form-group" style="margin-top: 16px;">
                                                    <label class="form-label" style="font-weight: 600;">üì∑ Photo of a CORRECT Part</label>
                                                    <p style="font-size: 12px; color: #6c757d; margin-bottom: 8px;">Photo of a working part that needs to be matched</p>
                                                    <div id="woWrongPartPhotoArea" style="border: 2px dashed #ff9800; border-radius: 8px; padding: 20px; text-align: center; cursor: pointer; background: white;"
                                                         onclick="document.getElementById('woWrongPartPhotoInput').click()">
                                                        <span style="font-size: 28px;">üì∑</span>
                                                        <p style="font-weight: 600; color: #e65100; margin-top: 8px;">Click to upload photo of working part</p>
                                                        <input type="file" id="woWrongPartPhotoInput" accept="image/*" style="display: none;" onchange="handleOfficeWrongPartPhoto(event, 'correct')">
                                                    </div>
                                                    <div id="woWrongPartPhotoPreview" class="hidden" style="margin-top: 12px;"></div>
                                                </div>

                                                <div class="form-group" style="margin-top: 12px;">
                                                    <div style="border: 1px dashed #dee2e6; border-radius: 8px; padding: 12px; text-align: center; cursor: pointer; background: white;"
                                                         onclick="document.getElementById('woWrongPartSentPhotoInput').click()">
                                                        <span style="color: #6c757d; font-size: 14px;">+ Photo of wrong part sent (optional)</span>
                                                        <input type="file" id="woWrongPartSentPhotoInput" accept="image/*" style="display: none;" onchange="handleOfficeWrongPartPhoto(event, 'wrong')">
                                                    </div>
                                                    <div id="woWrongPartSentPhotoPreview" style="margin-top: 8px;"></div>
                                                </div>
                                            </div>

                                            <!-- More Work Section - needs a photo -->
                                            <div id="woMoreWorkSection" class="hidden" style="margin-bottom: 16px; padding: 16px; background: #e3f2fd; border-radius: 8px; border: 2px solid #2196f3;">
                                                <h4 style="font-size: 15px; font-weight: 700; color: #1565c0; margin-bottom: 12px;">üì∑ Photo of the Issue</h4>
                                                <div id="woMoreWorkPhotoArea" style="border: 2px dashed #2196f3; border-radius: 8px; padding: 20px; text-align: center; cursor: pointer; background: white;"
                                                     onclick="document.getElementById('woMoreWorkPhotoInput').click()">
                                                    <span style="font-size: 28px;">üì∑</span>
                                                    <p style="font-weight: 600; color: #1565c0; margin-top: 8px;">Click to upload photo of the damage/issue</p>
                                                    <input type="file" id="woMoreWorkPhotoInput" accept="image/*" style="display: none;" onchange="handleOfficeMoreWorkPhoto(event)">
                                                </div>
                                                <div id="woMoreWorkPhotoPreview" class="hidden" style="margin-top: 12px;"></div>
                                            </div>

                                            <!-- Notes field -->
                                            <div class="form-group">
                                                <label class="form-label" style="font-weight: 600;">
                                                    Notes <span id="woNotesRequired" style="color: #dc3545;">*Required</span>
                                                </label>
                                                <textarea id="woNotCompletedDetails" class="form-input" rows="3"
                                                          placeholder="Explain what happened..."
                                                          style="font-size: 16px;"></textarea>
                                            </div>

                                            <button class="btn" onclick="submitOfficeJobNotCompleted()"
                                                    style="width: 100%; padding: 16px; font-size: 16px; background: #c62828; border-color: #c62828; color: white; margin-top: 16px;">
                                                Mark as Pink Job
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Right Column -->
                            <div>
                                <!-- Actions Card -->
                                <div class="card">
                                    <div class="card-header">
                                        <h2 class="card-title">Actions</h2>
                                    </div>
                                    <div class="card-body">
                                        <button class="btn btn-outline" style="width: 100%; margin-bottom: 12px;">üìÑ Print Work Order</button>
                                        <button class="btn btn-outline" style="width: 100%; margin-bottom: 12px;">üìß Email to Tech</button>
                                        <button class="btn btn-secondary" style="width: 100%;">‚úÖ Mark Complete</button>
                                    </div>
                                </div>

                                <!-- Timeline Card -->
                                <div class="card">
                                    <div class="card-header">
                                        <h2 class="card-title">Timeline</h2>
                                    </div>
                                    <div class="card-body" style="font-size: 13px;">
                                        <div style="border-left: 2px solid #e9ecef; padding-left: 16px; margin-left: 8px;">
                                            <div style="margin-bottom: 16px; position: relative;">
                                                <div style="position: absolute; left: -22px; top: 0; width: 12px; height: 12px; background: #4CAF50; border-radius: 50%;"></div>
                                                <div style="font-weight: 600;">Estimate Created</div>
                                                <div style="color: #6c757d;">Jan 15, 2026 ‚Ä¢ Lisa</div>
                                            </div>
                                            <div style="margin-bottom: 16px; position: relative;">
                                                <div style="position: absolute; left: -22px; top: 0; width: 12px; height: 12px; background: #4CAF50; border-radius: 50%;"></div>
                                                <div style="font-weight: 600;">Customer Accepted</div>
                                                <div style="color: #6c757d;">Jan 18, 2026</div>
                                            </div>
                                            <div style="margin-bottom: 16px; position: relative;">
                                                <div style="position: absolute; left: -22px; top: 0; width: 12px; height: 12px; background: #4CAF50; border-radius: 50%;"></div>
                                                <div style="font-weight: 600;">Parts Ordered</div>
                                                <div style="color: #6c757d;">Jan 19, 2026 ‚Ä¢ Charles</div>
                                            </div>
                                            <div style="margin-bottom: 16px; position: relative;">
                                                <div style="position: absolute; left: -22px; top: 0; width: 12px; height: 12px; background: #4CAF50; border-radius: 50%;"></div>
                                                <div style="font-weight: 600;">Parts Received</div>
                                                <div style="color: #6c757d;">Jan 21, 2026 ‚Ä¢ Samantha</div>
                                            </div>
                                            <div style="margin-bottom: 16px; position: relative;">
                                                <div style="position: absolute; left: -22px; top: 0; width: 12px; height: 12px; background: #2196F3; border-radius: 50%;"></div>
                                                <div style="font-weight: 600;">Job Confirmed</div>
                                                <div style="color: #6c757d;">Jan 23, 2026 ‚Ä¢ Savannah</div>
                                            </div>
                                            <div style="position: relative;">
                                                <div style="position: absolute; left: -22px; top: 0; width: 12px; height: 12px; background: #e9ecef; border-radius: 50%; border: 2px solid #2196F3;"></div>
                                                <div style="font-weight: 600; color: #2196F3;">Scheduled</div>
                                                <div style="color: #6c757d;">Jan 22, 2026</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Related Docs Card -->
                                <div class="card">
                                    <div class="card-header">
                                        <h2 class="card-title">Documents</h2>
                                    </div>
                                    <div class="card-body">
                                        <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                                            <div style="text-align: center; padding: 12px; background: #f8f9fa; border-radius: 8px; cursor: pointer;">
                                                <div style="font-size: 32px;">üìÑ</div>
                                                <div style="font-size: 12px; margin-top: 4px;">Work Order</div>
                                            </div>
                                            <div style="text-align: center; padding: 12px; background: #f8f9fa; border-radius: 8px; cursor: pointer;">
                                                <div style="font-size: 32px;">üìã</div>
                                                <div style="font-size: 12px; margin-top: 4px;">Inspection</div>
                                            </div>
                                            <div style="text-align: center; padding: 12px; background: #f8f9fa; border-radius: 8px; cursor: pointer;">
                                                <div style="font-size: 32px;">üíµ</div>
                                                <div style="font-size: 12px; margin-top: 4px;">Estimate</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Field Staff Dashboard -->
    <div id="techDashboard" class="hidden">
        <div class="app-layout">
            <button class="mobile-menu-btn" onclick="toggleMobileMenu('techSidebar')">
                <img src="bleachers-logo-icon.png" alt="Menu">
            </button>
            <div class="sidebar-backdrop" id="techSidebarBackdrop" onclick="closeMobileMenu('techSidebar')"></div>
            <div class="sidebar" id="techSidebar">
                <div class="sidebar-header" onclick="toggleSidebar('techSidebar')">
                    <img src="bleachers-logo-icon.png" alt="Bleachers & Seats" class="sidebar-logo-icon">
                    <img src="menu-logo-wide.png" alt="Bleachers & Seats" class="sidebar-logo-full">
                    <div class="sidebar-close-btn">‚úï</div>
                </div>
                <div class="sidebar-nav">
                    <div class="nav-item active" onclick="showTechView('search')">
                        <span>üîç</span>
                        <span>Search</span>
                    </div>
                    <div class="nav-item" onclick="showTechView('teamschedule')">
                        <span>üë•</span>
                        <span>Team Schedule</span>
                    </div>
                    <div class="nav-item" onclick="showTechView('myjobs')">
                        <span>üìÖ</span>
                        <span>My Jobs</span>
                    </div>
                    <div class="nav-item" onclick="showTechView('create')">
                        <span>+</span>
                        <span>Create</span>
                    </div>
                </div>
                <div class="sidebar-footer">
                    <div class="user-info" onclick="logout()">
                        <div class="user-avatar">FS</div>
                        <div>
                            <div style="font-size: 14px; font-weight: 600;">Field Staff</div>
                            <div style="font-size: 12px; opacity: 0.7;">Logout</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="main-content">
                <div class="content-area" style="padding-top: 24px;">
                    <!-- Search View -->
                    <div id="techSearchView">
                        <div class="page-header">
                            <h1 class="page-title">Search</h1>
                            <p class="page-subtitle">Find any work order or inspection by school name or job number</p>
                        </div>

                        <div style="margin-bottom: 24px;">
                            <input type="text" id="techSearchInput" class="form-input" placeholder="Search by school name, job #, or keyword..." style="font-size: 16px; padding: 14px 16px;" oninput="performTechSearch()">
                        </div>

                        <div id="techSearchResults">
                            <div style="text-align: center; padding: 60px 20px; color: #6c757d;">
                                <div style="font-size: 48px; margin-bottom: 16px;">üîç</div>
                                <p style="font-size: 15px;">Search for a school, job number, or keyword to find work orders and inspections.</p>
                            </div>
                        </div>
                    </div>

                    <!-- My Jobs View (Personal Weekly Schedule) -->
                    <div id="techMyJobsView" class="hidden">
                        <div class="page-header" style="display: flex; justify-content: space-between; align-items: flex-start;">
                            <div>
                                <h1 class="page-title">My Jobs</h1>
                                <p class="page-subtitle">Your schedule for this week</p>
                            </div>
                            <div style="display: flex; gap: 12px; align-items: center;">
                                <button class="btn btn-outline" onclick="prevMyJobsWeek()" style="padding: 8px 12px;">‚Üê Prev</button>
                                <span id="myJobsWeekLabel" style="font-weight: 600; min-width: 180px; text-align: center;"></span>
                                <button class="btn btn-outline" onclick="nextMyJobsWeek()" style="padding: 8px 12px;">Next ‚Üí</button>
                            </div>
                        </div>

                        <div id="myJobsWeekGrid"></div>
                    </div>

                    <!-- Team Schedule View (Read-Only Full Schedule) -->
                    <div id="techTeamScheduleView" class="hidden">
                        <div class="page-header" style="display: flex; justify-content: space-between; align-items: flex-start;">
                            <div>
                                <h1 class="page-title">Team Schedule</h1>
                                <p class="page-subtitle">Full crew schedule for the week</p>
                            </div>
                            <div style="display: flex; gap: 12px; align-items: center;">
                                <button class="btn btn-outline" onclick="prevTeamWeek()" style="padding: 8px 12px;">‚Üê Prev</button>
                                <span id="teamWeekLabel" style="font-weight: 600; min-width: 180px; text-align: center;"></span>
                                <button class="btn btn-outline" onclick="nextTeamWeek()" style="padding: 8px 12px;">Next ‚Üí</button>
                            </div>
                        </div>

                        <!-- Territory Tabs -->
                        <div style="display: flex; gap: 0; margin-bottom: 20px; border-bottom: 2px solid #e9ecef;">
                            <button class="schedule-tab active" onclick="switchTeamTerritory('original')" id="teamOriginalTab">Original Territory (KY/TN)</button>
                            <button class="schedule-tab" onclick="switchTeamTerritory('southern')" id="teamSouthernTab">Southern Territory (AL/FL)</button>
                        </div>

                        <div id="teamScheduleGrid"></div>
                    </div>

                    <!-- Tech Inspections View (Job List) -->
                    <div id="techInspectionsView" class="hidden">
                        <div class="page-header">
                            <h1 class="page-title">Inspections</h1>
                            <p class="page-subtitle">Create and manage inspection jobs</p>
                        </div>

                        <div style="display: flex; gap: 12px; margin-bottom: 24px;">
                            <button class="btn btn-primary btn-lg" onclick="startNewJob()">+ New Job</button>
                        </div>

                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value" id="inProgressJobsCount">0</div>
                                <div class="stat-label">In Progress</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="submittedJobsCount">0</div>
                                <div class="stat-label">Submitted</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="totalBanksCount">0</div>
                                <div class="stat-label">Banks Inspected</div>
                            </div>
                        </div>

                        <!-- In Progress Jobs -->
                        <div class="card">
                            <div class="card-header" style="background: #fff3e0;">
                                <h2 class="card-title" style="color: #e65100;">üîÑ In Progress</h2>
                            </div>
                            <div class="card-body" id="inProgressJobsList" style="padding: 0;"></div>
                        </div>

                        <!-- Submitted Jobs -->
                        <div class="card">
                            <div class="card-header" style="background: #e8f5e9;">
                                <h2 class="card-title" style="color: #2e7d32;">‚úÖ Submitted</h2>
                            </div>
                            <div class="card-body" id="submittedJobsList" style="padding: 0;"></div>
                        </div>
                    </div>

                    <!-- Create View (Unified Form) -->
                    <div id="techCreateView" class="hidden">
                        <div class="page-header">
                            <h1 class="page-title">Create</h1>
                            <p class="page-subtitle">Start a new job</p>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Job Info</h2>
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label class="form-label">What are you creating? *</label>
                                    <select id="createTypeSelect" class="form-select" onchange="onCreateTypeChange()" style="font-size: 16px; padding: 14px;">
                                        <option value="">Select...</option>
                                        <option value="parts_spec">Parts Spec Form</option>
                                        <option value="work_order">Work Order</option>
                                        <option value="inspection">Inspection</option>
                                    </select>
                                </div>

                                <!-- Everything below hidden until type selected -->
                                <div id="createFormFields" class="hidden">
                                    <div class="form-group">
                                        <label class="form-label">Customer / School *</label>
                                        <select id="createCustomerSelect" class="form-select" onchange="updateCreateCustomerInfo()" style="font-size: 16px; padding: 14px;">
                                            <option value="">Select a customer...</option>
                                        </select>
                                    </div>
                                    <div id="createCustomerInfo" class="hidden" style="background: #f8f9fa; padding: 12px; border-radius: 8px; margin-top: 8px; margin-bottom: 16px;">
                                        <p id="createAddress" style="font-size: 13px; color: #6c757d;"></p>
                                        <p id="createContact" style="font-size: 13px; color: #6c757d; margin-top: 4px;"></p>
                                    </div>

                                    <!-- Inspection-only fields -->
                                    <div id="createInspectionFields" class="hidden">
                                        <div class="form-group">
                                            <label class="form-label">Inspection Type *</label>
                                            <select id="createInspectionType" class="form-select" style="font-size: 16px; padding: 14px;">
                                                <option value="bleacher">Indoor Bleacher Inspection</option>
                                                <option value="outdoor">Outdoor Aluminum Bleacher Inspection</option>
                                                <option value="basketball">Basketball Goal Inspection</option>
                                            </select>
                                        </div>
                                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                            <div class="form-group">
                                                <label class="form-label">Job Number</label>
                                                <input type="text" id="createJobNumber" class="form-input" readonly style="background: #e9ecef; font-weight: 700; font-size: 16px;">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Date</label>
                                                <input type="date" id="createJobDate" class="form-input" style="font-size: 16px; padding: 14px;">
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Work Order-only fields -->
                                    <div id="createWorkOrderFields" class="hidden">
                                        <div class="form-group">
                                            <label class="form-label">Job Type *</label>
                                            <select id="createWoJobType" class="form-select" style="font-size: 16px; padding: 14px;">
                                                <option value="Service Call">Service Call</option>
                                                <option value="Repair">Repair</option>
                                                <option value="Inspection">Inspection</option>
                                                <option value="Go See">Go See</option>
                                            </select>
                                        </div>
                                    </div>

                                    <!-- Description (Work Order + Parts Spec) -->
                                    <div id="createDescriptionGroup" class="hidden">
                                        <div class="form-group">
                                            <label class="form-label">Description *</label>
                                            <textarea id="createDescription" class="form-input" rows="3" placeholder="What needs to be done..." style="font-size: 16px; padding: 14px;"></textarea>
                                        </div>
                                    </div>

                                    <!-- Notes (all types) -->
                                    <div class="form-group">
                                        <label class="form-label">Notes</label>
                                        <textarea id="createNotes" class="form-input" rows="2" placeholder="Any additional details..." style="font-size: 16px; padding: 14px;"></textarea>
                                    </div>

                                    <!-- Photo (Work Order + Parts Spec) -->
                                    <div id="createPhotoGroup" class="hidden">
                                        <div class="form-group">
                                            <label class="form-label">Photo</label>
                                            <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                                                <label style="width: 80px; height: 80px; border: 2px dashed #dee2e6; border-radius: 8px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 24px; color: #adb5bd;">
                                                    üì∑
                                                    <input type="file" accept="image/*" capture="environment" style="display: none;" onchange="handleCreatePhoto(this)">
                                                </label>
                                                <div id="createPhotoPreview"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <button id="createSubmitBtn" class="btn btn-primary btn-lg hidden" onclick="submitCreate()" style="width: 100%; margin-top: 16px; padding: 16px; font-size: 16px;">Create</button>
                    </div>

                    <!-- New Job Setup (used by office-side startNewJob) -->
                    <div id="newJobSetupView" class="hidden">
                        <div class="page-header">
                            <button class="btn btn-secondary" onclick="goBackFromInspection()">‚Üê Back</button>
                            <h1 class="page-title" style="margin-top: 16px;">New Inspection</h1>
                            <p class="page-subtitle">Create a new inspection job</p>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Job Info</h2>
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label class="form-label">Customer / School *</label>
                                    <select id="jobCustomerSelect" class="form-select" onchange="updateJobCustomerInfo()" style="font-size: 16px; padding: 14px;">
                                        <option value="">Select a customer...</option>
                                    </select>
                                </div>
                                <div id="jobCustomerInfo" class="hidden" style="background: #f8f9fa; padding: 12px; border-radius: 8px; margin-top: 8px; margin-bottom: 16px;">
                                    <p id="jobBillingEntity" style="font-size: 13px; color: #6c757d;"></p>
                                    <p id="jobServiceLocation" style="font-weight: 600;"></p>
                                    <p id="jobServiceAddress" style="font-size: 13px; color: #6c757d; margin-top: 4px;"></p>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Inspection Type *</label>
                                    <select id="jobInspectionType" class="form-select" style="font-size: 16px; padding: 14px;">
                                        <option value="bleacher">Indoor Bleacher Inspection</option>
                                        <option value="outdoor">Outdoor Aluminum Bleacher Inspection</option>
                                        <option value="basketball">Basketball Goal Inspection</option>
                                    </select>
                                </div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                    <div class="form-group">
                                        <label class="form-label">Job Number</label>
                                        <input type="text" id="jobNumberInput" class="form-input" readonly style="background: #e9ecef; font-weight: 700; font-size: 16px;">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Date</label>
                                        <input type="date" id="jobDateInput" class="form-input" style="font-size: 16px; padding: 14px;">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Notes</label>
                                    <textarea id="jobNotes" class="form-input" rows="2" placeholder="Any additional details..." style="font-size: 16px; padding: 14px;"></textarea>
                                </div>
                            </div>
                        </div>

                        <button class="btn btn-primary btn-lg" onclick="createJobAndAddBank()" style="width: 100%; margin-top: 16px; padding: 16px; font-size: 16px;">
                            Create Inspection
                        </button>
                    </div>

                    <!-- Bank Inspection Form (Issue-First, Top-Side-First) -->
                    <div id="bankInspectionView" class="hidden" style="position: relative; padding-bottom: 100px;">
                        <!-- Floating Add Issue Button -->
                        <div id="floatingAddIssue" style="position: fixed; bottom: 24px; right: 24px; z-index: 1000;">
                            <button class="btn btn-primary" onclick="openAddIssueModal()" style="width: 64px; height: 64px; border-radius: 50%; font-size: 28px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center;">
                                +
                            </button>
                            <div style="text-align: center; margin-top: 4px; font-size: 11px; font-weight: 600; color: #4CAF50;">ADD ISSUE</div>
                        </div>

                        <!-- Job Header -->
                        <div style="background: #2d3748; color: white; padding: 16px 24px; margin: -24px -32px 24px -32px; display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-size: 12px; opacity: 0.7;">Job #<span id="bankJobNumber"></span></div>
                                <div style="font-size: 18px; font-weight: 700;" id="bankCustomerName"></div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 12px; opacity: 0.7;">Banks: <span id="bankCount">0</span></div>
                                <button class="btn btn-outline" onclick="goBackToJobList()" style="color: white; border-color: rgba(255,255,255,0.3); margin-top: 4px; font-size: 12px; padding: 6px 12px;">Save & Exit</button>
                            </div>
                        </div>

                        <!-- Bank Tabs -->
                        <div id="bankTabs" style="display: flex; gap: 8px; margin-bottom: 16px; flex-wrap: wrap;">
                            <!-- Populated dynamically -->
                        </div>

                        <!-- Current Bank Form -->
                        <div class="card" style="border-left: 4px solid #4CAF50;">
                            <div class="card-header" style="background: #e8f5e9;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <h2 class="card-title" style="color: #2e7d32;">
                                        <span id="currentBankName">Bank 1</span>
                                        <span id="editBankNameBtn" onclick="editBankName()" style="font-size: 12px; color: #4CAF50; cursor: pointer; margin-left: 8px;">‚úèÔ∏è Edit</span>
                                    </h2>
                                    <select id="bankNameSelect" class="form-select" style="width: auto; display: none;" onchange="updateBankName()">
                                        <option value="East Side">East Side</option>
                                        <option value="West Side">West Side</option>
                                        <option value="Facing Logo">Facing Logo</option>
                                        <option value="Behind Logo">Behind Logo</option>
                                        <option value="North Side">North Side</option>
                                        <option value="South Side">South Side</option>
                                        <option value="Home Side">Home Side</option>
                                        <option value="Visitor Side">Visitor Side</option>
                                        <option value="Main Gym">Main Gym</option>
                                        <option value="Aux Gym">Aux Gym</option>
                                    </select>
                                </div>
                            </div>
                            <div class="card-body">
                                <!-- Equipment Quick Info -->
                                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px;">
                                    <div class="form-group">
                                        <label class="form-label">Bleacher Type</label>
                                        <select id="bankBleacherType" class="form-select">
                                            <option value="">Select...</option>
                                            <option value="Hussey">Hussey</option>
                                            <option value="Irwin">Irwin</option>
                                            <option value="Interkal">Interkal</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Tiers</label>
                                        <input type="number" id="bankTiers" class="form-input" placeholder="e.g., 5">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Seat Type</label>
                                        <input type="text" id="bankSeatType" class="form-input" placeholder="e.g., Infinity">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Color</label>
                                        <input type="text" id="bankColor" class="form-input" placeholder="e.g., Red">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- TOP SIDE SECTION (First - matches physical walkthrough) -->
                        <div class="card">
                            <div class="card-header" style="background: #e3f2fd; cursor: pointer;" onclick="toggleSection('topSideSection')">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <h2 class="card-title" style="color: #1565c0;">üëü Top Side Inspection</h2>
                                    <span id="topSideToggle" style="font-size: 20px;">‚ñº</span>
                                </div>
                                <p style="font-size: 12px; color: #1565c0; margin-top: 4px;">Walk the bleachers, document issues as you find them</p>
                            </div>
                            <div class="card-body" id="topSideSection">
                                <!-- Seating Layout -->
                                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 16px; padding-bottom: 16px; border-bottom: 1px solid #e9ecef;">
                                    <div class="form-group">
                                        <label class="form-label">Sections</label>
                                        <input type="number" id="bankSections" class="form-input" placeholder="e.g., 4">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Rows</label>
                                        <input type="number" id="bankRows" class="form-input" placeholder="e.g., 5">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Aisles</label>
                                        <input type="number" id="bankAisles" class="form-input" placeholder="e.g., 3">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Aisle Rail Type</label>
                                        <select id="bankAisleRailType" class="form-select">
                                            <option value="P">P Rail</option>
                                            <option value="F">F Rail</option>
                                            <option value="Q">Q Rail</option>
                                            <option value="N/A">N/A</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Top Side Issues List -->
                                <div style="margin-bottom: 16px;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                        <h3 style="font-size: 14px; font-weight: 600; color: #1565c0;">Top Side Issues Found</h3>
                                        <button class="btn btn-outline" onclick="addTopSideIssue()" style="font-size: 12px; padding: 6px 12px;">+ Add Issue</button>
                                    </div>
                                    <div id="topSideIssuesList">
                                        <div style="text-align: center; padding: 24px; color: #6c757d; background: #f8f9fa; border-radius: 8px;">
                                            <div style="font-size: 32px; margin-bottom: 8px;">üëÄ</div>
                                            <p>No top side issues documented yet</p>
                                            <p style="font-size: 12px; margin-top: 4px;">Walk the bleachers and tap + to add issues</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Collapsible Checklist Reference -->
                                <details style="background: #f8f9fa; border-radius: 8px; padding: 12px;">
                                    <summary style="cursor: pointer; font-weight: 600; color: #6c757d;">üìã Inspection Checklist Reference</summary>
                                    <div id="topSideChecklist" style="margin-top: 12px;"></div>
                                </details>
                            </div>
                        </div>

                        <!-- UNDERSTRUCTURE SECTION (Second) -->
                        <div class="card">
                            <div class="card-header" style="background: #fce4ec; cursor: pointer;" onclick="toggleSection('understructureSection')">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <h2 class="card-title" style="color: #c2185b;">üîß Understructure Inspection</h2>
                                    <span id="understructureToggle" style="font-size: 20px;">‚ñº</span>
                                </div>
                                <p style="font-size: 12px; color: #c2185b; margin-top: 4px;">Crawl underneath, check motors, frames, wheels</p>
                            </div>
                            <div class="card-body" id="understructureSection">
                                <!-- Motor Specs -->
                                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 16px; padding-bottom: 16px; border-bottom: 1px solid #e9ecef;">
                                    <div class="form-group">
                                        <label class="form-label">Motor Phase</label>
                                        <select id="bankMotorPhase" class="form-select">
                                            <option value="Single">Single Phase</option>
                                            <option value="3">3 Phase</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">HP</label>
                                        <input type="text" id="bankMotorHP" class="form-input" placeholder="e.g., 1/2">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label"># of Motors</label>
                                        <input type="number" id="bankMotorCount" class="form-input" placeholder="e.g., 3">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Wheel Type</label>
                                        <input type="text" id="bankWheelType" class="form-input" placeholder="e.g., Wide Track">
                                    </div>
                                </div>

                                <!-- Understructure Issues List -->
                                <div style="margin-bottom: 16px;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                        <h3 style="font-size: 14px; font-weight: 600; color: #c2185b;">Understructure Issues Found</h3>
                                        <button class="btn btn-outline" onclick="addUnderstructureIssue()" style="font-size: 12px; padding: 6px 12px;">+ Add Issue</button>
                                    </div>
                                    <div id="understructureIssuesList">
                                        <div style="text-align: center; padding: 24px; color: #6c757d; background: #f8f9fa; border-radius: 8px;">
                                            <div style="font-size: 32px; margin-bottom: 8px;">üîç</div>
                                            <p>No understructure issues documented yet</p>
                                            <p style="font-size: 12px; margin-top: 4px;">Check motors, frames, wheels and tap + to add issues</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Collapsible Checklist Reference -->
                                <details style="background: #f8f9fa; border-radius: 8px; padding: 12px;">
                                    <summary style="cursor: pointer; font-weight: 600; color: #6c757d;">üìã Inspection Checklist Reference</summary>
                                    <div id="understructureChecklist" style="margin-top: 12px;"></div>
                                </details>
                            </div>
                        </div>

                        <!-- BANK SUMMARY -->
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Bank Summary</h2>
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label class="form-label" style="color: #dc3545;">‚ö†Ô∏è Safety Issues</label>
                                    <textarea id="bankSafetyIssues" class="form-textarea" placeholder="Describe any safety issues..." style="border-left: 4px solid #dc3545;"></textarea>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">üîß Functional / Mechanical Issues</label>
                                    <textarea id="bankMechanicalIssues" class="form-textarea" placeholder="Describe mechanical issues..."></textarea>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">‚ú® Cosmetic Issues</label>
                                    <textarea id="bankCosmeticIssues" class="form-textarea" placeholder="Describe cosmetic issues..."></textarea>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">üè∑Ô∏è Inspection Tag Affixed?</label>
                                    <select id="bankTagAffixed" class="form-select">
                                        <option value="yes">Yes</option>
                                        <option value="no">No</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Bank Actions -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 24px;">
                            <button class="btn btn-outline btn-lg" onclick="saveBankAndAddAnother()">
                                Save Bank & Add Another
                            </button>
                            <button class="btn btn-primary btn-lg" onclick="saveBankAndFinishJob()">
                                Finish This Job ‚úì
                            </button>
                        </div>
                    </div>

                    <!-- Add Issue Modal -->
                    <div id="addIssueModal" class="hidden" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 2000; display: flex; align-items: center; justify-content: center;">
                        <div style="background: white; border-radius: 16px; width: 90%; max-width: 500px; max-height: 90vh; overflow-y: auto;">
                            <div style="padding: 20px; border-bottom: 1px solid #e9ecef;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <h2 style="font-size: 18px; font-weight: 700;">Add Issue</h2>
                                    <button onclick="closeAddIssueModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #6c757d;">√ó</button>
                                </div>
                            </div>
                            <div style="padding: 20px;">
                                <div class="form-group">
                                    <label class="form-label">Issue Type *</label>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                                        <button type="button" id="issueTypeTopSide" class="btn btn-outline" onclick="selectIssueType('topSide')" style="padding: 16px; text-align: center;">
                                            <div style="font-size: 24px;">üëü</div>
                                            <div style="font-size: 13px; margin-top: 4px;">Top Side</div>
                                        </button>
                                        <button type="button" id="issueTypeUnder" class="btn btn-outline" onclick="selectIssueType('understructure')" style="padding: 16px; text-align: center;">
                                            <div style="font-size: 24px;">üîß</div>
                                            <div style="font-size: 13px; margin-top: 4px;">Understructure</div>
                                        </button>
                                    </div>
                                </div>

                                <div id="issueLocationFields" class="hidden">
                                    <!-- Top Side Location -->
                                    <div id="topSideLocationFields" class="hidden">
                                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px;">
                                            <div class="form-group">
                                                <label class="form-label">Section</label>
                                                <input type="text" id="issueSection" class="form-input" placeholder="e.g., 2">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Row</label>
                                                <input type="text" id="issueRow" class="form-input" placeholder="e.g., 3">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Aisle</label>
                                                <input type="text" id="issueAisle" class="form-input" placeholder="e.g., 1">
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Understructure Location -->
                                    <div id="underLocationFields" class="hidden">
                                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                                            <div class="form-group">
                                                <label class="form-label">Frame</label>
                                                <input type="text" id="issueFrame" class="form-input" placeholder="e.g., 3">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Tier</label>
                                                <input type="text" id="issueTier" class="form-input" placeholder="e.g., 1">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">Description *</label>
                                        <textarea id="issueDescription" class="form-textarea" placeholder="Describe the issue..." style="min-height: 80px;"></textarea>
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">üì∑ Photo</label>
                                        <div id="issuePhotoPreview" style="width: 100%; height: 150px; background: #f8f9fa; border: 2px dashed #dee2e6; border-radius: 8px; display: flex; align-items: center; justify-content: center; cursor: pointer; margin-bottom: 8px;" onclick="document.getElementById('issuePhotoInput').click()">
                                            <div style="text-align: center; color: #6c757d;">
                                                <div style="font-size: 32px;">üì∑</div>
                                                <div style="font-size: 13px;">Tap to take photo</div>
                                            </div>
                                        </div>
                                        <input type="file" id="issuePhotoInput" accept="image/*" capture="environment" style="display: none;" onchange="previewIssuePhoto(this)">
                                    </div>
                                </div>
                            </div>
                            <div style="padding: 20px; border-top: 1px solid #e9ecef;">
                                <button class="btn btn-primary btn-lg" onclick="saveIssue()" style="width: 100%;">Save Issue</button>
                            </div>
                        </div>
                    </div>

                    <!-- Job Summary / Finish View -->
                    <div id="jobSummaryView" class="hidden">
                        <div class="page-header">
                            <button class="btn btn-secondary" onclick="backToInspection()">‚Üê Back to Inspection</button>
                            <h1 class="page-title" style="margin-top: 16px;">Job Summary</h1>
                            <p class="page-subtitle">Review and submit inspection</p>
                        </div>

                        <div class="card" style="border-left: 4px solid #4CAF50;">
                            <div class="card-header">
                                <h2 class="card-title">Job #<span id="summaryJobNumber"></span></h2>
                            </div>
                            <div class="card-body">
                                <p style="font-size: 18px; font-weight: 600;" id="summaryCustomerName"></p>
                                <p style="color: #6c757d;" id="summaryAddress"></p>
                                <div style="margin-top: 16px; display: flex; gap: 16px;">
                                    <div style="background: #e8f5e9; padding: 12px 20px; border-radius: 8px; text-align: center;">
                                        <div style="font-size: 24px; font-weight: 700; color: #2e7d32;" id="summaryBankCount">0</div>
                                        <div style="font-size: 12px; color: #2e7d32;">Banks</div>
                                    </div>
                                    <div style="background: #fff3e0; padding: 12px 20px; border-radius: 8px; text-align: center;">
                                        <div style="font-size: 24px; font-weight: 700; color: #e65100;" id="summaryIssueCount">0</div>
                                        <div style="font-size: 12px; color: #e65100;">Issues</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Banks Inspected</h2>
                            </div>
                            <div class="card-body" id="summaryBanksList"></div>
                        </div>

                        <!-- Parts Section -->
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Parts Needed (<span id="summaryPartsCount">0</span>)</h2>
                            </div>
                            <div class="card-body">
                                <div id="summaryPartsList"></div>
                                <button class="btn btn-outline" onclick="openPartsSearch()" style="width: 100%; margin-top: 16px;">üîç Search & Add Parts</button>
                            </div>
                        </div>

                        <!-- Inspector Signature -->
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Inspector Certification</h2>
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label class="form-label">Inspector Name</label>
                                    <input type="text" id="inspectorName" class="form-input" value="Danny Mendl">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Certificate Number</label>
                                    <input type="text" id="inspectorCertificate" class="form-input" value="MXM00-980">
                                </div>
                            </div>
                        </div>

                        <button class="btn btn-primary btn-lg" onclick="submitJob()" style="width: 100%;">
                            ‚úÖ Submit Inspection
                        </button>
                    </div>

                    <!-- Legacy New Inspection Form (kept for compatibility) -->
                    <div id="newInspectionView" class="hidden">
                        <div class="page-header">
                            <button class="btn btn-secondary" onclick="goBackFromInspection()">‚Üê Back</button>
                            <h1 class="page-title" style="margin-top: 16px;">New Inspection</h1>
                            <p class="page-subtitle">Select inspection type and complete the form</p>
                        </div>

                        <!-- Inspection Type Selection -->
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Inspection Type *</h2>
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <select id="inspectionTypeSelect" class="form-select" onchange="onInspectionTypeChange()" style="font-size: 16px; padding: 14px;">
                                        <option value="">Select inspection type...</option>
                                        <option value="basketball">üèÄ Basketball Goal Inspection</option>
                                        <option value="bleacher">üèüÔ∏è Indoor Bleacher Inspection</option>
                                        <option value="outdoor">ü™ë Outdoor Aluminum Bleacher Inspection</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Common: Customer Info (shown after type selected) -->
                        <div id="inspectionFormFields" class="hidden">
                            <div class="card">
                                <div class="card-header">
                                    <h2 class="card-title">Customer Information</h2>
                                </div>
                                <div class="card-body">
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                        <div class="form-group">
                                            <label class="form-label">Customer / School *</label>
                                            <select id="customerSelect" class="form-select" onchange="updateCustomerInfo()">
                                                <option value="">Select a customer</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Location / Gym Name</label>
                                            <input type="text" id="locationInput" class="form-input" placeholder="e.g., Main Gymnasium">
                                        </div>
                                    </div>
                                    <div id="customerInfo" class="hidden" style="background: #f8f9fa; padding: 16px; border-radius: 8px; margin-top: 16px;">
                                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                            <div>
                                                <p style="font-size: 11px; text-transform: uppercase; color: #6c757d; margin-bottom: 4px;">Billing Entity</p>
                                                <p id="billingEntityName" style="font-weight: 600; margin-bottom: 2px;"></p>
                                                <p id="billingEntityContact" style="font-size: 13px; color: #6c757d;"></p>
                                            </div>
                                            <div>
                                                <p style="font-size: 11px; text-transform: uppercase; color: #6c757d; margin-bottom: 4px;">Service Location</p>
                                                <p id="customerName" style="font-weight: 600; margin-bottom: 2px;"></p>
                                                <p id="customerAddress" style="font-size: 13px; color: #6c757d;"></p>
                                                <p id="customerContact" style="font-size: 13px; color: #6c757d;"></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- BASKETBALL GOAL INSPECTION FIELDS -->
                            <div id="basketballFields" class="hidden">
                                <div class="card">
                                    <div class="card-header">
                                        <h2 class="card-title">üèÄ Basketball Equipment Overview</h2>
                                    </div>
                                    <div class="card-body">
                                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px;">
                                            <div class="form-group">
                                                <label class="form-label">Brand of Equipment</label>
                                                <select id="bbBrand" class="form-select">
                                                    <option value="">Select brand</option>
                                                    <option value="Spalding">Spalding</option>
                                                    <option value="Porter">Porter</option>
                                                    <option value="Draper">Draper</option>
                                                    <option value="Jaypro">Jaypro</option>
                                                    <option value="Other">Other</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">How Many Goals in Gym</label>
                                                <input type="number" id="bbGoalCount" class="form-input" placeholder="e.g., 4" min="1" max="8">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Gym Type</label>
                                                <select id="bbGymType" class="form-select">
                                                    <option value="Main">Main Gym</option>
                                                    <option value="Auxiliary">Auxiliary Gym</option>
                                                    <option value="Practice">Practice Gym</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; margin-top: 16px;">
                                            <div class="form-group">
                                                <label class="form-label">Padding Color</label>
                                                <input type="text" id="bbPaddingColor" class="form-input" placeholder="e.g., Navy Blue">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Padding Dimensions</label>
                                                <input type="text" id="bbPaddingDimensions" class="form-input" placeholder="e.g., 72x42">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Ceiling Type</label>
                                                <select id="bbCeilingType" class="form-select">
                                                    <option value="">Select type</option>
                                                    <option value="Metal Girders with Secondary Trusses">Metal Girders with Secondary Trusses</option>
                                                    <option value="Open Steel Trusses">Open Steel Trusses</option>
                                                    <option value="Wood Trusses">Wood Trusses</option>
                                                    <option value="Concrete">Concrete</option>
                                                    <option value="Other">Other</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Per-Goal Inspection -->
                                <div class="card">
                                    <div class="card-header">
                                        <h2 class="card-title">Goal Inspections</h2>
                                        <button class="btn btn-outline" onclick="addGoalInspection()">+ Add Goal</button>
                                    </div>
                                    <div class="card-body" id="goalInspectionsContainer">
                                        <p style="color: #6c757d; text-align: center;">Click "Add Goal" to inspect each basketball goal</p>
                                    </div>
                                </div>

                                <!-- Basketball Checklist -->
                                <div class="card">
                                    <div class="card-header">
                                        <h2 class="card-title">Overall Checklist</h2>
                                    </div>
                                    <div class="card-body">
                                        <div id="bbChecklist"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- INDOOR BLEACHER INSPECTION FIELDS -->
                            <div id="bleacherFields" class="hidden">
                                <div class="card">
                                    <div class="card-header">
                                        <h2 class="card-title">üèüÔ∏è Bleacher Equipment Details</h2>
                                    </div>
                                    <div class="card-body">
                                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 16px;">
                                            <div class="form-group">
                                                <label class="form-label">Banks</label>
                                                <input type="text" id="blBanks" class="form-input" placeholder="e.g., 1 - Behind">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Tiers</label>
                                                <input type="number" id="blTiers" class="form-input" placeholder="e.g., 5">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Rise</label>
                                                <input type="text" id="blRise" class="form-input" placeholder='e.g., 10"'>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Row Spacing</label>
                                                <input type="text" id="blRowSpacing" class="form-input" placeholder='e.g., 24"'>
                                            </div>
                                        </div>
                                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 16px; margin-top: 16px;">
                                            <div class="form-group">
                                                <label class="form-label">Bleacher Type</label>
                                                <select id="blType" class="form-select">
                                                    <option value="">Select type</option>
                                                    <option value="Hussey">Hussey</option>
                                                    <option value="Irwin">Irwin</option>
                                                    <option value="Interkal">Interkal</option>
                                                    <option value="Other">Other</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Seat Type</label>
                                                <input type="text" id="blSeatType" class="form-input" placeholder="e.g., Infinity">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Material</label>
                                                <select id="blMaterial" class="form-select">
                                                    <option value="Plastic">Plastic</option>
                                                    <option value="Wood">Wood</option>
                                                    <option value="Aluminum">Aluminum</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Color</label>
                                                <input type="text" id="blColor" class="form-input" placeholder="e.g., Crimson">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Understructure Checklist -->
                                <div class="card">
                                    <div class="card-header">
                                        <h2 class="card-title">Understructure Checklist</h2>
                                    </div>
                                    <div class="card-body">
                                        <div id="blUnderstructureChecklist"></div>
                                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; margin-top: 20px; padding-top: 20px; border-top: 1px solid #e9ecef;">
                                            <div class="form-group">
                                                <label class="form-label">Motor Phase</label>
                                                <select id="blMotorPhase" class="form-select">
                                                    <option value="Single">Single Phase</option>
                                                    <option value="3">3 Phase</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">HP</label>
                                                <input type="text" id="blMotorHP" class="form-input" placeholder="e.g., 1/2">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Number of Motors</label>
                                                <input type="number" id="blMotorCount" class="form-input" placeholder="e.g., 3">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Top Side Checklist -->
                                <div class="card">
                                    <div class="card-header">
                                        <h2 class="card-title">Top Side Checklist</h2>
                                    </div>
                                    <div class="card-body">
                                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; margin-bottom: 20px;">
                                            <div class="form-group">
                                                <label class="form-label">Sections</label>
                                                <input type="number" id="blSections" class="form-input" placeholder="e.g., 3">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Rows</label>
                                                <input type="number" id="blRows" class="form-input" placeholder="e.g., 5">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Aisles</label>
                                                <input type="number" id="blAisles" class="form-input" placeholder="e.g., 2">
                                            </div>
                                        </div>
                                        <div id="blTopSideChecklist"></div>
                                    </div>
                                </div>

                                <!-- Issues Detail -->
                                <div class="card">
                                    <div class="card-header">
                                        <h2 class="card-title">Issues Found</h2>
                                        <button class="btn btn-outline" onclick="addIssue('bleacher')">+ Add Issue</button>
                                    </div>
                                    <div class="card-body" id="bleacherIssuesContainer">
                                        <p style="color: #6c757d; text-align: center;">Click "Add Issue" to document problems found</p>
                                    </div>
                                </div>
                            </div>

                            <!-- OUTDOOR ALUMINUM BLEACHER FIELDS -->
                            <div id="outdoorFields" class="hidden">
                                <div class="card">
                                    <div class="card-header">
                                        <h2 class="card-title">ü™ë Aluminum Bleacher Details</h2>
                                    </div>
                                    <div class="card-body">
                                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px;">
                                            <div class="form-group">
                                                <label class="form-label">Type of Bleacher</label>
                                                <select id="outType" class="form-select">
                                                    <option value="">Select type</option>
                                                    <option value="Angle Frame">Angle Frame</option>
                                                    <option value="I-Beam">I-Beam</option>
                                                    <option value="Channel Frame">Channel Frame</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Number of Tiers</label>
                                                <input type="number" id="outTiers" class="form-input" placeholder="e.g., 15">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Bleacher Length</label>
                                                <input type="text" id="outLength" class="form-input" placeholder="e.g., 90'">
                                            </div>
                                        </div>
                                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; margin-top: 16px;">
                                            <div class="form-group">
                                                <label class="form-label">Side (Orientation)</label>
                                                <select id="outSide" class="form-select">
                                                    <option value="Home">Home Side</option>
                                                    <option value="Visitor">Visitor Side</option>
                                                    <option value="Right">Right Side</option>
                                                    <option value="Left">Left Side</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Seat Width & Thickness</label>
                                                <input type="text" id="outSeatDimensions" class="form-input" placeholder='e.g., 9 1/2" x 1 3/4"'>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Seat Color</label>
                                                <input type="text" id="outSeatColor" class="form-input" placeholder="e.g., Natural Aluminum">
                                            </div>
                                        </div>
                                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 16px; margin-top: 16px;">
                                            <div class="form-group">
                                                <label class="form-label">Sections</label>
                                                <input type="number" id="outSections" class="form-input" placeholder="e.g., 2">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Rows</label>
                                                <input type="number" id="outRows" class="form-input" placeholder="e.g., 15">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Rise</label>
                                                <input type="text" id="outRise" class="form-input" placeholder='e.g., 10"'>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Run</label>
                                                <input type="text" id="outRun" class="form-input" placeholder='e.g., 23"'>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Outdoor Understructure Checklist -->
                                <div class="card">
                                    <div class="card-header">
                                        <h2 class="card-title">Understructure Checklist</h2>
                                    </div>
                                    <div class="card-body">
                                        <div id="outUnderstructureChecklist"></div>
                                    </div>
                                </div>

                                <!-- Outdoor Top Side Checklist -->
                                <div class="card">
                                    <div class="card-header">
                                        <h2 class="card-title">Top Side Checklist</h2>
                                    </div>
                                    <div class="card-body">
                                        <div id="outTopSideChecklist"></div>
                                    </div>
                                </div>

                                <!-- Code Compliance -->
                                <div class="card">
                                    <div class="card-header">
                                        <h2 class="card-title">Code Compliance Issues</h2>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-group">
                                            <label class="form-label">Note gaps larger than 4", chain-link issues, ladder effect, etc.</label>
                                            <textarea id="outCodeIssues" class="form-textarea" placeholder="Describe any code compliance issues found..."></textarea>
                                        </div>
                                    </div>
                                </div>

                                <!-- Issues Detail -->
                                <div class="card">
                                    <div class="card-header">
                                        <h2 class="card-title">Issues Found</h2>
                                        <button class="btn btn-outline" onclick="addIssue('outdoor')">+ Add Issue</button>
                                    </div>
                                    <div class="card-body" id="outdoorIssuesContainer">
                                        <p style="color: #6c757d; text-align: center;">Click "Add Issue" to document problems found</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Common: Manufacturer (shown for bleacher types) -->
                            <div id="manufacturerSection" class="hidden">
                                <div class="card">
                                    <div class="card-header">
                                        <h2 class="card-title">Equipment Manufacturer</h2>
                                    </div>
                                    <div class="card-body">
                                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                            <div class="form-group">
                                                <label class="form-label">Manufacturer</label>
                                                <select id="manufacturerSelect" class="form-select">
                                                    <option value="">Select manufacturer</option>
                                                    <option value="Hussey Seating Co">Hussey Seating Co</option>
                                                    <option value="Irwin">Irwin</option>
                                                    <option value="Draper">Draper</option>
                                                    <option value="Interkal">Interkal</option>
                                                    <option value="Porter">Porter</option>
                                                    <option value="Spalding">Spalding</option>
                                                    <option value="Other">Other</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Model</label>
                                                <input type="text" id="modelInput" class="form-input" placeholder="Model number if known">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Parts Search Section (shown for all types) -->
                            <div class="card">
                                <div class="card-header">
                                    <h2 class="card-title">Search & Add Parts</h2>
                                    <p style="font-size: 13px; color: #6c757d; margin-top: 4px;">Search 2,142 Hussey parts by name, part number, or category</p>
                                </div>
                                <div class="card-body">
                                    <div class="form-group">
                                        <label class="form-label">Search Parts</label>
                                        <div style="display: flex; gap: 8px;">
                                            <input type="text" id="partSearch" class="form-input" style="flex: 1;" placeholder="Search by keyword or part # (e.g., 'wheel', 'seat board', '1001087')..." onkeyup="if(event.key==='Enter')searchParts()">
                                            <button type="button" class="btn btn-primary" onclick="searchParts()">Search</button>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">Filter by Category (Optional)</label>
                                        <select id="vendorFilter" class="form-select" onchange="searchParts()">
                                            <option value="">All Categories</option>
                                        </select>
                                    </div>

                                    <div id="partsResults"></div>
                                </div>
                            </div>

                            <div class="card">
                                <div class="card-header">
                                    <h2 class="card-title">Parts List (<span id="partsCount">0</span>)</h2>
                                </div>
                                <div class="card-body" id="selectedPartsList">
                                    <div class="empty-state">
                                        <div class="empty-icon">üì¶</div>
                                        <p>No parts added yet</p>
                                        <p style="font-size: 14px; margin-top: 8px;">Search and select parts above</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Summary Section -->
                            <div class="card">
                                <div class="card-header">
                                    <h2 class="card-title">Inspector Summary</h2>
                                </div>
                                <div class="card-body">
                                    <div class="form-group">
                                        <label class="form-label">Safety Issues</label>
                                        <textarea id="safetyIssues" class="form-textarea" placeholder="Describe any safety issues found..." style="border-left: 4px solid #dc3545;"></textarea>
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">Functional / Mechanical Issues</label>
                                        <textarea id="mechanicalIssues" class="form-textarea" placeholder="Describe functional or mechanical issues..."></textarea>
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">Cosmetic Issues</label>
                                        <textarea id="cosmeticIssues" class="form-textarea" placeholder="Describe cosmetic issues..."></textarea>
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">Estimated Labor Hours</label>
                                        <input type="number" id="laborHours" class="form-input" placeholder="0" step="0.5" value="0">
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">Additional Service Notes</label>
                                        <textarea id="serviceNotes" class="form-textarea" placeholder="Any other notes..."></textarea>
                                    </div>

                                    <button class="btn btn-primary btn-lg" onclick="submitInspection()" style="width: 100%;">
                                        Submit Inspection Report
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tech Work Orders View -->
                    <div id="techWorkOrdersView" class="hidden">
                        <div class="page-header">
                            <h1 class="page-title">My Work Orders</h1>
                            <p class="page-subtitle">Tap a job to view details and submit completion</p>
                        </div>

                        <!-- Today's Jobs -->
                        <div class="card">
                            <div class="card-header" style="background: #e8f5e9;">
                                <h2 class="card-title" style="color: #2e7d32;">üìÖ Today - January 27, 2026</h2>
                            </div>
                            <div class="card-body" style="padding: 0;">
                                <!-- Work Order 1 -->
                                <div class="inspection-item" onclick="showTechWorkOrderDetail('two1')" style="cursor: pointer; border-left: 4px solid #4CAF50; margin: 0; border-radius: 0; border-bottom: 1px solid #e9ecef;">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                        <div>
                                            <div style="font-size: 12px; color: #4CAF50; font-weight: 600; margin-bottom: 4px;">Job #17208 ‚Ä¢ Repair</div>
                                            <strong style="font-size: 16px;">Ripley High School</strong>
                                            <p style="font-size: 13px; color: #6c757d; margin-top: 4px;">254 S Jefferson St, Ripley, TN</p>
                                            <p style="font-size: 14px; margin-top: 8px;">Install safety strap on Goal 5</p>
                                        </div>
                                        <div style="text-align: right;">
                                            <span class="badge badge-success">8:00 AM</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Work Order 2 -->
                                <div class="inspection-item" onclick="showTechWorkOrderDetail('two2')" style="cursor: pointer; border-left: 4px solid #4CAF50; margin: 0; border-radius: 0; border-bottom: 1px solid #e9ecef;">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                        <div>
                                            <div style="font-size: 12px; color: #4CAF50; font-weight: 600; margin-bottom: 4px;">Job #17209 ‚Ä¢ Inspection</div>
                                            <strong style="font-size: 16px;">Ripley Middle School</strong>
                                            <p style="font-size: 13px; color: #6c757d; margin-top: 4px;">309 Charles Griggs St, Ripley, TN</p>
                                            <p style="font-size: 14px; margin-top: 8px;">Annual bleacher inspection - Main Gym</p>
                                        </div>
                                        <div style="text-align: right;">
                                            <span class="badge badge-success">11:00 AM</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Work Order 3 -->
                                <div class="inspection-item" onclick="showTechWorkOrderDetail('two3')" style="cursor: pointer; border-left: 4px solid #4CAF50; margin: 0; border-radius: 0;">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                        <div>
                                            <div style="font-size: 12px; color: #4CAF50; font-weight: 600; margin-bottom: 4px;">Job #17210 ‚Ä¢ Repair</div>
                                            <strong style="font-size: 16px;">Brentwood Academy</strong>
                                            <p style="font-size: 13px; color: #6c757d; margin-top: 4px;">219 Granny White Pike, Brentwood, TN</p>
                                            <p style="font-size: 14px; margin-top: 8px;">Replace deck boards (3) and seat slats (5)</p>
                                        </div>
                                        <div style="text-align: right;">
                                            <span class="badge badge-success">2:00 PM</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Upcoming Jobs -->
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">üìÜ Upcoming</h2>
                            </div>
                            <div class="card-body" style="padding: 0;">
                                <div class="inspection-item" style="margin: 0; border-radius: 0; border-bottom: 1px solid #e9ecef; opacity: 0.7;">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                        <div>
                                            <div style="font-size: 12px; color: #6c757d; font-weight: 600; margin-bottom: 4px;">Job #17211 ‚Ä¢ Repair</div>
                                            <strong style="font-size: 16px;">Franklin High School</strong>
                                            <p style="font-size: 13px; color: #6c757d; margin-top: 4px;">Motor replacement - Section A</p>
                                        </div>
                                        <div style="text-align: right;">
                                            <span class="badge badge-secondary">Jan 28</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="inspection-item" style="margin: 0; border-radius: 0; opacity: 0.7;">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                        <div>
                                            <div style="font-size: 12px; color: #6c757d; font-weight: 600; margin-bottom: 4px;">Job #17212 ‚Ä¢ Inspection</div>
                                            <strong style="font-size: 16px;">Mt. Juliet High School</strong>
                                            <p style="font-size: 13px; color: #6c757d; margin-top: 4px;">Annual basketball goal inspection</p>
                                        </div>
                                        <div style="text-align: right;">
                                            <span class="badge badge-secondary">Jan 29</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tech Work Order Detail View (Simplified for Field Staff) -->
                    <div id="techWorkOrderDetailView" class="hidden">
                        <div class="page-header">
                            <button class="btn btn-secondary" onclick="showTechView('create')" style="margin-bottom: 16px;">‚Üê Back</button>
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <h1 class="page-title" style="margin: 0;" id="twoJobNumber">Job #17208</h1>
                                <span id="twoJobTypeBadge" class="badge badge-info">Repair</span>
                            </div>
                        </div>

                        <!-- Job Info Card (Read-Only) -->
                        <div class="card" style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);">
                            <div class="card-body">
                                <!-- Location & Directions -->
                                <div style="margin-bottom: 20px;">
                                    <p style="font-size: 12px; color: #6c757d; margin-bottom: 4px; text-transform: uppercase; font-weight: 600;">Location</p>
                                    <h2 id="twoLocationName" style="font-size: 20px; font-weight: 700; margin-bottom: 4px;">Ripley High School</h2>
                                    <p id="twoAddress" style="font-size: 14px; color: #495057;">254 S Jefferson St, Ripley, TN 38063</p>
                                    <a id="twoDirectionsLink" href="https://maps.google.com/?q=254+S+Jefferson+St+Ripley+TN+38063" target="_blank"
                                       style="display: inline-flex; align-items: center; gap: 6px; margin-top: 8px; color: #0066cc; font-weight: 600; text-decoration: none;">
                                        üó∫Ô∏è Get Directions
                                    </a>
                                </div>

                                <!-- Contact -->
                                <div style="margin-bottom: 20px; padding: 12px; background: white; border-radius: 8px;">
                                    <p style="font-size: 12px; color: #6c757d; margin-bottom: 4px; text-transform: uppercase; font-weight: 600;">Site Contact</p>
                                    <p id="twoContactName" style="font-size: 16px; font-weight: 600; margin-bottom: 4px;">Chris McCorkle</p>
                                    <a id="twoContactPhone" href="tel:7316352642" style="color: #0066cc; font-weight: 600; text-decoration: none;">üìû (731) 635-2642</a>
                                </div>

                                <!-- What You're Doing -->
                                <div style="margin-bottom: 20px; padding: 16px; background: white; border-radius: 8px; border-left: 4px solid #4CAF50;">
                                    <p style="font-size: 12px; color: #6c757d; margin-bottom: 8px; text-transform: uppercase; font-weight: 600;">What You're Doing</p>
                                    <p id="twoDescription" style="font-size: 16px; line-height: 1.5;">Install safety strap on Goal 5. Lift rental required - 40' lift will be on site.</p>
                                </div>

                                <!-- Parts Location -->
                                <div style="padding: 12px; background: #fff3e0; border-radius: 8px; border-left: 4px solid #ff9800;">
                                    <p style="font-size: 12px; color: #e65100; margin-bottom: 4px; text-transform: uppercase; font-weight: 600;">üì¶ Parts Location</p>
                                    <p id="twoPartsLocation" style="font-size: 14px; font-weight: 600; color: #e65100;">Floyd's house - dropping at Millington HS</p>
                                </div>

                                <!-- Special Instructions (if any) -->
                                <div id="twoSpecialInstructionsSection" style="margin-top: 16px; padding: 12px; background: #e3f2fd; border-radius: 8px; border-left: 4px solid #2196F3;">
                                    <p style="font-size: 12px; color: #1565c0; margin-bottom: 4px; text-transform: uppercase; font-weight: 600;">‚ö†Ô∏è Special Instructions</p>
                                    <p id="twoSpecialInstructions" style="font-size: 14px; color: #1565c0;">Customer will have gym cleared by 8am. Enter through back door - front office doesn't open until 9.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Completion Section -->
                        <div class="card">
                            <div class="card-header" style="background: #4CAF50; color: white;">
                                <h2 class="card-title" style="color: white;">‚úÖ Job Completion</h2>
                            </div>
                            <div class="card-body">
                                <!-- Required Photo Upload -->
                                <div class="form-group">
                                    <label class="form-label" style="font-weight: 700;">
                                        üì∑ Completed Work Photo <span style="color: #dc3545;">*Required</span>
                                    </label>
                                    <p style="font-size: 13px; color: #6c757d; margin-bottom: 12px;">Take a photo showing the completed work</p>
                                    <div id="twoPhotoUploadArea" style="border: 2px dashed #dee2e6; border-radius: 8px; padding: 40px; text-align: center; cursor: pointer; background: #f8f9fa;"
                                         onclick="document.getElementById('twoPhotoInput').click()">
                                        <div style="font-size: 48px; margin-bottom: 12px;">üì∑</div>
                                        <p style="font-weight: 600; color: #495057;">Tap to take photo or upload</p>
                                        <input type="file" id="twoPhotoInput" accept="image/*" capture="environment" style="display: none;" onchange="handleTwoPhotoUpload(event)">
                                    </div>
                                    <div id="twoPhotoPreview" class="hidden" style="margin-top: 12px;"></div>
                                </div>

                                <!-- Additional Photos -->
                                <div class="form-group" style="margin-top: 20px;">
                                    <label class="form-label">üì∑ Additional Photos (Optional)</label>
                                    <p style="font-size: 13px; color: #6c757d; margin-bottom: 12px;">Add more photos if needed (issues found, before/after, etc.)</p>
                                    <div style="border: 2px dashed #dee2e6; border-radius: 8px; padding: 20px; text-align: center; cursor: pointer; background: #f8f9fa;"
                                         onclick="document.getElementById('twoAdditionalPhotos').click()">
                                        <p style="color: #6c757d;">+ Add more photos</p>
                                        <input type="file" id="twoAdditionalPhotos" accept="image/*" capture="environment" multiple style="display: none;" onchange="handleTwoAdditionalPhotos(event)">
                                    </div>
                                    <div id="twoAdditionalPhotosPreview" style="display: flex; flex-wrap: wrap; gap: 12px; margin-top: 12px;"></div>
                                </div>

                                <!-- Required Notes -->
                                <div class="form-group" style="margin-top: 20px;">
                                    <label class="form-label" style="font-weight: 700;">
                                        üìù Completion Notes <span style="color: #dc3545;">*Required</span>
                                    </label>
                                    <p style="font-size: 13px; color: #6c757d; margin-bottom: 12px;">Describe work completed (even "All work completed as specified" is fine)</p>
                                    <textarea id="twoCompletionNotes" class="form-input" rows="4"
                                              placeholder="Example: Installed safety strap on Goal 5. Tested operation - working properly. No additional issues found."
                                              style="font-size: 16px;"></textarea>
                                </div>

                                <!-- Completion Buttons -->
                                <div style="margin-top: 24px;">
                                    <button class="btn btn-primary btn-lg" onclick="submitJobCompleted()"
                                            style="width: 100%; padding: 20px; font-size: 18px; background: #4CAF50; border-color: #4CAF50;">
                                        ‚úÖ Job Completed - Submit
                                    </button>
                                </div>

                                <div style="margin-top: 16px; text-align: center;">
                                    <p style="font-size: 13px; color: #6c757d; margin-bottom: 12px;">Unable to complete?</p>
                                    <button class="btn btn-outline" onclick="showNotCompletedOptions()"
                                            style="width: 100%; padding: 16px; font-size: 16px; color: #dc3545; border-color: #dc3545;">
                                        ‚ùå Job Not Completed
                                    </button>
                                </div>

                                <!-- Not Completed Options (Hidden by default) -->
                                <div id="twoNotCompletedSection" class="hidden" style="margin-top: 20px; padding: 20px; background: #fff5f5; border-radius: 8px; border: 1px solid #ffcdd2;">
                                    <h3 style="font-size: 16px; font-weight: 700; color: #c62828; margin-bottom: 16px;">What happened?</h3>

                                    <!-- Reason Buttons (Step 1) -->
                                    <div id="twoReasonButtons" style="display: flex; flex-direction: column; gap: 10px;">
                                        <button type="button" onclick="selectNotCompletedReason('wrong_part')" class="reason-btn"
                                                style="padding: 16px 20px; border: 2px solid #dee2e6; border-radius: 8px; background: white; text-align: left; cursor: pointer; font-size: 15px; transition: all 0.15s;">
                                            <span style="font-size: 20px; margin-right: 12px;">üîß</span>
                                            <strong>Wrong or Missing Part</strong>
                                        </button>
                                        <button type="button" onclick="selectNotCompletedReason('access')" class="reason-btn"
                                                style="padding: 16px 20px; border: 2px solid #dee2e6; border-radius: 8px; background: white; text-align: left; cursor: pointer; font-size: 15px; transition: all 0.15s;">
                                            <span style="font-size: 20px; margin-right: 12px;">üö™</span>
                                            <strong>Can't Access Site</strong>
                                        </button>
                                        <button type="button" onclick="selectNotCompletedReason('more_work')" class="reason-btn"
                                                style="padding: 16px 20px; border: 2px solid #dee2e6; border-radius: 8px; background: white; text-align: left; cursor: pointer; font-size: 15px; transition: all 0.15s;">
                                            <span style="font-size: 20px; margin-right: 12px;">‚ö†Ô∏è</span>
                                            <strong>Additional Work Needed</strong>
                                        </button>
                                        <button type="button" onclick="selectNotCompletedReason('equipment')" class="reason-btn"
                                                style="padding: 16px 20px; border: 2px solid #dee2e6; border-radius: 8px; background: white; text-align: left; cursor: pointer; font-size: 15px; transition: all 0.15s;">
                                            <span style="font-size: 20px; margin-right: 12px;">üèóÔ∏è</span>
                                            <strong>Equipment Issue</strong>
                                        </button>
                                        <button type="button" onclick="selectNotCompletedReason('other')" class="reason-btn"
                                                style="padding: 16px 20px; border: 2px solid #dee2e6; border-radius: 8px; background: white; text-align: left; cursor: pointer; font-size: 15px; transition: all 0.15s;">
                                            <span style="font-size: 20px; margin-right: 12px;">üìù</span>
                                            <strong>Other</strong>
                                        </button>
                                    </div>
                                    <input type="hidden" id="twoNotCompletedReason" value="">

                                    <!-- Details Section (Step 2 - shown after reason selected) -->
                                    <div id="twoReasonDetails" class="hidden" style="margin-top: 20px;">

                                        <!-- Selected reason header -->
                                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; padding: 12px; background: #ffebee; border-radius: 8px;">
                                            <span id="twoSelectedReasonText" style="font-weight: 600; color: #c62828;"></span>
                                            <button type="button" onclick="changeReason()" style="background: none; border: none; color: #1976d2; cursor: pointer; font-size: 14px;">Change</button>
                                        </div>

                                        <!-- Wrong Part Section -->
                                        <div id="twoWrongPartSection" class="hidden" style="margin-bottom: 16px; padding: 16px; background: #fff8e1; border-radius: 8px; border: 2px solid #ff9800;">
                                            <h4 style="font-size: 15px; font-weight: 700; color: #e65100; margin-bottom: 16px;">üìê Measurements & Photo Required</h4>

                                            <div class="form-group">
                                                <label class="form-label" style="font-weight: 600;">Measurements of Correct Part</label>
                                                <textarea id="twoWrongPartMeasurements" class="form-input" rows="3"
                                                          placeholder="Length, width, thickness, hole spacing, bolt size..."
                                                          style="font-size: 16px;"></textarea>
                                            </div>

                                            <div class="form-group" style="margin-top: 16px;">
                                                <label class="form-label" style="font-weight: 600;">üì∑ Photo of a CORRECT Part</label>
                                                <p style="font-size: 12px; color: #6c757d; margin-bottom: 8px;">Find a working part nearby and photo it</p>
                                                <div id="twoWrongPartPhotoArea" style="border: 2px dashed #ff9800; border-radius: 8px; padding: 20px; text-align: center; cursor: pointer; background: white;"
                                                     onclick="document.getElementById('twoWrongPartPhotoInput').click()">
                                                    <span style="font-size: 28px;">üì∑</span>
                                                    <p style="font-weight: 600; color: #e65100; margin-top: 8px;">Tap to photo working part</p>
                                                    <input type="file" id="twoWrongPartPhotoInput" accept="image/*" capture="environment" style="display: none;" onchange="handleWrongPartPhotoUpload(event)">
                                                </div>
                                                <div id="twoWrongPartPhotoPreview" class="hidden" style="margin-top: 12px;"></div>
                                            </div>

                                            <div class="form-group" style="margin-top: 12px;">
                                                <div style="border: 1px dashed #dee2e6; border-radius: 8px; padding: 12px; text-align: center; cursor: pointer; background: white;"
                                                     onclick="document.getElementById('twoWrongPartSentPhotoInput').click()">
                                                    <span style="color: #6c757d; font-size: 14px;">+ Photo of wrong part (optional)</span>
                                                    <input type="file" id="twoWrongPartSentPhotoInput" accept="image/*" capture="environment" style="display: none;" onchange="handleWrongPartSentPhotoUpload(event)">
                                                </div>
                                                <div id="twoWrongPartSentPhotoPreview" style="margin-top: 8px;"></div>
                                            </div>
                                        </div>

                                        <!-- More Work Section - just needs a photo -->
                                        <div id="twoMoreWorkSection" class="hidden" style="margin-bottom: 16px; padding: 16px; background: #e3f2fd; border-radius: 8px; border: 2px solid #2196f3;">
                                            <h4 style="font-size: 15px; font-weight: 700; color: #1565c0; margin-bottom: 12px;">üì∑ Photo the Issue</h4>
                                            <div id="twoMoreWorkPhotoArea" style="border: 2px dashed #2196f3; border-radius: 8px; padding: 20px; text-align: center; cursor: pointer; background: white;"
                                                 onclick="document.getElementById('twoMoreWorkPhotoInput').click()">
                                                <span style="font-size: 28px;">üì∑</span>
                                                <p style="font-weight: 600; color: #1565c0; margin-top: 8px;">Tap to photo the damage/issue</p>
                                                <input type="file" id="twoMoreWorkPhotoInput" accept="image/*" capture="environment" style="display: none;" onchange="handleMoreWorkPhotoUpload(event)">
                                            </div>
                                            <div id="twoMoreWorkPhotoPreview" class="hidden" style="margin-top: 12px;"></div>
                                        </div>

                                        <!-- Notes field -->
                                        <div class="form-group">
                                            <label class="form-label" style="font-weight: 600;">
                                                Notes <span id="twoNotesRequired" style="color: #dc3545;">*Required</span>
                                            </label>
                                            <textarea id="twoNotCompletedDetails" class="form-input" rows="2"
                                                      placeholder="Brief explanation..."
                                                      style="font-size: 16px;"></textarea>
                                        </div>

                                        <button class="btn" onclick="submitJobNotCompleted()"
                                                style="width: 100%; padding: 16px; font-size: 16px; background: #c62828; border-color: #c62828; color: white; margin-top: 16px;">
                                            Close Job
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Airtable API Configuration - 2,142 real Hussey parts
        const AIRTABLE_BASE_ID = 'appAT4ZwbRAgIyzUW';
        const AIRTABLE_TABLE_ID = 'tbl4mDv20NaJnaaN7';
        const AIRTABLE_API_KEY = 'YOUR_AIRTABLE_API_KEY_HERE';

        // Data Storage
        // Customer hierarchy: Customer (billing entity) ‚Üí Locations (schools/sites)
        const CUSTOMERS = [
            {
                id: 'cust1',
                name: 'Lauderdale County Schools',
                type: 'county',
                billingAddress: '100 S Jefferson St, Ripley, TN 38063',
                contact: 'Mike Mann',
                phone: '(731) 635-2941',
                mobile: '(479) 883-4283',
                locations: [
                    { id: 'loc1', name: 'Ripley High School', address: '254 S Jefferson St, Ripley, TN 38063', contact: 'Chris McCorkle', phone: '(731) 635-2642' },
                    { id: 'loc2', name: 'Ripley Middle School', address: '309 Charles Griggs St, Ripley, TN 38063', contact: 'Janet Williams', phone: '(731) 635-1500' },
                    { id: 'loc3', name: 'Ripley Elementary School', address: '100 Hwy 19 E, Ripley, TN 38063', contact: 'Tom Harris', phone: '(731) 635-1400' },
                    { id: 'loc4', name: 'Ripley Primary School', address: '225 Volz Rd, Ripley, TN 38063', contact: 'Sue Adams', phone: '(731) 635-1300' }
                ]
            },
            {
                id: 'cust2',
                name: 'Wilson County Schools',
                type: 'county',
                billingAddress: '415 Harding Dr, Lebanon, TN 37087',
                contact: 'Tom Anderson',
                phone: '(615) 444-3282',
                locations: [
                    { id: 'loc5', name: 'Wilson Central High School', address: '1414 Baddour Pkwy, Lebanon, TN 37087', contact: 'David Brown', phone: '(615) 443-5765' },
                    { id: 'loc6', name: 'Mt. Juliet High School', address: '501 N Greenhill Rd, Mt Juliet, TN 37122', contact: 'Karen White', phone: '(615) 758-6004' },
                    { id: 'loc7', name: 'Lebanon High School', address: '907 Coles Ferry Pike, Lebanon, TN 37090', contact: 'James Miller', phone: '(615) 449-6040' }
                ]
            },
            {
                id: 'cust3',
                name: 'Williamson County Schools',
                type: 'county',
                billingAddress: '1320 W Main St, Franklin, TN 37064',
                contact: 'Sarah Thompson',
                phone: '(615) 472-4000',
                locations: [
                    { id: 'loc8', name: 'Franklin High School', address: '810 Hillsboro Rd, Franklin, TN 37064', contact: 'Mike Davis', phone: '(615) 794-6624' },
                    { id: 'loc9', name: 'Brentwood High School', address: '5304 Murray Ln, Brentwood, TN 37027', contact: 'Lisa Chen', phone: '(615) 472-4450' },
                    { id: 'loc10', name: 'Independence High School', address: '1776 Declaration Way, Thompson Station, TN 37179', contact: 'Robert Taylor', phone: '(615) 472-4980' }
                ]
            },
            {
                id: 'cust4',
                name: 'Brentwood Academy',
                type: 'private',
                billingAddress: '219 Granny White Pike, Brentwood, TN 37027',
                contact: 'John Smith',
                phone: '(615) 373-0611',
                locations: [
                    { id: 'loc11', name: 'Main Campus', address: '219 Granny White Pike, Brentwood, TN 37027', contact: 'John Smith', phone: '(615) 373-0611' },
                    { id: 'loc12', name: 'Athletic Complex', address: '219 Granny White Pike, Brentwood, TN 37027', contact: 'Coach Roberts', phone: '(615) 373-0612' }
                ]
            },
            {
                id: 'cust5',
                name: 'Montgomery Bell Academy',
                type: 'private',
                billingAddress: '4001 Harding Rd, Nashville, TN 37205',
                contact: 'Sarah Johnson',
                phone: '(615) 298-5514',
                locations: [
                    { id: 'loc13', name: 'Main Gymnasium', address: '4001 Harding Rd, Nashville, TN 37205', contact: 'Sarah Johnson', phone: '(615) 298-5514' }
                ]
            },
            {
                id: 'cust6',
                name: 'Lipscomb Academy',
                type: 'private',
                billingAddress: '3901 Granny White Pike, Nashville, TN 37204',
                contact: 'Emily Wilson',
                phone: '(615) 966-1000',
                locations: [
                    { id: 'loc14', name: 'Allen Arena', address: '3901 Granny White Pike, Nashville, TN 37204', contact: 'Emily Wilson', phone: '(615) 966-1000' },
                    { id: 'loc15', name: 'Student Activity Center', address: '3901 Granny White Pike, Nashville, TN 37204', contact: 'Mark Jones', phone: '(615) 966-1001' }
                ]
            },
            {
                id: 'jackson',
                name: 'Madison County Schools',
                type: 'county',
                billingAddress: '668 Lexington Ave, Jackson TN 38301',
                contact: 'Chris Johnson',
                phone: '(731) 506-3069',
                mobile: '(731) 267-6834',
                locations: [
                    { id: 'jackson_career', name: 'Jackson Career And Technology Elementary', address: '668 Lexington Ave, Jackson TN 38301', contact: 'Chris Johnson', phone: '(731) 506-3069' }
                ]
            }
        ];

        // Job types matching ServicePal
        const JOB_TYPES = ['Go See', 'Service Call', 'Repair', 'Inspection'];

        // Job statuses
        const JOB_STATUSES = ['New', 'In Progress', 'Parts Ordered', 'Parts Received', 'Scheduled', 'Completed', 'Pink'];

        // Legacy support - flat customer list for backwards compatibility
        const SAMPLE_CUSTOMERS = CUSTOMERS.flatMap(c =>
            c.locations.map(loc => ({
                id: loc.id,
                customerId: c.id,
                customerName: c.name,
                customerType: c.type,
                name: loc.name,
                address: loc.address,
                contact: loc.contact,
                phone: loc.phone,
                billingContact: c.contact,
                billingPhone: c.phone,
                billingAddress: c.billingAddress
            }))
        );

        // Categories loaded from Airtable
        let partsCategories = [];

        // Store search results for part selection
        let searchResults = {};

        let inspections = JSON.parse(localStorage.getItem('inspections') || '[]');
        let jobs = JSON.parse(localStorage.getItem('jobs') || '[]');
        let currentInspection = {};
        let currentRole = '';

        // Inspection type checklist definitions
        const CHECKLISTS = {
            basketball: [
                'Goals are regulation height',
                'Backboard/goals are level',
                'Backboard, goal and padding is code compliant',
                'Inspected all attachment hardware for structure',
                'All hardware has been installed properly',
                'All pivot points and related mechanisms lubricated',
                'Hoist mechanism (winches) secure and operational',
                'Hoist cable inspected',
                'Limit switches in electric winches tested',
                'Tested all winches',
                'Test safety strap type mechanism for proper function'
            ],
            bleacherUnderstructure: [
                'Tier catches, Caster wheels, Axles and E-clips checked',
                'Hardware on each knee/cross bracing checked',
                'Clearance between frames and deck supports verified',
                'Wall buck properly affixed with all hardware in place',
                'All floor anchors in place and tight',
                'All motors pulling properly (checked for leaking oil, chains)',
                'Back frames on wheel or stationary verified'
            ],
            bleacherTopSide: [
                'Visually inspect all end rail brackets',
                'Shake each end rail - brackets secure and rails seated properly',
                'End rails are code compliant',
                'All aisle rails brackets are secure',
                'All aisle steps are secure',
                'Walked each row looking for broken or soft deck boards',
                'Operated each flex row for smooth release and lock out',
                'Skirt panels are properly attached',
                'Examined seats/brackets - noted damaged or missing seats'
            ],
            outdoorUnderstructure: [
                'Check for missing seat and foot plank clips',
                'Hardware on each knee/cross bracing checked',
                'All anchors in place and tight',
                'Loose hardware addressed'
            ],
            outdoorTopSide: [
                'Visually inspect guard rail system (code compliant)',
                'All aisle rails brackets are secure',
                'All walkway and ADA ramps are code compliant',
                'All handrails are secure',
                'Walked each row - no broken or bent foot planks',
                'Each seat plank properly affixed - no broken/bent planks',
                'Noted special features (band riser, chairs, reserved seating)',
                'Noted style of end cap',
                'Footboard elevation on last row does not exceed 30" from grade',
                'Seatboard elevation on last row does not exceed 55" from grade'
            ]
        };

        // Current inspection type
        let currentInspectionType = '';
        let goalInspections = [];
        let issuesList = [];

        // NEW: Multi-bank job system
        let inspectionJobs = JSON.parse(localStorage.getItem('inspectionJobs')) || [];
        let currentJob = null;
        let currentBankIndex = 0;
        let currentIssueType = '';
        let nextJobNumber = parseInt(localStorage.getItem('nextJobNumber')) || 17500;

        // Sample inspection data - Job #16942 Jackson Career And Technology Elementary
        const SAMPLE_INSPECTION_JOBS = [
            {
                jobNumber: 16942,
                status: 'submitted',
                customerId: 'jackson',
                customerName: 'Madison County Schools',
                locationId: 'jackson_career',
                locationName: 'Jackson Career And Technology Elementary',
                locationAddress: '668 Lexington Ave, Jackson TN 38301',
                inspectionType: 'bleacher',
                inspectorName: 'Danny Mendl',
                inspectorCertificate: 'MXM00-980',
                createdAt: '2026-01-12T10:00:00',
                submittedAt: '2026-01-12T15:30:00',
                quickQuestions: {
                    basketballGoals: 6,
                    safetyStraps: 4,
                    fixedGoals: 2,
                    edgePads: 6
                },
                banks: [
                    {
                        name: 'West Side',
                        bleacherType: 'Interkal',
                        tiers: 5,
                        rise: '10 1/4"',
                        rowSpacing: '24"',
                        seatType: 'SSM - Sculpture Seat Module',
                        seatMaterial: 'Plastic',
                        seatColor: 'Red(6)',
                        comments: '10" seats',
                        workingDirection: 'Left to Right',
                        motorPhase: 3,
                        motorHP: '1/2',
                        numberOfMotors: 4,
                        wheelsPerMotor: 4,
                        wheelType: 'Interkal Wide Track/Torque Tube',
                        backFrameType: 'Rolling Back Frame',
                        wiringCondition: 'Good',
                        sections: 4,
                        rows: 5,
                        aisles: 3,
                        aisleRailType: 'P',
                        seatCountPerSection: '7 - 14 - 15 - 7',
                        understructureChecklist: {
                            tierCatches: true,
                            hardware: true,
                            clearance: true,
                            wallBuck: true,
                            floorAnchors: true,
                            motors: true,
                            backFrames: true
                        },
                        topSideChecklist: {
                            endRailBrackets: true,
                            endRailsSecure: true,
                            endRailsCompliant: true,
                            aisleRails: true,
                            aisleSteps: true,
                            deckBoards: true,
                            flexRow: 'N/A',
                            skirtPanels: true,
                            seats: true,
                            endRailsCodeCompliant: true
                        },
                        understructureIssues: [
                            { frame: '3', tier: '1', description: 'Loose deck support', photo: null },
                            { frame: '3', tier: '', description: 'ADA cutout missing bolt - button', photo: null }
                        ],
                        topSideIssues: [
                            { section: '', row: '1', description: 'RH end outrigger wheel is loose', photo: null },
                            { section: '', row: '', description: 'Skirt board 3 is broken 3/4 x 4 1/4 x 26\'. Medium maple', photo: null },
                            { section: '3', row: '2', description: 'Hex bolt holding up bracket', photo: null },
                            { section: '', row: '', description: 'Missing skid tape aisle 1 nose 4', photo: null },
                            { section: '', row: '', description: 'Damaged skid tape aisle 2 nose 3', photo: null }
                        ],
                        safetyIssues: 'Some skid tape is missing and damaged.',
                        functionalIssues: 'One deck support is loose.',
                        cosmeticIssues: 'One skirt board is broken. One outrigger wheel is loose',
                        tagAffixed: true
                    },
                    {
                        name: 'East Side',
                        bleacherType: 'Interkal',
                        tiers: 5,
                        rise: '10 1/4"',
                        rowSpacing: '24"',
                        seatType: 'SSM - Sculpture Seat Module',
                        seatMaterial: 'Plastic',
                        seatColor: 'Red (6)',
                        comments: '10" seat',
                        workingDirection: 'Left to Right',
                        motorPhase: 3,
                        motorHP: '1/2',
                        numberOfMotors: 3,
                        wheelsPerMotor: 4,
                        wheelType: 'Interkal Wide Track/Torque Tube',
                        backFrameType: 'Rolling Back Frame',
                        wiringCondition: 'Good',
                        sections: 4,
                        rows: 5,
                        aisles: 3,
                        aisleRailType: 'P',
                        seatCountPerSection: '7 - 15 - 14 - 7',
                        understructureChecklist: {
                            tierCatches: true,
                            hardware: true,
                            clearance: true,
                            wallBuck: true,
                            floorAnchors: true,
                            motors: true,
                            backFrames: true
                        },
                        topSideChecklist: {
                            endRailBrackets: true,
                            endRailsSecure: true,
                            endRailsCompliant: true,
                            aisleRails: true,
                            aisleSteps: true,
                            deckBoards: true,
                            flexRow: 'N/A',
                            skirtPanels: true,
                            seats: true,
                            endRailsCodeCompliant: true
                        },
                        understructureIssues: [
                            { frame: 'Motor 2', tier: '', description: 'Broken gear motor', photo: null }
                        ],
                        topSideIssues: [
                            { section: '', row: '', description: 'Aisle 2 nose 1,2,3,4 have damaged skid tape', photo: null },
                            { section: '', row: '', description: 'Aisle 1 step 1,3 and nose 4 have damaged skid tape', photo: null },
                            { section: '', row: '', description: 'Aisle 3 nose 3 has missing skid tape', photo: null },
                            { section: '', row: '', description: 'Skirt board 1 is missing a bracket', photo: null },
                            { section: '1', row: '', description: 'Outrigger wheel is loose', photo: null },
                            { section: '', row: '', description: 'LH end rail 1 missing bolt', photo: null },
                            { section: '', row: '', description: 'RH end outrigger wheel is loose', photo: null }
                        ],
                        safetyIssues: 'One end rail is loose and needs securing. Some tread tape is missing or damaged',
                        functionalIssues: 'A couple of outrigger wheels are loose and need securing',
                        cosmeticIssues: 'One skirt board is missing a bracket',
                        tagAffixed: true
                    }
                ],
                selectedParts: []
            }
        ];

        // Initialize
        function init() {
            populateCustomers();
            populateJobCustomers();
            populateCategories();
            updateDashboardStats();

            // Load sample data if no jobs exist
            if (inspectionJobs.length === 0) {
                inspectionJobs = [...SAMPLE_INSPECTION_JOBS];
                localStorage.setItem('inspectionJobs', JSON.stringify(inspectionJobs));
            }

            loadInspectionJobs();
        }

        // Populate job customer dropdown
        function populateJobCustomers() {
            const select = document.getElementById('jobCustomerSelect');
            if (!select) return;

            let html = '<option value="">Select a customer...</option>';
            CUSTOMERS.forEach(customer => {
                const icon = customer.type === 'county' ? 'üèõÔ∏è' : 'üè´';
                html += `<optgroup label="${icon} ${customer.name}">`;
                customer.locations.forEach(location => {
                    html += `<option value="${location.id}"
                              data-customer-id="${customer.id}"
                              data-customer-name="${customer.name}"
                              data-location-name="${location.name}"
                              data-location-address="${location.address}">
                              üìç ${location.name}
                            </option>`;
                });
                html += '</optgroup>';
            });
            select.innerHTML = html;
        }

        // Start new job
        function startNewJob() {
            currentJob = {
                jobNumber: nextJobNumber,
                banks: [],
                selectedParts: [],
                status: 'in_progress',
                createdAt: new Date().toISOString()
            };

            // For office users, need to switch to tech dashboard to access inspection form
            if (currentRole === 'office') {
                document.getElementById('officeDashboard').classList.add('hidden');
                document.getElementById('techDashboard').classList.remove('hidden');
            }

            // Populate form
            populateJobCustomers();
            document.getElementById('jobNumberInput').value = nextJobNumber;
            document.getElementById('jobDateInput').value = new Date().toISOString().split('T')[0];
            document.getElementById('jobInspectionType').value = 'bleacher';
            document.getElementById('jobCustomerSelect').value = '';
            document.getElementById('jobCustomerInfo').classList.add('hidden');

            // Show job setup view
            hideAllViews();
            document.getElementById('newJobSetupView').classList.remove('hidden');
        }

        // Update job customer info display
        function updateJobCustomerInfo() {
            const select = document.getElementById('jobCustomerSelect');
            const locationId = select.value;
            const info = document.getElementById('jobCustomerInfo');

            if (locationId) {
                const option = select.options[select.selectedIndex];
                const customerId = option.dataset.customerId;
                const customerName = option.dataset.customerName;
                const locationName = option.dataset.locationName;
                const locationAddress = option.dataset.locationAddress;

                document.getElementById('jobBillingEntity').textContent = customerName;
                document.getElementById('jobServiceLocation').textContent = locationName;
                document.getElementById('jobServiceAddress').textContent = locationAddress;

                info.classList.remove('hidden');

                // Store in current job
                currentJob.customerId = customerId;
                currentJob.customerName = customerName;
                currentJob.locationId = locationId;
                currentJob.locationName = locationName;
                currentJob.locationAddress = locationAddress;
            } else {
                info.classList.add('hidden');
            }
        }

        // Create job and add first bank
        function createJobAndAddBank() {
            if (!currentJob.locationId) {
                alert('Please select a customer/location');
                return;
            }

            currentJob.inspectionType = document.getElementById('jobInspectionType').value;
            currentJob.inspectionDate = document.getElementById('jobDateInput').value;

            // Increment job number for next time
            nextJobNumber++;
            localStorage.setItem('nextJobNumber', nextJobNumber);

            // Add first bank
            currentBankIndex = 0;
            currentJob.banks.push(createNewBank('East Side'));

            // Show bank inspection view
            showBankInspection();
        }

        // Create a new bank object
        function createNewBank(name) {
            return {
                name: name,
                bleacherType: '',
                tiers: '',
                seatType: '',
                color: '',
                sections: '',
                rows: '',
                aisles: '',
                aisleRailType: 'P',
                motorPhase: 'Single',
                motorHP: '',
                motorCount: '',
                wheelType: '',
                topSideIssues: [],
                understructureIssues: [],
                safetyIssues: '',
                mechanicalIssues: '',
                cosmeticIssues: '',
                tagAffixed: 'yes'
            };
        }

        // Show bank inspection view
        function showBankInspection() {
            hideAllViews();
            document.getElementById('bankInspectionView').classList.remove('hidden');

            // Update header
            document.getElementById('bankJobNumber').textContent = currentJob.jobNumber;
            document.getElementById('bankCustomerName').textContent = currentJob.locationName;
            document.getElementById('bankCount').textContent = currentJob.banks.length;

            // Render bank tabs
            renderBankTabs();

            // Load current bank data
            loadBankData();

            // Render checklists
            renderChecklist('topSideChecklist', CHECKLISTS.bleacherTopSide);
            renderChecklist('understructureChecklist', CHECKLISTS.bleacherUnderstructure);
        }

        // Render bank tabs
        function renderBankTabs() {
            const container = document.getElementById('bankTabs');
            container.innerHTML = currentJob.banks.map((bank, i) => `
                <button class="btn ${i === currentBankIndex ? 'btn-primary' : 'btn-outline'}"
                        onclick="switchToBank(${i})"
                        style="font-size: 13px; padding: 8px 16px;">
                    ${bank.name}
                </button>
            `).join('') + `
                <button class="btn btn-outline" onclick="addNewBank()" style="font-size: 13px; padding: 8px 16px; border-style: dashed;">
                    + Add Bank
                </button>
            `;
        }

        // Switch to a different bank
        function switchToBank(index) {
            saveBankData(); // Save current first
            currentBankIndex = index;
            loadBankData();
            renderBankTabs();
        }

        // Add new bank
        function addNewBank() {
            saveBankData();
            const bankNames = ['East Side', 'West Side', 'Facing Logo', 'Behind Logo', 'North Side', 'South Side'];
            const usedNames = currentJob.banks.map(b => b.name);
            const nextName = bankNames.find(n => !usedNames.includes(n)) || `Bank ${currentJob.banks.length + 1}`;

            currentJob.banks.push(createNewBank(nextName));
            currentBankIndex = currentJob.banks.length - 1;
            loadBankData();
            renderBankTabs();
            document.getElementById('bankCount').textContent = currentJob.banks.length;
        }

        // Load bank data into form
        function loadBankData() {
            const bank = currentJob.banks[currentBankIndex];
            if (!bank) return;

            document.getElementById('currentBankName').textContent = bank.name;
            document.getElementById('bankBleacherType').value = bank.bleacherType || '';
            document.getElementById('bankTiers').value = bank.tiers || '';
            document.getElementById('bankSeatType').value = bank.seatType || '';
            document.getElementById('bankColor').value = bank.color || '';
            document.getElementById('bankSections').value = bank.sections || '';
            document.getElementById('bankRows').value = bank.rows || '';
            document.getElementById('bankAisles').value = bank.aisles || '';
            document.getElementById('bankAisleRailType').value = bank.aisleRailType || 'P';
            document.getElementById('bankMotorPhase').value = bank.motorPhase || 'Single';
            document.getElementById('bankMotorHP').value = bank.motorHP || '';
            document.getElementById('bankMotorCount').value = bank.motorCount || '';
            document.getElementById('bankWheelType').value = bank.wheelType || '';
            document.getElementById('bankSafetyIssues').value = bank.safetyIssues || '';
            document.getElementById('bankMechanicalIssues').value = bank.mechanicalIssues || '';
            document.getElementById('bankCosmeticIssues').value = bank.cosmeticIssues || '';
            document.getElementById('bankTagAffixed').value = bank.tagAffixed || 'yes';

            renderTopSideIssues();
            renderUnderstructureIssues();
        }

        // Save bank data from form
        function saveBankData() {
            const bank = currentJob.banks[currentBankIndex];
            if (!bank) return;

            bank.bleacherType = document.getElementById('bankBleacherType').value;
            bank.tiers = document.getElementById('bankTiers').value;
            bank.seatType = document.getElementById('bankSeatType').value;
            bank.color = document.getElementById('bankColor').value;
            bank.sections = document.getElementById('bankSections').value;
            bank.rows = document.getElementById('bankRows').value;
            bank.aisles = document.getElementById('bankAisles').value;
            bank.aisleRailType = document.getElementById('bankAisleRailType').value;
            bank.motorPhase = document.getElementById('bankMotorPhase').value;
            bank.motorHP = document.getElementById('bankMotorHP').value;
            bank.motorCount = document.getElementById('bankMotorCount').value;
            bank.wheelType = document.getElementById('bankWheelType').value;
            bank.safetyIssues = document.getElementById('bankSafetyIssues').value;
            bank.mechanicalIssues = document.getElementById('bankMechanicalIssues').value;
            bank.cosmeticIssues = document.getElementById('bankCosmeticIssues').value;
            bank.tagAffixed = document.getElementById('bankTagAffixed').value;
        }

        // Edit bank name
        function editBankName() {
            const nameEl = document.getElementById('currentBankName');
            const selectEl = document.getElementById('bankNameSelect');
            const editBtn = document.getElementById('editBankNameBtn');

            selectEl.value = nameEl.textContent;
            selectEl.style.display = 'block';
            nameEl.style.display = 'none';
            editBtn.style.display = 'none';
        }

        // Update bank name from select
        function updateBankName() {
            const nameEl = document.getElementById('currentBankName');
            const selectEl = document.getElementById('bankNameSelect');
            const editBtn = document.getElementById('editBankNameBtn');

            const newName = selectEl.value;
            nameEl.textContent = newName;
            currentJob.banks[currentBankIndex].name = newName;

            selectEl.style.display = 'none';
            nameEl.style.display = 'inline';
            editBtn.style.display = 'inline';

            renderBankTabs();
        }

        // Toggle section visibility
        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            const isHidden = section.style.display === 'none';
            section.style.display = isHidden ? 'block' : 'none';

            const toggleId = sectionId === 'topSideSection' ? 'topSideToggle' : 'understructureToggle';
            document.getElementById(toggleId).textContent = isHidden ? '‚ñº' : '‚ñ∂';
        }

        // Open add issue modal
        function openAddIssueModal() {
            document.getElementById('addIssueModal').classList.remove('hidden');
            document.getElementById('addIssueModal').style.display = 'flex';
            resetIssueModal();
        }

        // Close add issue modal
        function closeAddIssueModal() {
            document.getElementById('addIssueModal').classList.add('hidden');
            document.getElementById('addIssueModal').style.display = 'none';
        }

        // Reset issue modal
        function resetIssueModal() {
            currentIssueType = '';
            document.getElementById('issueTypeTopSide').classList.remove('btn-primary');
            document.getElementById('issueTypeTopSide').classList.add('btn-outline');
            document.getElementById('issueTypeUnder').classList.remove('btn-primary');
            document.getElementById('issueTypeUnder').classList.add('btn-outline');
            document.getElementById('issueLocationFields').classList.add('hidden');
            document.getElementById('topSideLocationFields').classList.add('hidden');
            document.getElementById('underLocationFields').classList.add('hidden');
            document.getElementById('issueDescription').value = '';
            document.getElementById('issueSection').value = '';
            document.getElementById('issueRow').value = '';
            document.getElementById('issueAisle').value = '';
            document.getElementById('issueFrame').value = '';
            document.getElementById('issueTier').value = '';
            document.getElementById('issuePhotoPreview').innerHTML = '<div style="text-align: center; color: #6c757d;"><div style="font-size: 32px;">üì∑</div><div style="font-size: 13px;">Tap to take photo</div></div>';
        }

        // Select issue type
        function selectIssueType(type) {
            currentIssueType = type;

            document.getElementById('issueTypeTopSide').classList.toggle('btn-primary', type === 'topSide');
            document.getElementById('issueTypeTopSide').classList.toggle('btn-outline', type !== 'topSide');
            document.getElementById('issueTypeUnder').classList.toggle('btn-primary', type === 'understructure');
            document.getElementById('issueTypeUnder').classList.toggle('btn-outline', type !== 'understructure');

            document.getElementById('issueLocationFields').classList.remove('hidden');
            document.getElementById('topSideLocationFields').classList.toggle('hidden', type !== 'topSide');
            document.getElementById('underLocationFields').classList.toggle('hidden', type !== 'understructure');
        }

        // Preview issue photo
        function previewIssuePhoto(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('issuePhotoPreview').innerHTML = `
                        <img src="${e.target.result}" style="max-width: 100%; max-height: 150px; border-radius: 8px;">
                    `;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        // Save issue
        function saveIssue() {
            if (!currentIssueType) {
                alert('Please select issue type (Top Side or Understructure)');
                return;
            }

            const description = document.getElementById('issueDescription').value.trim();
            if (!description) {
                alert('Please enter a description');
                return;
            }

            const bank = currentJob.banks[currentBankIndex];
            const photoInput = document.getElementById('issuePhotoInput');
            let photoData = null;

            if (photoInput.files && photoInput.files[0]) {
                // In a real app, we'd upload this. For demo, store base64
                const reader = new FileReader();
                reader.onload = function(e) {
                    photoData = e.target.result;
                    completeIssueSave(bank, description, photoData);
                };
                reader.readAsDataURL(photoInput.files[0]);
            } else {
                completeIssueSave(bank, description, null);
            }
        }

        function completeIssueSave(bank, description, photoData) {
            const issue = {
                id: Date.now(),
                description: description,
                photo: photoData,
                createdAt: new Date().toISOString()
            };

            if (currentIssueType === 'topSide') {
                issue.section = document.getElementById('issueSection').value;
                issue.row = document.getElementById('issueRow').value;
                issue.aisle = document.getElementById('issueAisle').value;
                bank.topSideIssues.push(issue);
                renderTopSideIssues();
            } else {
                issue.frame = document.getElementById('issueFrame').value;
                issue.tier = document.getElementById('issueTier').value;
                bank.understructureIssues.push(issue);
                renderUnderstructureIssues();
            }

            closeAddIssueModal();
        }

        // Add top side issue (shortcut)
        function addTopSideIssue() {
            openAddIssueModal();
            selectIssueType('topSide');
        }

        // Add understructure issue (shortcut)
        function addUnderstructureIssue() {
            openAddIssueModal();
            selectIssueType('understructure');
        }

        // Render top side issues
        function renderTopSideIssues() {
            const bank = currentJob.banks[currentBankIndex];
            const container = document.getElementById('topSideIssuesList');

            if (!bank.topSideIssues || bank.topSideIssues.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 24px; color: #6c757d; background: #f8f9fa; border-radius: 8px;">
                        <div style="font-size: 32px; margin-bottom: 8px;">üëÄ</div>
                        <p>No top side issues documented yet</p>
                        <p style="font-size: 12px; margin-top: 4px;">Walk the bleachers and tap + to add issues</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = bank.topSideIssues.map((issue, i) => `
                <div style="background: #fff; border: 1px solid #e9ecef; border-radius: 8px; padding: 12px; margin-bottom: 8px; display: flex; gap: 12px;">
                    ${issue.photo ? `<img src="${issue.photo}" style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">` : ''}
                    <div style="flex: 1;">
                        <div style="font-size: 12px; color: #1565c0; margin-bottom: 4px;">
                            ${issue.section ? `Section ${issue.section}` : ''} ${issue.row ? `Row ${issue.row}` : ''} ${issue.aisle ? `Aisle ${issue.aisle}` : ''}
                        </div>
                        <div style="font-size: 14px;">${issue.description}</div>
                    </div>
                    <button onclick="deleteTopSideIssue(${i})" style="background: none; border: none; color: #dc3545; cursor: pointer; font-size: 16px;">√ó</button>
                </div>
            `).join('');
        }

        // Render understructure issues
        function renderUnderstructureIssues() {
            const bank = currentJob.banks[currentBankIndex];
            const container = document.getElementById('understructureIssuesList');

            if (!bank.understructureIssues || bank.understructureIssues.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 24px; color: #6c757d; background: #f8f9fa; border-radius: 8px;">
                        <div style="font-size: 32px; margin-bottom: 8px;">üîç</div>
                        <p>No understructure issues documented yet</p>
                        <p style="font-size: 12px; margin-top: 4px;">Check motors, frames, wheels and tap + to add issues</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = bank.understructureIssues.map((issue, i) => `
                <div style="background: #fff; border: 1px solid #e9ecef; border-radius: 8px; padding: 12px; margin-bottom: 8px; display: flex; gap: 12px;">
                    ${issue.photo ? `<img src="${issue.photo}" style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">` : ''}
                    <div style="flex: 1;">
                        <div style="font-size: 12px; color: #c2185b; margin-bottom: 4px;">
                            ${issue.frame ? `Frame ${issue.frame}` : ''} ${issue.tier ? `Tier ${issue.tier}` : ''}
                        </div>
                        <div style="font-size: 14px;">${issue.description}</div>
                    </div>
                    <button onclick="deleteUnderstructureIssue(${i})" style="background: none; border: none; color: #dc3545; cursor: pointer; font-size: 16px;">√ó</button>
                </div>
            `).join('');
        }

        // Delete issues
        function deleteTopSideIssue(index) {
            currentJob.banks[currentBankIndex].topSideIssues.splice(index, 1);
            renderTopSideIssues();
        }

        function deleteUnderstructureIssue(index) {
            currentJob.banks[currentBankIndex].understructureIssues.splice(index, 1);
            renderUnderstructureIssues();
        }

        // Save bank and add another
        function saveBankAndAddAnother() {
            saveBankData();
            addNewBank();
        }

        // Save bank and finish job
        function saveBankAndFinishJob() {
            saveBankData();
            showJobSummary();
        }

        // Show job summary
        function showJobSummary() {
            hideAllViews();
            document.getElementById('jobSummaryView').classList.remove('hidden');

            // Populate summary
            document.getElementById('summaryJobNumber').textContent = currentJob.jobNumber;
            document.getElementById('summaryCustomerName').textContent = currentJob.locationName;
            document.getElementById('summaryAddress').textContent = currentJob.locationAddress;
            document.getElementById('summaryBankCount').textContent = currentJob.banks.length;

            // Count total issues
            let totalIssues = 0;
            currentJob.banks.forEach(bank => {
                totalIssues += (bank.topSideIssues?.length || 0) + (bank.understructureIssues?.length || 0);
            });
            document.getElementById('summaryIssueCount').textContent = totalIssues;

            // Render banks list with detailed issue breakdown
            document.getElementById('summaryBanksList').innerHTML = currentJob.banks.map((bank, bankIndex) => {
                const underIssues = bank.understructureIssues || [];
                const topIssues = bank.topSideIssues || [];
                const totalIssues = underIssues.length + topIssues.length;

                let issuesHTML = '';
                if (totalIssues > 0) {
                    if (bank.safetyIssues) {
                        issuesHTML += `<div style="background: #ffebee; padding: 8px 12px; border-radius: 4px; margin-top: 8px; border-left: 3px solid #c62828;">
                            <div style="font-size: 11px; font-weight: 600; color: #c62828; text-transform: uppercase;">Safety Issues</div>
                            <div style="font-size: 13px; margin-top: 4px;">${bank.safetyIssues}</div>
                        </div>`;
                    }
                    if (bank.functionalIssues) {
                        issuesHTML += `<div style="background: #fff3e0; padding: 8px 12px; border-radius: 4px; margin-top: 8px; border-left: 3px solid #e65100;">
                            <div style="font-size: 11px; font-weight: 600; color: #e65100; text-transform: uppercase;">Functional/Mechanical</div>
                            <div style="font-size: 13px; margin-top: 4px;">${bank.functionalIssues}</div>
                        </div>`;
                    }
                    if (bank.cosmeticIssues) {
                        issuesHTML += `<div style="background: #e3f2fd; padding: 8px 12px; border-radius: 4px; margin-top: 8px; border-left: 3px solid #1565c0;">
                            <div style="font-size: 11px; font-weight: 600; color: #1565c0; text-transform: uppercase;">Cosmetic</div>
                            <div style="font-size: 13px; margin-top: 4px;">${bank.cosmeticIssues}</div>
                        </div>`;
                    }

                    // Show individual issues
                    if (underIssues.length > 0 || topIssues.length > 0) {
                        issuesHTML += `<details style="margin-top: 12px;">
                            <summary style="cursor: pointer; font-size: 13px; color: #0066cc;">View ${totalIssues} detailed issue${totalIssues !== 1 ? 's' : ''}</summary>
                            <div style="padding: 12px 0;">`;

                        if (underIssues.length > 0) {
                            issuesHTML += `<div style="font-size: 11px; font-weight: 600; color: #6c757d; text-transform: uppercase; margin-bottom: 4px;">Understructure</div>`;
                            underIssues.forEach(issue => {
                                issuesHTML += `<div style="font-size: 13px; padding: 4px 0; border-bottom: 1px solid #f0f0f0;">
                                    ${issue.frame ? `<span style="color: #e65100;">Frame ${issue.frame}</span>` : ''}
                                    ${issue.tier ? `<span style="color: #6c757d;"> Tier ${issue.tier}</span>` : ''}
                                    ${issue.frame || issue.tier ? ' - ' : ''}${issue.description}
                                </div>`;
                            });
                        }

                        if (topIssues.length > 0) {
                            issuesHTML += `<div style="font-size: 11px; font-weight: 600; color: #6c757d; text-transform: uppercase; margin: 12px 0 4px;">Top Side</div>`;
                            topIssues.forEach(issue => {
                                issuesHTML += `<div style="font-size: 13px; padding: 4px 0; border-bottom: 1px solid #f0f0f0;">
                                    ${issue.section ? `<span style="color: #0066cc;">Section ${issue.section}</span>` : ''}
                                    ${issue.row ? `<span style="color: #6c757d;"> Row ${issue.row}</span>` : ''}
                                    ${issue.section || issue.row ? ' - ' : ''}${issue.description}
                                </div>`;
                            });
                        }

                        issuesHTML += `</div></details>`;
                    }
                }

                return `
                <div style="border: 1px solid #e9ecef; border-radius: 8px; padding: 16px; margin-bottom: 12px;">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div>
                            <div style="font-weight: 600; font-size: 16px;">${bank.name}</div>
                            <div style="font-size: 13px; color: #6c757d; margin-top: 4px;">
                                ${bank.bleacherType || 'Unknown'} ‚Ä¢ ${bank.tiers || '?'} tiers ‚Ä¢ ${bank.sections || '?'} sections ‚Ä¢ ${bank.aisles || '?'} aisles
                            </div>
                            <div style="font-size: 12px; color: #999; margin-top: 2px;">
                                ${bank.numberOfMotors || '?'} motors ‚Ä¢ ${bank.wheelType || 'Unknown wheels'}
                            </div>
                        </div>
                        <div style="background: ${totalIssues > 0 ? '#fff3e0' : '#e8f5e9'}; padding: 6px 12px; border-radius: 4px;">
                            <span style="font-weight: 600; color: ${totalIssues > 0 ? '#e65100' : '#2e7d32'};">${totalIssues}</span>
                            <span style="font-size: 12px; color: #6c757d;"> issues</span>
                        </div>
                    </div>
                    ${issuesHTML}
                </div>
            `}).join('');

            // Parts
            document.getElementById('summaryPartsCount').textContent = currentJob.selectedParts?.length || 0;
            renderSummaryParts();

            // Pre-fill inspector info from currentJob if it exists (for viewing submitted jobs)
            if (currentJob.inspectorName) {
                document.getElementById('inspectorName').value = currentJob.inspectorName;
            }
            if (currentJob.inspectorCertificate) {
                document.getElementById('inspectorCertificate').value = currentJob.inspectorCertificate;
            }

            // Update submit button based on job status
            const submitBtn = document.querySelector('#jobSummaryView .btn-primary');
            const backBtn = document.querySelector('#jobSummaryView .btn-secondary');
            if (currentJob.status === 'submitted') {
                submitBtn.innerHTML = 'üì§ Generate QuickBooks Estimate';
                submitBtn.onclick = () => generateEstimateFromJob();
                backBtn.textContent = '‚Üê Back to Inspections';
                backBtn.onclick = () => goBackFromInspection();
            } else {
                submitBtn.innerHTML = '‚úÖ Submit Inspection';
                submitBtn.onclick = () => submitJob();
                backBtn.textContent = '‚Üê Back to Inspection';
                backBtn.onclick = () => backToInspection();
            }
        }

        // Render summary parts
        function renderSummaryParts() {
            const container = document.getElementById('summaryPartsList');
            if (!currentJob.selectedParts || currentJob.selectedParts.length === 0) {
                container.innerHTML = '<p style="color: #6c757d; text-align: center;">No parts added yet</p>';
            } else {
                container.innerHTML = currentJob.selectedParts.map((part, i) => `
                    <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e9ecef;">
                        <div>
                            <span style="font-weight: 600;">${part.partNumber}</span>
                            <span style="color: #6c757d;"> - ${part.description}</span>
                        </div>
                        <div>Qty: ${part.quantity}</div>
                    </div>
                `).join('');
            }
        }

        // Back to inspection from summary
        function backToInspection() {
            showBankInspection();
        }

        // Submit job
        function submitJob() {
            currentJob.status = 'submitted';
            currentJob.submittedAt = new Date().toISOString();
            currentJob.inspectorName = document.getElementById('inspectorName').value;
            currentJob.inspectorCertificate = document.getElementById('inspectorCertificate').value;

            // Save to storage
            const existingIndex = inspectionJobs.findIndex(j => j.jobNumber === currentJob.jobNumber);
            if (existingIndex >= 0) {
                inspectionJobs[existingIndex] = currentJob;
            } else {
                inspectionJobs.push(currentJob);
            }
            localStorage.setItem('inspectionJobs', JSON.stringify(inspectionJobs));

            alert(`‚úÖ Job #${currentJob.jobNumber} submitted successfully!\n\nüéâ ${currentJob.banks.length} bank(s) inspected.\n\nOffice staff can now review and generate a QuickBooks estimate.`);

            currentJob = null;
            goBackFromInspection();
            loadInspectionJobs();
        }

        // Generate estimate from a submitted job
        function generateEstimateFromJob() {
            if (!currentJob) {
                alert('No job selected');
                return;
            }

            // Count issues and create line items
            let issueLines = [];
            currentJob.banks.forEach(bank => {
                const underIssues = bank.understructureIssues || [];
                const topIssues = bank.topSideIssues || [];

                underIssues.forEach(issue => {
                    issueLines.push(`[${bank.name}] Understructure: ${issue.description}`);
                });
                topIssues.forEach(issue => {
                    issueLines.push(`[${bank.name}] Top Side: ${issue.description}`);
                });
            });

            const partsCount = currentJob.selectedParts?.length || 0;
            const issueCount = issueLines.length;

            let message = `üì§ Generate QuickBooks Estimate\n\n`;
            message += `Job #${currentJob.jobNumber}\n`;
            message += `Customer: ${currentJob.locationName}\n`;
            message += `Address: ${currentJob.locationAddress}\n\n`;
            message += `Banks: ${currentJob.banks.length}\n`;
            message += `Issues Found: ${issueCount}\n`;
            message += `Parts Added: ${partsCount}\n\n`;

            if (issueCount > 0) {
                message += `Issues to Quote:\n`;
                issueLines.slice(0, 10).forEach(line => {
                    message += `‚Ä¢ ${line}\n`;
                });
                if (issueLines.length > 10) {
                    message += `... and ${issueLines.length - 10} more\n`;
                }
            }

            message += `\n‚ö†Ô∏è QuickBooks integration coming soon!\n`;
            message += `This will automatically create an estimate in QuickBooks.`;

            alert(message);
        }

        // Go back to job list
        function goBackToJobList() {
            if (currentJob) {
                saveBankData();
                // Save in-progress job
                const existingIndex = inspectionJobs.findIndex(j => j.jobNumber === currentJob.jobNumber);
                if (existingIndex >= 0) {
                    inspectionJobs[existingIndex] = currentJob;
                } else {
                    inspectionJobs.push(currentJob);
                }
                localStorage.setItem('inspectionJobs', JSON.stringify(inspectionJobs));
            }
            currentJob = null;
            goBackFromInspection();
            loadInspectionJobs();
        }

        // Load inspection jobs list
        function loadInspectionJobs() {
            const inProgressContainer = document.getElementById('inProgressJobsList');
            const submittedContainer = document.getElementById('submittedJobsList');

            if (!inProgressContainer || !submittedContainer) return;

            const inProgress = inspectionJobs.filter(j => j.status === 'in_progress');
            const submitted = inspectionJobs.filter(j => j.status === 'submitted');

            document.getElementById('inProgressJobsCount').textContent = inProgress.length;
            document.getElementById('submittedJobsCount').textContent = submitted.length;

            let totalBanks = 0;
            inspectionJobs.forEach(j => totalBanks += (j.banks?.length || 0));
            document.getElementById('totalBanksCount').textContent = totalBanks;

            if (inProgress.length === 0) {
                inProgressContainer.innerHTML = '<div style="padding: 24px; text-align: center; color: #6c757d;">No jobs in progress</div>';
            } else {
                inProgressContainer.innerHTML = inProgress.map(job => `
                    <div onclick="resumeJob(${job.jobNumber})" style="padding: 16px; border-bottom: 1px solid #e9ecef; cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600;">Job #${job.jobNumber}</div>
                            <div style="font-size: 14px; color: #6c757d;">${job.locationName}</div>
                            <div style="font-size: 12px; color: #e65100;">${job.banks?.length || 0} bank(s) ‚Ä¢ ${new Date(job.createdAt).toLocaleDateString()}</div>
                        </div>
                        <span style="color: #4CAF50; font-size: 20px;">‚Üí</span>
                    </div>
                `).join('');
            }

            if (submitted.length === 0) {
                submittedContainer.innerHTML = '<div style="padding: 24px; text-align: center; color: #6c757d;">No submitted jobs</div>';
            } else {
                submittedContainer.innerHTML = submitted.map(job => `
                    <div onclick="viewSubmittedJob(${job.jobNumber})" style="padding: 16px; border-bottom: 1px solid #e9ecef; cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600;">Job #${job.jobNumber}</div>
                            <div style="font-size: 14px; color: #6c757d;">${job.locationName}</div>
                            <div style="font-size: 12px; color: #2e7d32;">${job.banks?.length || 0} bank(s) ‚Ä¢ Submitted ${new Date(job.submittedAt).toLocaleDateString()}</div>
                        </div>
                        <span class="badge badge-success">Submitted</span>
                    </div>
                `).join('');
            }
        }

        // Resume in-progress job
        function resumeJob(jobNumber) {
            currentJob = inspectionJobs.find(j => j.jobNumber === jobNumber);
            if (currentJob) {
                currentBankIndex = currentJob.banks.length - 1; // Go to last bank
                showBankInspection();
            }
        }

        // View submitted job (for office review)
        function viewSubmittedJob(jobNumber) {
            currentJob = inspectionJobs.find(j => j.jobNumber === jobNumber);
            if (currentJob) {
                // For office users, need to switch to tech dashboard to see job summary
                if (currentRole === 'office') {
                    document.getElementById('officeDashboard').classList.add('hidden');
                    document.getElementById('techDashboard').classList.remove('hidden');
                }
                showJobSummary();
            }
        }

        // Hide all views helper
        function hideAllViews() {
            const views = ['techInspectionsView', 'techCreateView', 'newJobSetupView', 'bankInspectionView', 'jobSummaryView', 'newInspectionView'];
            views.forEach(v => {
                const el = document.getElementById(v);
                if (el) el.classList.add('hidden');
            });
        }

        // Open parts search from summary
        function openPartsSearch() {
            // For now, show alert. In full version, would open parts modal
            alert('Parts search will open here. For now, add parts from the main inspection form.');
        }

        // Inspection type change handler
        function onInspectionTypeChange() {
            const type = document.getElementById('inspectionTypeSelect').value;
            currentInspectionType = type;

            // Show/hide form fields
            document.getElementById('inspectionFormFields').classList.toggle('hidden', !type);
            document.getElementById('basketballFields').classList.add('hidden');
            document.getElementById('bleacherFields').classList.add('hidden');
            document.getElementById('outdoorFields').classList.add('hidden');
            document.getElementById('manufacturerSection').classList.add('hidden');

            if (type === 'basketball') {
                document.getElementById('basketballFields').classList.remove('hidden');
                document.getElementById('manufacturerSection').classList.remove('hidden');
                renderChecklist('bbChecklist', CHECKLISTS.basketball);
                goalInspections = [];
                document.getElementById('goalInspectionsContainer').innerHTML = '<p style="color: #6c757d; text-align: center;">Click "Add Goal" to inspect each basketball goal</p>';
            } else if (type === 'bleacher') {
                document.getElementById('bleacherFields').classList.remove('hidden');
                document.getElementById('manufacturerSection').classList.remove('hidden');
                renderChecklist('blUnderstructureChecklist', CHECKLISTS.bleacherUnderstructure);
                renderChecklist('blTopSideChecklist', CHECKLISTS.bleacherTopSide);
                issuesList = [];
                document.getElementById('bleacherIssuesContainer').innerHTML = '<p style="color: #6c757d; text-align: center;">Click "Add Issue" to document problems found</p>';
            } else if (type === 'outdoor') {
                document.getElementById('outdoorFields').classList.remove('hidden');
                document.getElementById('manufacturerSection').classList.remove('hidden');
                renderChecklist('outUnderstructureChecklist', CHECKLISTS.outdoorUnderstructure);
                renderChecklist('outTopSideChecklist', CHECKLISTS.outdoorTopSide);
                issuesList = [];
                document.getElementById('outdoorIssuesContainer').innerHTML = '<p style="color: #6c757d; text-align: center;">Click "Add Issue" to document problems found</p>';
            }

            // Reset form
            currentInspection = { selectedParts: [], inspectionType: type };
            renderSelectedParts();
        }

        // Render checklist items
        function renderChecklist(containerId, items) {
            const container = document.getElementById(containerId);
            container.innerHTML = items.map((item, i) => `
                <div style="display: flex; align-items: center; gap: 12px; padding: 12px; border-bottom: 1px solid #e9ecef;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; flex: 1;">
                        <input type="checkbox" id="${containerId}_${i}" style="width: 20px; height: 20px; cursor: pointer;">
                        <span style="font-size: 14px;">${item}</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 4px; color: #6c757d; font-size: 12px;">
                        <input type="checkbox" id="${containerId}_${i}_na" style="cursor: pointer;"> N/A
                    </label>
                </div>
            `).join('');
        }

        // Add basketball goal inspection
        function addGoalInspection() {
            const goalNum = goalInspections.length + 1;
            goalInspections.push({ goalNumber: goalNum });

            const container = document.getElementById('goalInspectionsContainer');
            if (goalNum === 1) container.innerHTML = '';

            container.innerHTML += `
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 16px; border-left: 4px solid #4CAF50;">
                    <h3 style="font-size: 16px; font-weight: 700; margin-bottom: 16px;">Goal #${goalNum}</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px;">
                        <div class="form-group" style="margin-bottom: 12px;">
                            <label class="form-label" style="font-size: 12px;">Goal Type</label>
                            <select id="goal${goalNum}_type" class="form-select">
                                <option value="Main">Main</option>
                                <option value="Side">Side</option>
                                <option value="Practice">Practice</option>
                            </select>
                        </div>
                        <div class="form-group" style="margin-bottom: 12px;">
                            <label class="form-label" style="font-size: 12px;">Backboard Type</label>
                            <select id="goal${goalNum}_backboard" class="form-select">
                                <option value="">Select...</option>
                                <option value="Glass 72x42">Glass 72" x 42"</option>
                                <option value="Acrylic 72x42">Acrylic 72" x 42"</option>
                                <option value="Acrylic wood 72x42">Acrylic wood 72" x 42"</option>
                                <option value="Glass 60x42">Glass 60" x 42"</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group" style="margin-bottom: 12px;">
                            <label class="form-label" style="font-size: 12px;">Winch Type</label>
                            <select id="goal${goalNum}_winch" class="form-select">
                                <option value="Manual">Manual</option>
                                <option value="Electric">Electric</option>
                            </select>
                        </div>
                        <div class="form-group" style="margin-bottom: 12px;">
                            <label class="form-label" style="font-size: 12px;">Mast Type</label>
                            <input type="text" id="goal${goalNum}_mast" class="form-input" placeholder='e.g., Center Mast 6 5/8"'>
                        </div>
                        <div class="form-group" style="margin-bottom: 12px;">
                            <label class="form-label" style="font-size: 12px;">Safety Strap Present</label>
                            <select id="goal${goalNum}_safetyStrap" class="form-select">
                                <option value="Yes Pipe Attached">Yes - Pipe Attached</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                        <div class="form-group" style="margin-bottom: 12px;">
                            <label class="form-label" style="font-size: 12px;">Safety Anchor</label>
                            <select id="goal${goalNum}_anchor" class="form-select">
                                <option value="Offset">Offset</option>
                                <option value="Direct">Direct</option>
                                <option value="N/A">N/A</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group" style="margin-top: 12px;">
                        <label class="form-label" style="font-size: 12px;">Parts and Repairs Recommendations</label>
                        <textarea id="goal${goalNum}_recommendations" class="form-textarea" placeholder="No issues found, or describe repairs needed..." style="min-height: 60px;"></textarea>
                    </div>
                </div>
            `;
        }

        // Add issue for bleacher/outdoor inspections
        function addIssue(type) {
            const issueNum = issuesList.length + 1;
            issuesList.push({ issueNumber: issueNum });

            const containerId = type === 'bleacher' ? 'bleacherIssuesContainer' : 'outdoorIssuesContainer';
            const container = document.getElementById(containerId);
            if (issueNum === 1) container.innerHTML = '';

            container.innerHTML += `
                <div style="background: #fff3e0; padding: 16px; border-radius: 8px; margin-bottom: 12px; border-left: 4px solid #ff9800;">
                    <div style="display: grid; grid-template-columns: 80px 80px 1fr; gap: 12px; align-items: start;">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label" style="font-size: 11px;">Frame/Section</label>
                            <input type="text" id="issue${issueNum}_frame" class="form-input" placeholder="e.g., 1">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label" style="font-size: 11px;">Tier/Row</label>
                            <input type="text" id="issue${issueNum}_tier" class="form-input" placeholder="e.g., 5">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label" style="font-size: 11px;">Description</label>
                            <input type="text" id="issue${issueNum}_desc" class="form-input" placeholder="e.g., Side curtain strap is missing hardware">
                        </div>
                    </div>
                </div>
            `;
        }

        function populateCustomers() {
            const select = document.getElementById('customerSelect');
            if (select) {
                // Group locations by customer (county/private entity)
                CUSTOMERS.forEach(customer => {
                    const optgroup = document.createElement('optgroup');
                    const typeLabel = customer.type === 'county' ? 'üèõÔ∏è' : 'üè´';
                    optgroup.label = `${typeLabel} ${customer.name}`;

                    customer.locations.forEach(location => {
                        const option = document.createElement('option');
                        option.value = location.id;
                        option.dataset.customerId = customer.id;
                        option.dataset.customerName = customer.name;
                        option.dataset.customerType = customer.type;
                        option.textContent = location.name;
                        optgroup.appendChild(option);
                    });

                    select.appendChild(optgroup);
                });
            }
        }

        async function populateCategories() {
            const select = document.getElementById('vendorFilter');
            if (!select) return;

            // Predefined categories from our cleaned data
            partsCategories = [
                'Controls & Safety',
                'Flex Row Parts',
                'Frames & Supports',
                'Hardware',
                'Lumber & Decking',
                'Other',
                'Panels & Closures',
                'Portable & Skids',
                'Power & Electrical',
                'Rails & Steps',
                'Rollout Parts',
                'Seating',
                'Stanchions',
                'Tools',
                'Wheels & Bearings'
            ];

            partsCategories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                select.appendChild(option);
            });
        }

        function updateDashboardStats() {
            const totalInspectionsEl = document.getElementById('totalInspections');
            const totalJobsEl = document.getElementById('totalJobs');
            const techInspectionsCountEl = document.getElementById('techInspectionsCount');

            if (totalInspectionsEl) totalInspectionsEl.textContent = inspections.length;
            if (totalJobsEl) totalJobsEl.textContent = jobs.length;
            if (techInspectionsCountEl) techInspectionsCountEl.textContent = inspections.length;
        }

        // Navigation
        function login(role) {
            currentRole = role;
            document.getElementById('loginScreen').classList.add('hidden');

            if (role === 'office' || role === 'admin') {
                document.getElementById('officeDashboard').classList.remove('hidden');
                // Show/hide admin nav section
                var adminNav = document.getElementById('adminNavSection');
                if (role === 'admin') {
                    adminNav.classList.remove('hidden');
                    document.getElementById('officeUserAvatar').textContent = 'AD';
                    document.getElementById('officeUserName').textContent = 'Admin';
                } else {
                    adminNav.classList.add('hidden');
                    document.getElementById('officeUserAvatar').textContent = 'OM';
                    document.getElementById('officeUserName').textContent = 'Office Manager';
                }
                loadOfficeDashboard();
            } else {
                document.getElementById('techDashboard').classList.remove('hidden');
                loadTechDashboard();
            }
        }

        function toggleSidebar(sidebarId) {
            var sidebar = document.getElementById(sidebarId);
            // On mobile, clicking sidebar header should close the menu instead of collapsing
            if (window.innerWidth <= 768) {
                closeMobileMenu(sidebarId);
                return;
            }
            sidebar.classList.toggle('collapsed');
        }

        function toggleMobileMenu(sidebarId) {
            var sidebar = document.getElementById(sidebarId);
            var backdropId = sidebarId + 'Backdrop';
            var backdrop = document.getElementById(backdropId);
            if (sidebar.classList.contains('mobile-open')) {
                closeMobileMenu(sidebarId);
            } else {
                sidebar.classList.add('mobile-open');
                backdrop.classList.add('visible');
            }
        }

        function closeMobileMenu(sidebarId) {
            var sidebar = document.getElementById(sidebarId);
            var backdropId = sidebarId + 'Backdrop';
            var backdrop = document.getElementById(backdropId);
            sidebar.classList.remove('mobile-open');
            backdrop.classList.remove('visible');
        }

        function logout() {
            currentRole = '';
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('officeDashboard').classList.add('hidden');
            document.getElementById('techDashboard').classList.add('hidden');
            document.getElementById('adminNavSection').classList.add('hidden');
        }

        function showView(view) {
            // Close mobile menu if open
            closeMobileMenu('officeSidebar');

            // Hide all views
            document.querySelectorAll('[id$="View"]').forEach(el => el.classList.add('hidden'));

            // Update nav active state
            document.querySelectorAll('#officeDashboard .nav-item').forEach(el => el.classList.remove('active'));

            var navItems = document.querySelectorAll('#officeDashboard .nav-item');
            // Nav indices: 0=Dashboard, 1=Estimates, 2=Pipeline, 3=Accounts, 4=Search, 5=Schedule, 6=Parts, 7=Create, 8=Employees(admin), 9=DataMgmt(admin)

            // Show selected view and update nav
            if (view === 'dashboard') {
                document.getElementById('dashboardView').classList.remove('hidden');
                navItems[0].classList.add('active');
            } else if (view === 'estimates') {
                document.getElementById('estimatesView').classList.remove('hidden');
                navItems[1].classList.add('active');
                loadEstimates();
            } else if (view === 'projects') {
                document.getElementById('projectsView').classList.remove('hidden');
                navItems[2].classList.add('active');
                loadPipeline();
            } else if (view === 'parts') {
                document.getElementById('partsView').classList.remove('hidden');
                navItems[6].classList.add('active');
            } else if (view === 'accounts') {
                document.getElementById('accountsView').classList.remove('hidden');
                navItems[3].classList.add('active');
                loadAccounts();
            } else if (view === 'officeSearch') {
                document.getElementById('officeSearchView').classList.remove('hidden');
                navItems[4].classList.add('active');
            } else if (view === 'scheduling') {
                document.getElementById('schedulingView').classList.remove('hidden');
                navItems[5].classList.add('active');
                loadSchedule();
            } else if (view === 'officeCreate') {
                document.getElementById('officeCreateView').classList.remove('hidden');
                navItems[7].classList.add('active');
                initOfficeCreateForm();
            } else if (view === 'estimateDetail') {
                document.getElementById('estimateDetailView').classList.remove('hidden');
                navItems[1].classList.add('active');
            } else if (view === 'workOrderDetail') {
                document.getElementById('workOrderDetailView').classList.remove('hidden');
                navItems[4].classList.add('active');
            } else if (view === 'customerDetail') {
                document.getElementById('customerDetailView').classList.remove('hidden');
                navItems[3].classList.add('active');
            } else if (view === 'inspections') {
                document.getElementById('officeInspectionsView').classList.remove('hidden');
                navItems[4].classList.add('active');
                loadOfficeInspections();
            } else if (view === 'workorders') {
                document.getElementById('officeWorkOrdersView').classList.remove('hidden');
                navItems[4].classList.add('active');
            } else if (view === 'employees') {
                document.getElementById('employeesView').classList.remove('hidden');
                if (navItems[8]) navItems[8].classList.add('active');
                loadEmployees();
            } else if (view === 'dataManagement') {
                document.getElementById('dataManagementView').classList.remove('hidden');
                if (navItems[9]) navItems[9].classList.add('active');
                loadDataManagement();
            }
        }

        // Sample work order data for office view
        const OFFICE_WORK_ORDERS = {
            wo1: {
                jobNumber: '17208',
                jobType: 'Repair',
                status: 'Parts Received',
                customerId: 'cust1',
                locationId: 'loc1',
                locationName: 'Ripley High School',
                address: '254 S Jefferson St, Ripley, TN 38063',
                contactName: 'Chris McCorkle',
                contactPhone: '(731) 635-2642',
                description: 'Install safety strap on Goal 5. Lift rental required - 40\' lift will be on site.',
                partsLocation: 'Floyd\'s house - dropping at Millington HS',
                specialInstructions: 'Customer will have gym cleared by 8am. Enter through back door - front office doesn\'t open until 9.',
                scheduledDate: '2026-01-22',
                scheduledTime: '08:00',
                assignedTo: 'TNBSTeam 2',
                confirmedWith: 'Mike Mann',
                confirmedBy: 'Savannah Kirkland',
                confirmedDate: '2026-01-23'
            },
            wo2: {
                jobNumber: '17209',
                jobType: 'Inspection',
                status: 'Scheduled',
                customerId: 'cust1',
                locationId: 'loc2',
                locationName: 'Ripley Middle School',
                address: '309 Charles Griggs St, Ripley, TN 38063',
                contactName: 'Janet Williams',
                contactPhone: '(731) 635-1500',
                description: 'Annual bleacher inspection - Main Gym. Complete full inspection checklist for 6-tier Hussey bleacher system.',
                partsLocation: 'No parts - inspection only',
                specialInstructions: '',
                scheduledDate: '2026-01-22',
                scheduledTime: '11:00',
                assignedTo: 'TNBSTeam 2',
                confirmedWith: 'Janet Williams',
                confirmedBy: 'Kat',
                confirmedDate: '2026-01-21'
            },
            wo3: {
                jobNumber: '17195',
                jobType: 'Repair',
                status: 'Pink',
                customerId: 'cust4',
                locationId: 'loc11',
                locationName: 'Brentwood Academy',
                address: '219 Granny White Pike, Brentwood, TN 37027',
                contactName: 'John Smith',
                contactPhone: '(615) 373-0611',
                description: 'Goal 3 - safety strap installation. PINK: Wrong bracket sent - need EC-457 not EC-450.',
                partsLocation: 'Parts at TN Shop',
                specialInstructions: 'Customer upset about delay. Handle with care.',
                scheduledDate: '2026-01-20',
                scheduledTime: '09:00',
                assignedTo: 'Floyd Jackson',
                confirmedWith: 'John Smith',
                confirmedBy: 'Savannah Kirkland',
                confirmedDate: '2026-01-19',
                pinkReason: 'wrong_part',
                pinkNotes: 'Wrong bracket sent - need EC-457 not EC-450. Measurements: 4" x 6" mounting plate, 3/8" bolt holes.'
            }
        };

        // Current work order data (for editing)
        let currentWorkOrder = null;

        function viewWorkOrderDetail(workOrderId) {
            // Populate the customer/location dropdown
            populateOfficeWorkOrderCustomerDropdown();

            // Reset all edit sections to display mode
            resetAllEditSections();

            // Load work order data
            const wo = OFFICE_WORK_ORDERS[workOrderId];
            if (wo) {
                currentWorkOrder = { ...wo, id: workOrderId };

                // Header
                document.getElementById('woJobNumber').textContent = 'Job #' + wo.jobNumber;

                // Job type badge
                const jobTypeBadge = document.getElementById('woJobTypeBadge');
                jobTypeBadge.textContent = wo.jobType;
                jobTypeBadge.className = 'badge badge-info';

                // Status badge
                const statusBadge = document.getElementById('woStatusBadge');
                statusBadge.textContent = wo.status;
                const statusClass = wo.status === 'Completed' ? 'badge-success' :
                                   wo.status === 'Pink' ? 'badge-danger' :
                                   wo.status === 'Parts Received' ? 'badge-success' :
                                   wo.status === 'Scheduled' ? 'badge-warning' : 'badge-info';
                statusBadge.className = `badge ${statusClass}`;

                // Location section (display)
                document.getElementById('woLocationName').textContent = wo.locationName;
                document.getElementById('woLocationAddress').textContent = wo.address;
                const encodedAddress = encodeURIComponent(wo.address);
                document.getElementById('woDirectionsLink').href = `https://maps.google.com/?q=${encodedAddress}`;

                // Location section (edit inputs)
                document.getElementById('woCustomerLocation').value = `${wo.customerId}|${wo.locationId}`;
                document.getElementById('woLocationAddressInput').value = wo.address;

                // Contact section (display)
                document.getElementById('woContactName').textContent = wo.contactName;
                document.getElementById('woContactPhone').textContent = wo.contactPhone;
                document.getElementById('woContactPhoneLink').href = `tel:${wo.contactPhone.replace(/\D/g, '')}`;

                // Contact section (edit inputs)
                document.getElementById('woContactNameInput').value = wo.contactName;
                document.getElementById('woContactPhoneInput').value = wo.contactPhone;

                // Description section
                document.getElementById('woDescription').textContent = wo.description;
                document.getElementById('woDescriptionInput').value = wo.description;

                // Parts location section
                document.getElementById('woPartsLocation').textContent = wo.partsLocation;
                document.getElementById('woPartsLocationInput').value = wo.partsLocation;

                // Special instructions section
                const instructions = wo.specialInstructions || 'None';
                document.getElementById('woSpecialInstructions').textContent = instructions;
                document.getElementById('woSpecialInstructionsInput').value = wo.specialInstructions || '';

                // Scheduling section (display)
                const schedDate = new Date(wo.scheduledDate + 'T00:00:00');
                document.getElementById('woScheduledDateDisplay').textContent = schedDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                const [hours, minutes] = wo.scheduledTime.split(':');
                const timeDate = new Date();
                timeDate.setHours(parseInt(hours), parseInt(minutes));
                document.getElementById('woScheduledTimeDisplay').textContent = timeDate.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
                document.getElementById('woAssignedToDisplay').textContent = wo.assignedTo || '‚Äî';
                document.getElementById('woConfirmedWithDisplay').textContent = wo.confirmedWith || '‚Äî';
                document.getElementById('woConfirmedByDisplay').textContent = wo.confirmedBy || '‚Äî';
                if (wo.confirmedDate) {
                    const confDate = new Date(wo.confirmedDate + 'T00:00:00');
                    document.getElementById('woConfirmedDateDisplay').textContent = confDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                } else {
                    document.getElementById('woConfirmedDateDisplay').textContent = '‚Äî';
                }

                // Scheduling section (edit inputs)
                document.getElementById('woScheduledDate').value = wo.scheduledDate;
                document.getElementById('woScheduledTime').value = wo.scheduledTime;
                document.getElementById('woAssignedTo').value = wo.assignedTo;
                document.getElementById('woConfirmedWith').value = wo.confirmedWith || '';
                document.getElementById('woConfirmedBy').value = wo.confirmedBy || '';
                document.getElementById('woConfirmedDate').value = wo.confirmedDate || '';

                // Completion section (display) - typically empty until job is done
                document.getElementById('woCompletedDisplay').textContent = wo.completed ? (wo.completed === 'yes' ? 'Completed' : 'Not Completed (Pink)') : '‚Äî';
                document.getElementById('woHoursWorkedDisplay').textContent = wo.hoursWorked || '‚Äî';
                document.getElementById('woCompletedByDisplay').textContent = wo.completedBy || '‚Äî';

                // Completion notes (new field in updated UI)
                if (document.getElementById('woCompletionNotes')) {
                    document.getElementById('woCompletionNotes').value = wo.techNotes || '';
                }

                // Reset the completion form
                resetOfficeCompletionForm();
            }

            showView('workOrderDetail');
        }

        function resetAllEditSections() {
            const sections = ['location', 'contact', 'description', 'parts', 'instructions', 'scheduling', 'completionSummary'];
            sections.forEach(section => {
                const displayEl = document.getElementById(`wo${capitalizeFirst(section)}Display`);
                const editEl = document.getElementById(`wo${capitalizeFirst(section)}Edit`);
                const btnEl = document.getElementById(`wo${capitalizeFirst(section)}EditBtn`);
                if (displayEl) displayEl.classList.remove('hidden');
                if (editEl) editEl.classList.add('hidden');
                if (btnEl) btnEl.textContent = 'Edit';
            });
        }

        function capitalizeFirst(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        function toggleEditSection(section) {
            const displayEl = document.getElementById(`wo${capitalizeFirst(section)}Display`);
            const editEl = document.getElementById(`wo${capitalizeFirst(section)}Edit`);
            const btnEl = document.getElementById(`wo${capitalizeFirst(section)}EditBtn`);

            if (editEl.classList.contains('hidden')) {
                // Show edit mode
                displayEl.classList.add('hidden');
                editEl.classList.remove('hidden');
                btnEl.textContent = 'Cancel';
            } else {
                // Hide edit mode
                displayEl.classList.remove('hidden');
                editEl.classList.add('hidden');
                btnEl.textContent = 'Edit';
            }
        }

        function saveSection(section) {
            // Save the section data
            switch(section) {
                case 'location':
                    const dropdown = document.getElementById('woCustomerLocation');
                    const selectedOption = dropdown.options[dropdown.selectedIndex];
                    if (selectedOption && selectedOption.textContent) {
                        document.getElementById('woLocationName').textContent = selectedOption.textContent;
                    }
                    const newAddress = document.getElementById('woLocationAddressInput').value;
                    document.getElementById('woLocationAddress').textContent = newAddress;
                    document.getElementById('woDirectionsLink').href = `https://maps.google.com/?q=${encodeURIComponent(newAddress)}`;
                    break;
                case 'contact':
                    document.getElementById('woContactName').textContent = document.getElementById('woContactNameInput').value;
                    const phone = document.getElementById('woContactPhoneInput').value;
                    document.getElementById('woContactPhone').textContent = phone;
                    document.getElementById('woContactPhoneLink').href = `tel:${phone.replace(/\D/g, '')}`;
                    break;
                case 'description':
                    document.getElementById('woDescription').textContent = document.getElementById('woDescriptionInput').value;
                    break;
                case 'parts':
                    document.getElementById('woPartsLocation').textContent = document.getElementById('woPartsLocationInput').value;
                    break;
                case 'instructions':
                    document.getElementById('woSpecialInstructions').textContent = document.getElementById('woSpecialInstructionsInput').value || 'None';
                    break;
                case 'scheduling':
                    const schedDate = new Date(document.getElementById('woScheduledDate').value + 'T00:00:00');
                    document.getElementById('woScheduledDateDisplay').textContent = schedDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                    const timeVal = document.getElementById('woScheduledTime').value;
                    const [h, m] = timeVal.split(':');
                    const td = new Date();
                    td.setHours(parseInt(h), parseInt(m));
                    document.getElementById('woScheduledTimeDisplay').textContent = td.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
                    document.getElementById('woAssignedToDisplay').textContent = document.getElementById('woAssignedTo').value || '‚Äî';
                    document.getElementById('woConfirmedWithDisplay').textContent = document.getElementById('woConfirmedWith').value || '‚Äî';
                    document.getElementById('woConfirmedByDisplay').textContent = document.getElementById('woConfirmedBy').value || '‚Äî';
                    const confDateVal = document.getElementById('woConfirmedDate').value;
                    if (confDateVal) {
                        const cd = new Date(confDateVal + 'T00:00:00');
                        document.getElementById('woConfirmedDateDisplay').textContent = cd.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                    }
                    break;
                case 'completionSummary':
                    const completed = document.getElementById('woCompleted').value;
                    document.getElementById('woCompletedDisplay').textContent = completed ? (completed === 'yes' ? 'Completed' : 'Not Completed (Pink)') : '‚Äî';
                    document.getElementById('woHoursWorkedDisplay').textContent = document.getElementById('woHoursWorked').value || '‚Äî';
                    document.getElementById('woCompletedByDisplay').textContent = document.getElementById('woCompletedBy').value || '‚Äî';
                    break;
            }

            // Hide edit mode, show display
            toggleEditSection(section);

            // Show save confirmation
            console.log(`Saved ${section} section`);
        }

        function cancelEditSection(section) {
            // Just toggle back to display mode (changes discarded)
            toggleEditSection(section);
        }

        // Office Work Order Photo/Completion Variables
        let woMainPhoto = null;
        let woAdditionalPhotos = [];
        let woWrongPartPhoto = null;
        let woWrongPartSentPhoto = null;
        let woMoreWorkPhoto = null;

        const WO_REASON_LABELS = {
            'wrong_part': 'üîß Wrong or Missing Part',
            'access': 'üö™ Can\'t Access Site',
            'more_work': '‚ö†Ô∏è Additional Work Needed',
            'equipment': 'üèóÔ∏è Equipment Issue',
            'other': 'üìù Other'
        };

        function handleOfficePhotoUpload(event, type) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                if (type === 'main') {
                    woMainPhoto = e.target.result;
                    document.getElementById('woPhotoPreview').innerHTML = `
                        <div style="position: relative; display: inline-block;">
                            <img src="${e.target.result}" style="max-width: 200px; border-radius: 8px; border: 2px solid #4CAF50;">
                            <button onclick="removeOfficePhoto('main')" style="position: absolute; top: -8px; right: -8px; background: #dc3545; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; font-weight: bold;">√ó</button>
                        </div>
                    `;
                    document.getElementById('woPhotoPreview').classList.remove('hidden');
                    document.getElementById('woPhotoUploadArea').style.display = 'none';
                } else if (type === 'additional') {
                    const files = event.target.files;
                    for (let i = 0; i < files.length; i++) {
                        const reader2 = new FileReader();
                        reader2.onload = function(e2) {
                            woAdditionalPhotos.push(e2.target.result);
                            const container = document.getElementById('woAdditionalPhotosPreview');
                            const imgWrapper = document.createElement('div');
                            imgWrapper.style.cssText = 'position: relative; display: inline-block;';
                            const idx = woAdditionalPhotos.length - 1;
                            imgWrapper.innerHTML = `
                                <img src="${e2.target.result}" style="width: 100px; height: 100px; object-fit: cover; border-radius: 8px;">
                                <button onclick="removeOfficeAdditionalPhoto(${idx}, this)" style="position: absolute; top: -6px; right: -6px; background: #dc3545; color: white; border: none; border-radius: 50%; width: 20px; height: 20px; cursor: pointer; font-size: 12px; font-weight: bold;">√ó</button>
                            `;
                            container.appendChild(imgWrapper);
                        };
                        reader2.readAsDataURL(files[i]);
                    }
                }
            };
            reader.readAsDataURL(file);
        }

        function removeOfficePhoto(type) {
            if (type === 'main') {
                woMainPhoto = null;
                document.getElementById('woPhotoPreview').innerHTML = '';
                document.getElementById('woPhotoPreview').classList.add('hidden');
                document.getElementById('woPhotoUploadArea').style.display = 'block';
                document.getElementById('woPhotoInput').value = '';
            }
        }

        function removeOfficeAdditionalPhoto(index, btn) {
            woAdditionalPhotos.splice(index, 1);
            btn.parentElement.remove();
        }

        function handleOfficeWrongPartPhoto(event, photoType) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                if (photoType === 'correct') {
                    woWrongPartPhoto = e.target.result;
                    document.getElementById('woWrongPartPhotoPreview').innerHTML = `
                        <div style="position: relative; display: inline-block;">
                            <img src="${e.target.result}" style="max-width: 150px; border-radius: 8px; border: 2px solid #ff9800;">
                            <button onclick="removeOfficeWrongPartPhoto('correct')" style="position: absolute; top: -8px; right: -8px; background: #dc3545; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; font-weight: bold;">√ó</button>
                        </div>
                    `;
                    document.getElementById('woWrongPartPhotoPreview').classList.remove('hidden');
                    document.getElementById('woWrongPartPhotoArea').style.display = 'none';
                } else if (photoType === 'wrong') {
                    woWrongPartSentPhoto = e.target.result;
                    document.getElementById('woWrongPartSentPhotoPreview').innerHTML = `
                        <div style="position: relative; display: inline-block;">
                            <img src="${e.target.result}" style="max-width: 100px; border-radius: 8px;">
                            <button onclick="removeOfficeWrongPartPhoto('wrong')" style="position: absolute; top: -6px; right: -6px; background: #dc3545; color: white; border: none; border-radius: 50%; width: 20px; height: 20px; cursor: pointer; font-size: 12px; font-weight: bold;">√ó</button>
                        </div>
                    `;
                }
            };
            reader.readAsDataURL(file);
        }

        function removeOfficeWrongPartPhoto(photoType) {
            if (photoType === 'correct') {
                woWrongPartPhoto = null;
                document.getElementById('woWrongPartPhotoPreview').innerHTML = '';
                document.getElementById('woWrongPartPhotoPreview').classList.add('hidden');
                document.getElementById('woWrongPartPhotoArea').style.display = 'block';
                document.getElementById('woWrongPartPhotoInput').value = '';
            } else if (photoType === 'wrong') {
                woWrongPartSentPhoto = null;
                document.getElementById('woWrongPartSentPhotoPreview').innerHTML = '';
                document.getElementById('woWrongPartSentPhotoInput').value = '';
            }
        }

        function handleOfficeMoreWorkPhoto(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                woMoreWorkPhoto = e.target.result;
                document.getElementById('woMoreWorkPhotoPreview').innerHTML = `
                    <div style="position: relative; display: inline-block;">
                        <img src="${e.target.result}" style="max-width: 150px; border-radius: 8px; border: 2px solid #2196f3;">
                        <button onclick="removeOfficeMoreWorkPhoto()" style="position: absolute; top: -8px; right: -8px; background: #dc3545; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; font-weight: bold;">√ó</button>
                    </div>
                `;
                document.getElementById('woMoreWorkPhotoPreview').classList.remove('hidden');
                document.getElementById('woMoreWorkPhotoArea').style.display = 'none';
            };
            reader.readAsDataURL(file);
        }

        function removeOfficeMoreWorkPhoto() {
            woMoreWorkPhoto = null;
            document.getElementById('woMoreWorkPhotoPreview').innerHTML = '';
            document.getElementById('woMoreWorkPhotoPreview').classList.add('hidden');
            document.getElementById('woMoreWorkPhotoArea').style.display = 'block';
            document.getElementById('woMoreWorkPhotoInput').value = '';
        }

        function selectOfficeNotCompletedReason(reason) {
            document.getElementById('woNotCompletedReason').value = reason;

            // Update button styles
            document.querySelectorAll('#woReasonButtons .reason-btn').forEach(btn => {
                btn.style.borderColor = '#dee2e6';
                btn.style.background = 'white';
            });
            event.target.closest('.reason-btn').style.borderColor = '#c62828';
            event.target.closest('.reason-btn').style.background = '#ffebee';

            // Show the selected reason text
            document.getElementById('woSelectedReasonText').textContent = WO_REASON_LABELS[reason];

            // Show/hide reason-specific sections
            document.getElementById('woWrongPartSection').classList.add('hidden');
            document.getElementById('woMoreWorkSection').classList.add('hidden');

            if (reason === 'wrong_part') {
                document.getElementById('woWrongPartSection').classList.remove('hidden');
                document.getElementById('woNotesRequired').style.display = 'none';
            } else if (reason === 'more_work') {
                document.getElementById('woMoreWorkSection').classList.remove('hidden');
                document.getElementById('woNotesRequired').style.display = 'none';
            } else {
                document.getElementById('woNotesRequired').style.display = 'inline';
            }

            // Hide reason buttons, show details
            document.getElementById('woReasonButtons').classList.add('hidden');
            document.getElementById('woReasonDetails').classList.remove('hidden');
        }

        function changeOfficeReason() {
            document.getElementById('woNotCompletedReason').value = '';
            document.getElementById('woReasonButtons').classList.remove('hidden');
            document.getElementById('woReasonDetails').classList.add('hidden');

            // Reset button styles
            document.querySelectorAll('#woReasonButtons .reason-btn').forEach(btn => {
                btn.style.borderColor = '#dee2e6';
                btn.style.background = 'white';
            });
        }

        function submitOfficeJobCompleted() {
            // Office staff can close jobs without any conditions (full override permissions)
            const notes = document.getElementById('woCompletionNotes').value.trim();

            // Update the completion summary display
            document.getElementById('woCompletedDisplay').textContent = 'Completed';
            document.getElementById('woCompleted').value = 'yes';

            const jobNumber = document.getElementById('woJobNumber').textContent;
            let confirmMsg = `${jobNumber} marked as COMPLETED!`;
            if (woMainPhoto) confirmMsg += '\nPhoto: ‚úì';
            if (notes) confirmMsg += `\nNotes: ${notes}`;
            confirmMsg += '\n\nJob saved.';
            alert(confirmMsg);

            showPage('officeWorkOrders');
        }

        function submitOfficeJobNotCompleted() {
            // Office staff can close jobs without any conditions (full override permissions)
            const reason = document.getElementById('woNotCompletedReason').value;
            const details = document.getElementById('woNotCompletedDetails').value.trim();

            // Update display
            document.getElementById('woCompletedDisplay').textContent = 'Not Completed (Pink)';
            document.getElementById('woCompleted').value = 'no';

            const jobNumber = document.getElementById('woJobNumber').textContent;
            let confirmMsg = `${jobNumber} marked as PINK JOB`;

            // Include whatever info was provided (but none required)
            if (reason) {
                const reasonLabel = WO_REASON_LABELS[reason];
                confirmMsg += `\n\nReason: ${reasonLabel}`;

                if (reason === 'wrong_part') {
                    const measurements = document.getElementById('woWrongPartMeasurements').value.trim();
                    if (measurements) confirmMsg += `\nMeasurements: ${measurements}`;
                    if (woWrongPartPhoto) confirmMsg += '\nCorrect part photo: ‚úì';
                } else if (reason === 'more_work') {
                    if (woMoreWorkPhoto) confirmMsg += '\nIssue photo: ‚úì';
                }
            }

            if (details) {
                confirmMsg += `\nNotes: ${details}`;
            }

            confirmMsg += '\n\nJob saved as Pink Job.';
            alert(confirmMsg);

            showPage('officeWorkOrders');
        }

        function resetOfficeCompletionForm() {
            // Reset photos
            woMainPhoto = null;
            woAdditionalPhotos = [];
            woWrongPartPhoto = null;
            woWrongPartSentPhoto = null;
            woMoreWorkPhoto = null;

            // Reset photo previews
            document.getElementById('woPhotoPreview').innerHTML = '';
            document.getElementById('woPhotoPreview').classList.add('hidden');
            document.getElementById('woPhotoUploadArea').style.display = 'block';
            document.getElementById('woPhotoInput').value = '';
            document.getElementById('woAdditionalPhotosPreview').innerHTML = '';

            // Reset completion notes
            document.getElementById('woCompletionNotes').value = '';

            // Reset not completed section
            document.getElementById('woNotCompletedReason').value = '';
            document.getElementById('woReasonButtons').classList.remove('hidden');
            document.getElementById('woReasonDetails').classList.add('hidden');
            document.querySelectorAll('#woReasonButtons .reason-btn').forEach(btn => {
                btn.style.borderColor = '#dee2e6';
                btn.style.background = 'white';
            });

            // Reset wrong part section
            document.getElementById('woWrongPartMeasurements').value = '';
            document.getElementById('woWrongPartPhotoPreview').innerHTML = '';
            document.getElementById('woWrongPartPhotoPreview').classList.add('hidden');
            document.getElementById('woWrongPartPhotoArea').style.display = 'block';
            document.getElementById('woWrongPartPhotoInput').value = '';
            document.getElementById('woWrongPartSentPhotoPreview').innerHTML = '';
            document.getElementById('woWrongPartSentPhotoInput').value = '';

            // Reset more work section
            document.getElementById('woMoreWorkPhotoPreview').innerHTML = '';
            document.getElementById('woMoreWorkPhotoPreview').classList.add('hidden');
            document.getElementById('woMoreWorkPhotoArea').style.display = 'block';
            document.getElementById('woMoreWorkPhotoInput').value = '';

            // Reset notes
            document.getElementById('woNotCompletedDetails').value = '';
        }

        function populateOfficeWorkOrderCustomerDropdown() {
            const dropdown = document.getElementById('woCustomerLocation');
            dropdown.innerHTML = '<option value="">Select customer & location...</option>';

            CUSTOMERS.forEach(customer => {
                const icon = customer.type === 'county' ? 'üèõÔ∏è' : 'üè´';
                const optgroup = document.createElement('optgroup');
                optgroup.label = `${icon} ${customer.name}`;

                customer.locations.forEach(loc => {
                    const option = document.createElement('option');
                    option.value = `${customer.id}|${loc.id}`;
                    option.textContent = loc.name;
                    option.dataset.address = loc.address;
                    option.dataset.contact = loc.contact;
                    option.dataset.phone = loc.phone;
                    optgroup.appendChild(option);
                });

                dropdown.appendChild(optgroup);
            });
        }

        function updateOfficeWorkOrderLocation() {
            const dropdown = document.getElementById('woCustomerLocation');
            const selectedOption = dropdown.options[dropdown.selectedIndex];

            if (selectedOption && selectedOption.dataset.address) {
                document.getElementById('woLocationAddressInput').value = selectedOption.dataset.address;
                document.getElementById('woContactNameInput').value = selectedOption.dataset.contact || '';
                document.getElementById('woContactPhoneInput').value = selectedOption.dataset.phone || '';
            }
        }

        function viewJobDetail(jobId) {
            // Find the job and show its details
            const job = jobs.find(j => j.id === jobId);
            if (job) {
                // Populate the customer dropdown first
                populateOfficeWorkOrderCustomerDropdown();
                resetAllEditSections();
                resetOfficeCompletionForm();

                // Header
                document.getElementById('woJobNumber').textContent = 'Job #' + (job.jobNumber || job.estimateNumber);

                // Job type badge
                const jobTypeBadge = document.getElementById('woJobTypeBadge');
                jobTypeBadge.textContent = job.jobType || 'Repair';
                jobTypeBadge.className = 'badge badge-info';

                // Status badge
                const statusBadge = document.getElementById('woStatusBadge');
                statusBadge.textContent = job.status || 'New';
                const statusClass = job.status === 'Completed' ? 'badge-success' :
                                   job.status === 'Pink' ? 'badge-danger' :
                                   job.status === 'Parts Received' ? 'badge-success' : 'badge-info';
                statusBadge.className = `badge ${statusClass}`;

                // Populate display fields
                document.getElementById('woLocationName').textContent = job.locationName || job.customerLocation || 'N/A';
                document.getElementById('woLocationAddress').textContent = job.locationAddress || '';
                document.getElementById('woDescription').textContent = job.description || 'N/A';

                showView('workOrderDetail');
            }
        }

        function showTechView(view) {
            // Close mobile menu if open
            closeMobileMenu('techSidebar');

            // Hide all tech views including new inspection views
            document.querySelectorAll('#techDashboard [id^="tech"][id$="View"]').forEach(el => el.classList.add('hidden'));
            document.getElementById('newJobSetupView')?.classList.add('hidden');
            document.getElementById('bankInspectionView')?.classList.add('hidden');
            document.getElementById('jobSummaryView')?.classList.add('hidden');
            document.getElementById('newInspectionView')?.classList.add('hidden');
            document.querySelectorAll('#techDashboard .nav-item').forEach(el => el.classList.remove('active'));

            if (view === 'search') {
                document.getElementById('techSearchView').classList.remove('hidden');
                document.querySelectorAll('#techDashboard .nav-item')[0].classList.add('active');
            } else if (view === 'teamschedule') {
                document.getElementById('techTeamScheduleView').classList.remove('hidden');
                document.querySelectorAll('#techDashboard .nav-item')[1].classList.add('active');
                loadTeamSchedule();
            } else if (view === 'myjobs' || view === 'dashboard') {
                document.getElementById('techMyJobsView').classList.remove('hidden');
                document.querySelectorAll('#techDashboard .nav-item')[2].classList.add('active');
                loadMyJobs();
            } else if (view === 'create') {
                document.getElementById('techCreateView').classList.remove('hidden');
                document.querySelectorAll('#techDashboard .nav-item')[3].classList.add('active');
                initCreateForm();
            } else if (view === 'inspections') {
                document.getElementById('techInspectionsView').classList.remove('hidden');
                document.querySelectorAll('#techDashboard .nav-item')[3].classList.add('active');
                loadInspectionJobs();
                loadTechInspections();
            } else if (view === 'parts') {
                startNewJob();
                document.querySelectorAll('#techDashboard .nav-item')[3].classList.add('active');
            } else if (view === 'workorders') {
                document.getElementById('techWorkOrdersView').classList.remove('hidden');
                document.querySelectorAll('#techDashboard .nav-item')[3].classList.add('active');
            } else if (view === 'workorderdetail') {
                document.getElementById('techWorkOrderDetailView').classList.remove('hidden');
                document.querySelectorAll('#techDashboard .nav-item')[3].classList.add('active');
            }
        }

        // Unified Create form functions
        let createPhoto = null;

        function initCreateForm() {
            // Populate customer dropdown
            var select = document.getElementById('createCustomerSelect');
            var html = '<option value="">Select a customer...</option>';
            CUSTOMERS.forEach(function(cust) {
                cust.locations.forEach(function(loc) {
                    html += '<option value="' + loc.id + '" data-customer-id="' + cust.id + '" data-customer-name="' + cust.name + '" data-location-name="' + loc.name + '" data-location-address="' + loc.address + '" data-contact="' + (loc.contact || '') + '" data-phone="' + (loc.phone || '') + '">  ' + loc.name + ' (' + cust.name + ')</option>';
                });
            });
            select.innerHTML = html;

            // Reset all fields
            document.getElementById('createTypeSelect').value = '';
            document.getElementById('createCustomerSelect').value = '';
            document.getElementById('createCustomerInfo').classList.add('hidden');
            document.getElementById('createFormFields').classList.add('hidden');
            document.getElementById('createSubmitBtn').classList.add('hidden');
            document.getElementById('createInspectionFields').classList.add('hidden');
            document.getElementById('createWorkOrderFields').classList.add('hidden');
            document.getElementById('createDescriptionGroup').classList.add('hidden');
            document.getElementById('createPhotoGroup').classList.add('hidden');
            document.getElementById('createNotes').value = '';
            var descEl = document.getElementById('createDescription');
            if (descEl) descEl.value = '';
            document.getElementById('createPhotoPreview').innerHTML = '';
            createPhoto = null;
        }

        function onCreateTypeChange() {
            var type = document.getElementById('createTypeSelect').value;
            if (!type) {
                document.getElementById('createFormFields').classList.add('hidden');
                document.getElementById('createSubmitBtn').classList.add('hidden');
                return;
            }

            // Show common fields
            document.getElementById('createFormFields').classList.remove('hidden');
            document.getElementById('createSubmitBtn').classList.remove('hidden');

            // Hide all type-specific fields first
            document.getElementById('createInspectionFields').classList.add('hidden');
            document.getElementById('createWorkOrderFields').classList.add('hidden');
            document.getElementById('createDescriptionGroup').classList.add('hidden');
            document.getElementById('createPhotoGroup').classList.add('hidden');

            var btn = document.getElementById('createSubmitBtn');

            if (type === 'inspection') {
                document.getElementById('createInspectionFields').classList.remove('hidden');
                document.getElementById('createJobNumber').value = nextJobNumber;
                document.getElementById('createJobDate').value = new Date().toISOString().split('T')[0];
                btn.textContent = 'Create Inspection';
            } else if (type === 'work_order') {
                document.getElementById('createWorkOrderFields').classList.remove('hidden');
                document.getElementById('createDescriptionGroup').classList.remove('hidden');
                document.getElementById('createPhotoGroup').classList.remove('hidden');
                document.getElementById('createDescription').placeholder = 'What needs to be done...';
                btn.textContent = 'Create Work Order';
            } else if (type === 'parts_spec') {
                document.getElementById('createDescriptionGroup').classList.remove('hidden');
                document.getElementById('createPhotoGroup').classList.remove('hidden');
                document.getElementById('createDescription').placeholder = 'What parts are needed for...';
                btn.textContent = 'Create Parts Spec';
            }
        }

        function updateCreateCustomerInfo() {
            var select = document.getElementById('createCustomerSelect');
            var locId = select.value;
            var infoEl = document.getElementById('createCustomerInfo');
            if (!locId) { infoEl.classList.add('hidden'); return; }
            var option = select.options[select.selectedIndex];
            var address = option.dataset.locationAddress || '';
            var contact = option.dataset.contact || '';
            var phone = option.dataset.phone || '';
            document.getElementById('createAddress').textContent = address;
            document.getElementById('createContact').textContent = contact + (phone ? ' - ' + phone : '');
            infoEl.classList.remove('hidden');
        }

        function handleCreatePhoto(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    createPhoto = e.target.result;
                    document.getElementById('createPhotoPreview').innerHTML = '<img src="' + e.target.result + '" style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px;">';
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function submitCreate() {
            var type = document.getElementById('createTypeSelect').value;
            var select = document.getElementById('createCustomerSelect');
            var locId = select.value;

            if (!locId) { alert('Please select a customer.'); return; }

            var option = select.options[select.selectedIndex];
            var locationName = option.dataset.locationName || '';
            var customerName = option.dataset.customerName || '';
            var address = option.dataset.locationAddress || '';
            var customerId = option.dataset.customerId || '';

            if (type === 'inspection') {
                // Wire into existing inspection flow
                currentJob = {
                    jobNumber: nextJobNumber,
                    banks: [],
                    selectedParts: [],
                    status: 'in_progress',
                    createdAt: new Date().toISOString()
                };
                currentJob.customerId = customerId;
                currentJob.customerName = customerName;
                currentJob.locationId = locId;
                currentJob.locationName = locationName;
                currentJob.locationAddress = address;
                currentJob.inspectionType = document.getElementById('createInspectionType').value;
                currentJob.inspectionDate = document.getElementById('createJobDate').value;

                nextJobNumber++;
                localStorage.setItem('nextJobNumber', nextJobNumber);

                currentBankIndex = 0;
                currentJob.banks.push(createNewBank('East Side'));
                showBankInspection();

            } else if (type === 'work_order') {
                var desc = document.getElementById('createDescription').value.trim();
                if (!desc) { alert('Please add a description.'); return; }

                var jobType = document.getElementById('createWoJobType').value;
                var notes = document.getElementById('createNotes').value.trim();

                var nextNum = parseInt(localStorage.getItem('nextJobNumber') || '17500');
                var jobNumber = '' + nextNum;
                localStorage.setItem('nextJobNumber', '' + (nextNum + 1));

                var key = 'wo_' + jobNumber;
                TECH_WORK_ORDERS[key] = {
                    jobNumber: jobNumber,
                    jobType: jobType,
                    locationName: locationName,
                    address: address,
                    contactName: '',
                    contactPhone: '',
                    description: desc,
                    partsLocation: '',
                    specialInstructions: notes,
                    scheduledTime: ''
                };

                alert('Work Order #' + jobNumber + ' created for ' + locationName);
                showTechView('create');

            } else if (type === 'parts_spec') {
                var desc = document.getElementById('createDescription').value.trim();
                if (!desc) { alert('Please add a description.'); return; }

                var nextNum = parseInt(localStorage.getItem('nextJobNumber') || '17500');
                var jobNumber = '' + nextNum;
                localStorage.setItem('nextJobNumber', '' + (nextNum + 1));

                alert('Parts Spec #' + jobNumber + ' created for ' + locationName);
                showTechView('create');
            }
        }

        // Sample work order data for field staff view
        const TECH_WORK_ORDERS = {
            two1: {
                jobNumber: '17208',
                jobType: 'Repair',
                locationName: 'Ripley High School',
                address: '254 S Jefferson St, Ripley, TN 38063',
                contactName: 'Chris McCorkle',
                contactPhone: '(731) 635-2642',
                description: 'Install safety strap on Goal 5. Lift rental required - 40\' lift will be on site.',
                partsLocation: 'Floyd\'s house - dropping at Millington HS',
                specialInstructions: 'Customer will have gym cleared by 8am. Enter through back door - front office doesn\'t open until 9.',
                scheduledTime: '8:00 AM'
            },
            two2: {
                jobNumber: '17209',
                jobType: 'Inspection',
                locationName: 'Ripley Middle School',
                address: '309 Charles Griggs St, Ripley, TN 38063',
                contactName: 'Janet Williams',
                contactPhone: '(731) 635-1500',
                description: 'Annual bleacher inspection - Main Gym. Complete full inspection checklist for 6-tier Hussey bleacher system.',
                partsLocation: 'No parts - inspection only',
                specialInstructions: '',
                scheduledTime: '11:00 AM'
            },
            two3: {
                jobNumber: '17210',
                jobType: 'Repair',
                locationName: 'Brentwood Academy',
                address: '219 Granny White Pike, Brentwood, TN 37027',
                contactName: 'John Smith',
                contactPhone: '(615) 373-0611',
                description: 'Replace deck boards (3) and seat slats (5) on home side bleachers Section B. All parts are Hussey.',
                partsLocation: 'TN Shop - Parts staged in repair bay',
                specialInstructions: 'School in session. Work during gym class break 1:30-3:00 PM only. Check in with front office first.',
                scheduledTime: '2:00 PM'
            }
        };

        // Photo upload state
        let twoMainPhoto = null;
        let twoAdditionalPhotosList = [];
        let twoWrongPartPhoto = null;
        let twoWrongPartSentPhoto = null;
        let twoMoreWorkPhoto = null;

        function showTechWorkOrderDetail(workOrderId) {
            const wo = TECH_WORK_ORDERS[workOrderId];
            if (!wo) return;

            // Populate the detail view with work order data
            document.getElementById('twoJobNumber').textContent = `Job #${wo.jobNumber}`;
            document.getElementById('twoJobTypeBadge').textContent = wo.jobType;
            document.getElementById('twoLocationName').textContent = wo.locationName;
            document.getElementById('twoAddress').textContent = wo.address;
            document.getElementById('twoContactName').textContent = wo.contactName;
            document.getElementById('twoContactPhone').textContent = wo.contactPhone;
            document.getElementById('twoContactPhone').href = `tel:${wo.contactPhone.replace(/[^0-9]/g, '')}`;
            document.getElementById('twoDescription').textContent = wo.description;
            document.getElementById('twoPartsLocation').textContent = wo.partsLocation;

            // Update directions link
            const encodedAddress = encodeURIComponent(wo.address);
            document.getElementById('twoDirectionsLink').href = `https://maps.google.com/?q=${encodedAddress}`;

            // Show/hide special instructions
            const specialSection = document.getElementById('twoSpecialInstructionsSection');
            if (wo.specialInstructions) {
                specialSection.classList.remove('hidden');
                document.getElementById('twoSpecialInstructions').textContent = wo.specialInstructions;
            } else {
                specialSection.classList.add('hidden');
            }

            // Reset form state
            document.getElementById('twoNotCompletedSection').classList.add('hidden');
            document.getElementById('twoCompletionNotes').value = '';
            document.getElementById('twoPhotoPreview').classList.add('hidden');
            document.getElementById('twoPhotoPreview').innerHTML = '';
            document.getElementById('twoAdditionalPhotosPreview').innerHTML = '';
            document.getElementById('twoPhotoUploadArea').style.display = 'block';
            twoMainPhoto = null;
            twoAdditionalPhotosList = [];

            if (document.getElementById('twoNotCompletedReason')) {
                document.getElementById('twoNotCompletedReason').value = '';
            }
            if (document.getElementById('twoNotCompletedDetails')) {
                document.getElementById('twoNotCompletedDetails').value = '';
            }

            // Reset not completed section to initial state
            document.getElementById('twoReasonButtons').style.display = 'flex';
            document.getElementById('twoReasonDetails').classList.add('hidden');
            document.getElementById('twoWrongPartSection').classList.add('hidden');
            document.getElementById('twoMoreWorkSection').classList.add('hidden');
            if (document.getElementById('twoWrongPartMeasurements')) {
                document.getElementById('twoWrongPartMeasurements').value = '';
            }
            document.getElementById('twoWrongPartPhotoPreview').classList.add('hidden');
            document.getElementById('twoWrongPartPhotoPreview').innerHTML = '';
            document.getElementById('twoWrongPartPhotoArea').style.display = 'block';
            document.getElementById('twoWrongPartSentPhotoPreview').innerHTML = '';
            document.getElementById('twoMoreWorkPhotoPreview').classList.add('hidden');
            document.getElementById('twoMoreWorkPhotoPreview').innerHTML = '';
            document.getElementById('twoMoreWorkPhotoArea').style.display = 'block';
            twoWrongPartPhoto = null;
            twoWrongPartSentPhoto = null;
            twoMoreWorkPhoto = null;

            showTechView('workorderdetail');
        }

        function handleTwoPhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            twoMainPhoto = file;
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('twoPhotoPreview').innerHTML = `
                    <div style="position: relative; display: inline-block;">
                        <img src="${e.target.result}" style="max-width: 100%; max-height: 300px; border-radius: 8px; border: 2px solid #4CAF50;">
                        <button onclick="removeTwoMainPhoto()" style="position: absolute; top: 8px; right: 8px; background: #dc3545; color: white; border: none; border-radius: 50%; width: 28px; height: 28px; cursor: pointer; font-size: 16px;">√ó</button>
                    </div>
                    <p style="color: #4CAF50; font-weight: 600; margin-top: 8px;">‚úì Photo uploaded</p>
                `;
                document.getElementById('twoPhotoPreview').classList.remove('hidden');
                document.getElementById('twoPhotoUploadArea').style.display = 'none';
            };
            reader.readAsDataURL(file);
        }

        function removeTwoMainPhoto() {
            twoMainPhoto = null;
            document.getElementById('twoPhotoPreview').classList.add('hidden');
            document.getElementById('twoPhotoPreview').innerHTML = '';
            document.getElementById('twoPhotoUploadArea').style.display = 'block';
            document.getElementById('twoPhotoInput').value = '';
        }

        function handleTwoAdditionalPhotos(event) {
            const files = Array.from(event.target.files);
            files.forEach(file => {
                twoAdditionalPhotosList.push(file);
                const reader = new FileReader();
                reader.onload = function(e) {
                    const index = twoAdditionalPhotosList.length - 1;
                    const preview = document.getElementById('twoAdditionalPhotosPreview');
                    const div = document.createElement('div');
                    div.style.cssText = 'position: relative; display: inline-block;';
                    div.innerHTML = `
                        <img src="${e.target.result}" style="width: 100px; height: 100px; object-fit: cover; border-radius: 8px; border: 1px solid #dee2e6;">
                        <button onclick="removeTwoAdditionalPhoto(${index}, this)" style="position: absolute; top: -8px; right: -8px; background: #dc3545; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; font-size: 14px;">√ó</button>
                    `;
                    preview.appendChild(div);
                };
                reader.readAsDataURL(file);
            });
        }

        function removeTwoAdditionalPhoto(index, button) {
            button.parentElement.remove();
        }

        function showNotCompletedOptions() {
            document.getElementById('twoNotCompletedSection').classList.remove('hidden');
            document.getElementById('twoNotCompletedSection').scrollIntoView({ behavior: 'smooth' });
        }

        // Reason labels for display
        const REASON_LABELS = {
            wrong_part: 'üîß Wrong or Missing Part',
            access: 'üö™ Can\'t Access Site',
            more_work: '‚ö†Ô∏è Additional Work Needed',
            equipment: 'üèóÔ∏è Equipment Issue',
            other: 'üìù Other'
        };

        const REASON_PLACEHOLDERS = {
            wrong_part: 'What part was wrong/missing?',
            access: 'What happened? When can we reschedule?',
            more_work: 'What additional work is needed?',
            equipment: 'What equipment issue?',
            other: 'What happened?'
        };

        function selectNotCompletedReason(reason) {
            document.getElementById('twoNotCompletedReason').value = reason;
            document.getElementById('twoReasonButtons').style.display = 'none';
            document.getElementById('twoReasonDetails').classList.remove('hidden');
            document.getElementById('twoSelectedReasonText').textContent = REASON_LABELS[reason];

            // Show/hide specific sections
            document.getElementById('twoWrongPartSection').classList.toggle('hidden', reason !== 'wrong_part');
            document.getElementById('twoMoreWorkSection').classList.toggle('hidden', reason !== 'more_work');

            // Set placeholder and notes requirement
            document.getElementById('twoNotCompletedDetails').placeholder = REASON_PLACEHOLDERS[reason];

            // Notes optional for wrong_part (measurements + photo tell the story) and more_work (photo tells story)
            const notesRequired = document.getElementById('twoNotesRequired');
            if (reason === 'wrong_part' || reason === 'more_work') {
                notesRequired.textContent = '(optional)';
                notesRequired.style.color = '#6c757d';
            } else {
                notesRequired.textContent = '*Required';
                notesRequired.style.color = '#dc3545';
            }

            document.getElementById('twoReasonDetails').scrollIntoView({ behavior: 'smooth' });
        }

        function changeReason() {
            document.getElementById('twoReasonButtons').style.display = 'flex';
            document.getElementById('twoReasonDetails').classList.add('hidden');
            document.getElementById('twoNotCompletedReason').value = '';
        }

        function handleWrongPartPhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            twoWrongPartPhoto = file;
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('twoWrongPartPhotoPreview').innerHTML = `
                    <div style="position: relative; display: inline-block;">
                        <img src="${e.target.result}" style="max-width: 100%; max-height: 200px; border-radius: 8px; border: 2px solid #4CAF50;">
                        <button onclick="removeWrongPartPhoto()" style="position: absolute; top: 4px; right: 4px; background: #dc3545; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer;">√ó</button>
                    </div>
                `;
                document.getElementById('twoWrongPartPhotoPreview').classList.remove('hidden');
                document.getElementById('twoWrongPartPhotoArea').style.display = 'none';
            };
            reader.readAsDataURL(file);
        }

        function removeWrongPartPhoto() {
            twoWrongPartPhoto = null;
            document.getElementById('twoWrongPartPhotoPreview').classList.add('hidden');
            document.getElementById('twoWrongPartPhotoPreview').innerHTML = '';
            document.getElementById('twoWrongPartPhotoArea').style.display = 'block';
            document.getElementById('twoWrongPartPhotoInput').value = '';
        }

        function handleWrongPartSentPhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            twoWrongPartSentPhoto = file;
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('twoWrongPartSentPhotoPreview').innerHTML = `
                    <div style="position: relative; display: inline-block;">
                        <img src="${e.target.result}" style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px;">
                        <button onclick="removeWrongPartSentPhoto()" style="position: absolute; top: -6px; right: -6px; background: #dc3545; color: white; border: none; border-radius: 50%; width: 20px; height: 20px; cursor: pointer; font-size: 12px;">√ó</button>
                    </div>
                `;
            };
            reader.readAsDataURL(file);
        }

        function removeWrongPartSentPhoto() {
            twoWrongPartSentPhoto = null;
            document.getElementById('twoWrongPartSentPhotoPreview').innerHTML = '';
            document.getElementById('twoWrongPartSentPhotoInput').value = '';
        }

        function handleMoreWorkPhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            twoMoreWorkPhoto = file;
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('twoMoreWorkPhotoPreview').innerHTML = `
                    <div style="position: relative; display: inline-block;">
                        <img src="${e.target.result}" style="max-width: 100%; max-height: 200px; border-radius: 8px; border: 2px solid #4CAF50;">
                        <button onclick="removeMoreWorkPhoto()" style="position: absolute; top: 4px; right: 4px; background: #dc3545; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer;">√ó</button>
                    </div>
                `;
                document.getElementById('twoMoreWorkPhotoPreview').classList.remove('hidden');
                document.getElementById('twoMoreWorkPhotoArea').style.display = 'none';
            };
            reader.readAsDataURL(file);
        }

        function removeMoreWorkPhoto() {
            twoMoreWorkPhoto = null;
            document.getElementById('twoMoreWorkPhotoPreview').classList.add('hidden');
            document.getElementById('twoMoreWorkPhotoPreview').innerHTML = '';
            document.getElementById('twoMoreWorkPhotoArea').style.display = 'block';
            document.getElementById('twoMoreWorkPhotoInput').value = '';
        }

        function submitJobCompleted() {
            // Validate required fields
            if (!twoMainPhoto) {
                alert('Please upload a photo of the completed work');
                return;
            }

            const notes = document.getElementById('twoCompletionNotes').value.trim();
            if (!notes) {
                alert('Please add completion notes (even "All work completed" is fine)');
                document.getElementById('twoCompletionNotes').focus();
                return;
            }

            // In a real app, this would submit to the server
            const jobNumber = document.getElementById('twoJobNumber').textContent;
            alert(`${jobNumber} marked as COMPLETED!\n\nPhoto uploaded: Yes\nNotes: ${notes}\n\nSubmission saved. Returning to work orders list.`);

            showTechView('workorders');
        }

        function submitJobNotCompleted() {
            const reason = document.getElementById('twoNotCompletedReason').value;
            const details = document.getElementById('twoNotCompletedDetails').value.trim();

            if (!reason) {
                alert('Please select a reason');
                return;
            }

            // Validate based on reason type
            if (reason === 'wrong_part') {
                const measurements = document.getElementById('twoWrongPartMeasurements').value.trim();
                if (!measurements) {
                    alert('Please provide measurements of the correct part needed');
                    document.getElementById('twoWrongPartMeasurements').focus();
                    return;
                }
                if (!twoWrongPartPhoto) {
                    alert('Please photo a correct/working part so we know what to order');
                    return;
                }
                // Notes optional for wrong_part - measurements and photo are the key info
            } else if (reason === 'more_work') {
                if (!twoMoreWorkPhoto) {
                    alert('Please photo the issue/damage found');
                    return;
                }
                // Notes optional - photo tells the story
            } else {
                // For access, equipment, other - notes are required
                if (!details) {
                    alert('Please add a note explaining what happened');
                    document.getElementById('twoNotCompletedDetails').focus();
                    return;
                }
            }

            // Build confirmation message
            const jobNumber = document.getElementById('twoJobNumber').textContent;
            const reasonLabel = REASON_LABELS[reason];

            let confirmMsg = `${jobNumber} marked as PINK JOB\n\nReason: ${reasonLabel}`;

            if (reason === 'wrong_part') {
                const measurements = document.getElementById('twoWrongPartMeasurements').value.trim();
                confirmMsg += `\nMeasurements: ${measurements}`;
                confirmMsg += '\nCorrect part photo: ‚úì';
            } else if (reason === 'more_work') {
                confirmMsg += '\nIssue photo: ‚úì';
            }

            if (details) {
                confirmMsg += `\nNotes: ${details}`;
            }

            confirmMsg += '\n\nOffice has been notified.';
            alert(confirmMsg);

            showTechView('workorders');
        }

        // Office Functions
        function loadOfficeDashboard() {
            updateDashboardStats();
        }

        function loadEstimates() {
            const list = document.getElementById('estimatesList');
            const count = document.getElementById('pendingCount');

            count.textContent = inspections.length;

            if (inspections.length === 0) {
                list.innerHTML = '<div class="empty-state"><div class="empty-icon">üìã</div><p>No inspections pending review</p></div>';
            } else {
                list.innerHTML = inspections.map(insp => {
                    const typeIcon = insp.inspectionType === 'basketball' ? 'üèÄ' :
                                     insp.inspectionType === 'bleacher' ? 'üèüÔ∏è' :
                                     insp.inspectionType === 'outdoor' ? 'ü™ë' : 'üìã';
                    const typeLabel = insp.inspectionType === 'basketball' ? 'Basketball' :
                                      insp.inspectionType === 'bleacher' ? 'Indoor Bleacher' :
                                      insp.inspectionType === 'outdoor' ? 'Outdoor Bleacher' : 'PSF';
                    return `
                    <div class="inspection-item" onclick="viewEstimate('${insp.id}')">
                        <div class="flex-between">
                            <div>
                                <div style="margin-bottom: 4px;">
                                    <span class="badge badge-info">${typeIcon} ${typeLabel}</span>
                                </div>
                                <strong>${insp.customerName}</strong>
                                <p style="font-size: 13px; color: #6c757d; margin-top: 4px;">${insp.location || 'No location specified'}</p>
                                <p style="font-size: 12px; color: #6c757d; margin-top: 4px;">
                                    ${new Date(insp.createdAt).toLocaleDateString()} ‚Ä¢ ${insp.selectedParts?.length || 0} parts
                                </p>
                            </div>
                            <span class="badge badge-warning">pending</span>
                        </div>
                    </div>
                `}).join('');
            }
        }

        function viewEstimate(id) {
            const inspection = inspections.find(i => i.id === id);
            if (!inspection) return;

            const customer = SAMPLE_CUSTOMERS.find(c => c.id === inspection.customerId);
            const totalParts = (inspection.selectedParts || []).reduce((sum, p) => sum + (p.price * p.quantity), 0);
            const totalLabor = (inspection.laborHours || 0) * 65;
            const grandTotal = totalParts + totalLabor;

            document.getElementById('estimateDetailContent').innerHTML = `
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Customer Information</h2>
                    </div>
                    <div class="card-body">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                            <div>
                                <p style="font-size: 12px; color: #6c757d; margin-bottom: 4px;">Customer</p>
                                <p style="font-size: 14px; font-weight: 600;">${inspection.customerName}</p>
                            </div>
                            <div>
                                <p style="font-size: 12px; color: #6c757d; margin-bottom: 4px;">Location</p>
                                <p style="font-size: 14px; font-weight: 600;">${inspection.location}</p>
                            </div>
                            ${customer ? `
                                <div>
                                    <p style="font-size: 12px; color: #6c757d; margin-bottom: 4px;">Contact</p>
                                    <p style="font-size: 14px; font-weight: 600;">${customer.contact}</p>
                                </div>
                                <div>
                                    <p style="font-size: 12px; color: #6c757d; margin-bottom: 4px;">Phone</p>
                                    <p style="font-size: 14px; font-weight: 600;">${customer.phone}</p>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Parts Specification Form (PSF)</h2>
                        <span class="badge badge-success">${inspection.selectedParts?.length || 0} parts</span>
                    </div>
                    <div class="card-body">
                        ${!inspection.selectedParts || inspection.selectedParts.length === 0 ?
                            '<div style="text-align: center; padding: 40px; color: #6c757d;">No parts selected</div>' :
                            `<div style="overflow-x: auto;">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Part #</th>
                                            <th>Description</th>
                                            <th>Vendor</th>
                                            <th>Qty</th>
                                            <th>Price</th>
                                            <th>Total</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${inspection.selectedParts.map(part => `
                                            <tr>
                                                <td><span class="part-number">${part.partNumber}</span></td>
                                                <td>${part.description}</td>
                                                <td><span style="font-size: 12px; color: #6c757d;">${part.vendor}</span></td>
                                                <td>${part.quantity}</td>
                                                <td>$${part.price.toFixed(2)}</td>
                                                <td style="font-weight: 600;">$${(part.quantity * part.price).toFixed(2)}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>`
                        }

                        <div style="margin-top: 24px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                                <span>Parts Subtotal:</span>
                                <span style="font-weight: 600;">$${totalParts.toFixed(2)}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                                <span>Labor (${inspection.laborHours || 0} hrs √ó $65/hr):</span>
                                <span style="font-weight: 600;">$${totalLabor.toFixed(2)}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding-top: 12px; border-top: 2px solid #dee2e6; font-size: 18px; font-weight: 700; color: #4CAF50;">
                                <span>Grand Total:</span>
                                <span>$${grandTotal.toFixed(2)}</span>
                            </div>
                        </div>

                        ${inspection.notes ? `
                            <div style="margin-top: 20px;">
                                <p style="font-size: 12px; color: #6c757d; margin-bottom: 8px; font-weight: 600;">Service Notes:</p>
                                <div style="padding: 12px; background: #fff3e0; border-left: 4px solid #ff9800; border-radius: 4px;">
                                    ${inspection.notes}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                </div>

                <div class="card" style="background: linear-gradient(135deg, #4CAF50, #45a049); color: white;">
                    <div class="card-body">
                        <h3 style="font-size: 20px; font-weight: 700; margin-bottom: 12px;">üöÄ ONE-CLICK QuickBooks Integration</h3>
                        <p style="margin-bottom: 20px; opacity: 0.95;">
                            Click below to automatically generate a QuickBooks estimate with all parts, labor, and customer details.
                            This eliminates 30+ minutes of manual entry!
                        </p>
                        <button class="btn btn-lg" onclick="generateEstimate('${inspection.id}', ${grandTotal})"
                            style="background: white; color: #4CAF50; font-weight: 700; width: 100%;">
                            Generate QuickBooks Estimate
                        </button>
                    </div>
                </div>
            `;

            showView('estimateDetail');
        }

        // Get next job number (sequential, starting from base)
        function getNextJobNumber() {
            const baseJobNumber = 17500; // Starting point to match existing ServicePal numbering
            const existingNumbers = jobs.map(j => parseInt(j.jobNumber) || 0);
            const maxNumber = existingNumbers.length > 0 ? Math.max(...existingNumbers) : baseJobNumber - 1;
            return maxNumber + 1;
        }

        function generateEstimate(inspectionId, total) {
            const inspection = inspections.find(i => i.id === inspectionId);
            const jobNumber = getNextJobNumber();

            // Determine job type based on inspection
            const jobType = inspection.inspectionType === 'basketball' ? 'Repair' :
                           inspection.selectedParts?.length > 0 ? 'Repair' : 'Inspection';

            const locationDisplay = inspection.locationName || inspection.customerName;
            const customerDisplay = inspection.customerName || 'Unknown Customer';

            if (confirm(`Generate QuickBooks estimate for ${customerDisplay}?\n\nLocation: ${locationDisplay}\nJob #: ${jobNumber}\nTotal: $${total.toFixed(2)}\n\nThis will:\n‚Ä¢ Create estimate #${jobNumber} in QuickBooks\n‚Ä¢ Add job to Pipeline\n‚Ä¢ Send to Operations Review queue`)) {
                const job = {
                    id: 'JOB-' + Date.now(),
                    jobNumber: jobNumber,
                    estimateNumber: jobNumber, // Same as job number for continuity
                    // Customer hierarchy
                    customerId: inspection.customerId,
                    customerName: inspection.customerName,
                    customerType: inspection.customerType,
                    locationId: inspection.locationId,
                    locationName: inspection.locationName,
                    locationAddress: inspection.locationAddress || inspection.location,
                    locationContact: inspection.locationContact,
                    locationPhone: inspection.locationPhone,
                    // Job details
                    jobType: jobType,
                    description: `${inspection.inspectionType === 'basketball' ? 'Basketball Goal' : inspection.inspectionType === 'bleacher' ? 'Indoor Bleacher' : 'Outdoor Bleacher'} - ${jobType}`,
                    inspectionId: inspectionId,
                    inspectionType: inspection.inspectionType,
                    // Status tracking
                    status: 'New',
                    // Financials
                    amount: total,
                    partsTotal: inspection.selectedParts?.reduce((sum, p) => sum + (p.price * p.quantity), 0) || 0,
                    laborTotal: (inspection.laborHours || 0) * 85, // $85/hr default
                    // Dates
                    createdAt: new Date().toISOString(),
                    estimateDate: new Date().toISOString(),
                    // Work order fields (to be filled later)
                    confirmedWith: '',
                    confirmedBy: '',
                    confirmedDate: '',
                    partsLocation: '',
                    specialInstructions: '',
                    assignedTo: '',
                    scheduledDate: '',
                    // Completion tracking
                    completedBy: '',
                    completedDate: '',
                    hoursWorked: 0,
                    techNotes: ''
                };

                jobs.push(job);
                localStorage.setItem('jobs', JSON.stringify(jobs));

                alert(`‚úÖ SUCCESS!\n\nQuickBooks Estimate Created:\n‚Ä¢ Job #: ${jobNumber}\n‚Ä¢ Customer: ${customerDisplay}\n‚Ä¢ Location: ${locationDisplay}\n‚Ä¢ Total: $${total.toFixed(2)}\n\nJob added to Pipeline!\n\n‚è±Ô∏è Time saved: 30+ minutes of manual entry`);

                showView('projects');
            }
        }

        // Sample pipeline data representing jobs across all statuses
        const PIPELINE_JOBS = [
            { id: 'pl1', jobNumber: '17220', jobType: 'Repair', status: 'Estimate Sent', customer: 'Fayette County Schools', location: 'Fayette-Ware HS', description: 'Replace 3 gear motors, install safety tape on facing bleachers', amount: 8450, territory: 'Original', date: '2026-01-15' },
            { id: 'pl2', jobNumber: '17218', jobType: 'Repair', status: 'Estimate Sent', customer: 'Wilson County Schools', location: 'Mt. Juliet HS', description: 'Install end caps, replace deck boards (6), install skirt board hardware', amount: 4280, territory: 'Original', date: '2026-01-13' },
            { id: 'pl3', jobNumber: '17215', jobType: 'Repair', status: 'Estimate Sent', customer: 'Marshall County Schools', location: 'Forrest HS', description: 'Replace curved bullnose sections (4) and aisle step hardware', amount: 3175, territory: 'Original', date: '2026-01-10' },
            { id: 'pl4', jobNumber: '17212', jobType: 'Inspection', status: 'Estimate Sent', customer: 'Houston County Schools', location: 'Houston County HS', description: 'Annual bleacher inspection - 3 gyms', amount: 1800, territory: 'Original', date: '2026-01-08' },
            { id: 'pl5', jobNumber: '17225', jobType: 'Repair', status: 'Estimate Sent', customer: 'Morgan County Schools', location: 'Albert P Brewer HS', description: 'Replace floor mount hardware and L brackets on behind bleachers', amount: 2950, territory: 'Southern', date: '2026-01-20' },
            { id: 'pl6', jobNumber: '17210', jobType: 'Repair', status: 'Accepted', customer: 'Williamson County Schools', location: 'Brentwood Academy', description: 'Replace deck boards (3) and seat slats (5) on home side bleachers Section B', amount: 5620, territory: 'Original', date: '2026-01-06' },
            { id: 'pl7', jobNumber: '17205', jobType: 'Repair', status: 'Accepted', customer: 'Madison County Schools', location: 'Jackson Career & Technology Elementary', description: 'Replace gear motor, install safety tape, replace deck supports', amount: 7340, territory: 'Original', date: '2026-01-03' },
            { id: 'pl8', jobNumber: '17222', jobType: 'Repair', status: 'Accepted', customer: 'Limestone County Schools', location: 'Ardmore HS', description: 'Install new basketball goals (4) with safety straps', amount: 12800, territory: 'Southern', date: '2026-01-17' },
            { id: 'pl9', jobNumber: '17200', jobType: 'Repair', status: 'Parts Ordered', customer: 'Lauderdale County Schools', location: 'Ripley HS', description: 'Install safety strap on Goal 5, replace mounting brackets', amount: 3890, territory: 'Original', date: '2025-12-28' },
            { id: 'pl10', jobNumber: '17198', jobType: 'Repair', status: 'Parts Ordered', customer: 'Blount County Schools', location: 'Fairview ES', description: 'Raise wall buck to new height, march bleachers back and attach to wall', amount: 4150, territory: 'Original', date: '2025-12-23' },
            { id: 'pl11', jobNumber: '17208', jobType: 'Repair', status: 'Parts Received', customer: 'Lauderdale County Schools', location: 'Ripley HS', description: 'Install safety strap on Goal 5. Lift rental required.', amount: 2450, territory: 'Original', date: '2025-12-20' },
            { id: 'pl12', jobNumber: '17202', jobType: 'Repair', status: 'Parts Received', customer: 'Tullahoma City Schools', location: 'East MS', description: 'Replace 4 damaged seats - customer provided seats', amount: 1200, territory: 'Original', date: '2025-12-30' },
            { id: 'pl13', jobNumber: '17196', jobType: 'Repair', status: 'Parts Received', customer: 'Coffee County Schools', location: 'Coffee County HS', description: 'Replace tier catches (3), install end caps, replace flex row rod assembly', amount: 5890, territory: 'Original', date: '2025-12-18' },
            { id: 'pl14', jobNumber: '17190', jobType: 'Repair', status: 'Scheduled', customer: 'Montgomery County Schools', location: 'Montgomery Co HS', description: 'Install seat back hardware, end caps, aisle step hardware, safety tape, skirt board bracket hardware', amount: 9200, territory: 'Original', date: '2025-12-10' },
            { id: 'pl15', jobNumber: '17188', jobType: 'Repair', status: 'Scheduled', customer: 'Dyer County Schools', location: 'Dyersburg State CC', description: 'Adjust motor tension, install floor step feet, replace L brackets', amount: 6780, territory: 'Original', date: '2025-12-05' },
            { id: 'pl16', jobNumber: '17185', jobType: 'Repair', status: 'In Progress', customer: 'Williamson County Schools', location: 'Ravenwood HS', description: 'Multi-gym repair: deck stabilizers, safety tape, anchors, seats, skirt board hardware across 8 locations', amount: 18500, territory: 'Original', date: '2025-11-28' },
            { id: 'pl17', jobNumber: '17180', jobType: 'Repair', status: 'Complete', customer: 'Sumner County Schools', location: 'Gallatin HS', description: 'Annual inspection + replace 2 gear motors, install safety tape', amount: 6200, territory: 'Original', date: '2025-11-15' },
            { id: 'pl18', jobNumber: '17175', jobType: 'Inspection', status: 'Complete', customer: 'Robertson County Schools', location: 'Springfield HS', description: 'Annual bleacher inspection - 2 gyms, all passed', amount: 1200, territory: 'Original', date: '2025-11-10' },
            { id: 'pl19', jobNumber: '17170', jobType: 'Repair', status: 'Complete', customer: 'Maury County Schools', location: 'Spring Hill HS', description: 'Replace deck boards (8), install fence ties, replace bullnose', amount: 7800, territory: 'Original', date: '2025-11-05' },
            { id: 'pl20', jobNumber: '17195', jobType: 'Repair', status: 'Pink', customer: 'Williamson County Schools', location: 'Brentwood Academy', description: 'Goal 3 safety strap installation - wrong bracket sent, need EC-457 not EC-450', amount: 1850, territory: 'Original', date: '2025-12-15', pinkReason: 'Wrong/Missing Part' },
            { id: 'pl21', jobNumber: '17182', jobType: 'Repair', status: 'Pink', customer: 'Trousdale County Schools', location: 'Trousdale Co HS', description: 'Replace drive shaft - additional work discovered, floor anchors need replacement', amount: 3400, territory: 'Original', date: '2025-11-20', pinkReason: 'Additional Work Needed' },
            { id: 'pl22', jobNumber: '17224', jobType: 'Repair', status: 'Parts Ordered', customer: 'Colbert County Schools', location: 'Colbert Co HS', description: 'Replace basketball goal winch system and cables', amount: 5500, territory: 'Southern', date: '2026-01-18' },
            { id: 'pl23', jobNumber: '17226', jobType: 'Repair', status: 'Scheduled', customer: 'Lauderdale County AL Schools', location: 'Brooks HS', description: 'Install new Hussey bleacher system - auxiliary gym', amount: 22000, territory: 'Southern', date: '2026-01-22' }
        ];

        let pipelineFilter = 'all';

        function loadPipeline() {
            const container = document.getElementById('pipelineContent');

            // Merge sample pipeline data with any dynamically created jobs
            var allJobs = PIPELINE_JOBS.slice();
            jobs.forEach(function(j) {
                allJobs.push({
                    id: j.id,
                    jobNumber: j.jobNumber || j.estimateNumber,
                    jobType: j.jobType || 'Repair',
                    status: j.status,
                    customer: j.customerName || j.customerId,
                    location: j.locationName || j.customerLocation || '',
                    description: j.description || '',
                    amount: j.amount || 0,
                    territory: 'Original',
                    date: j.createdAt ? j.createdAt.split('T')[0] : ''
                });
            });

            // Define pipeline stages with colors
            var stages = [
                { key: 'Estimate Sent', label: 'Estimate Sent', color: '#6c757d', bg: '#f8f9fa' },
                { key: 'Accepted', label: 'Accepted', color: '#0d6efd', bg: '#e7f1ff' },
                { key: 'Parts Ordered', label: 'Parts Ordered', color: '#e65100', bg: '#fff3e0' },
                { key: 'Parts Received', label: 'Parts Received', color: '#2e7d32', bg: '#e8f5e9' },
                { key: 'Scheduled', label: 'Scheduled', color: '#1565c0', bg: '#e3f2fd' },
                { key: 'In Progress', label: 'In Progress', color: '#f57f17', bg: '#fffde7' },
                { key: 'Complete', label: 'Complete', color: '#388e3c', bg: '#e8f5e9' },
                { key: 'Pink', label: 'Pink', color: '#c62828', bg: '#ffe0e6' }
            ];

            // Count jobs per stage
            var stageCounts = {};
            var stageValues = {};
            stages.forEach(function(s) {
                stageCounts[s.key] = 0;
                stageValues[s.key] = 0;
            });
            allJobs.forEach(function(j) {
                if (stageCounts[j.status] !== undefined) {
                    stageCounts[j.status]++;
                    stageValues[j.status] += j.amount || 0;
                }
            });

            var totalActive = allJobs.filter(function(j) { return j.status !== 'Complete'; }).length;
            var totalValue = allJobs.filter(function(j) { return j.status !== 'Complete'; }).reduce(function(s, j) { return s + (j.amount || 0); }, 0);

            // Build pipeline flow
            var pipelineHtml = '<div style="display: flex; gap: 8px; margin-bottom: 24px; overflow-x: auto; padding-bottom: 4px;">';
            stages.forEach(function(stage, i) {
                var count = stageCounts[stage.key];
                var value = stageValues[stage.key];
                var isActive = pipelineFilter === stage.key;
                var isAll = pipelineFilter === 'all';
                pipelineHtml += '<div onclick="filterPipeline(\'' + stage.key + '\')" style="flex: 1; min-width: 110px; padding: 12px 10px; border-radius: 8px; background: ' + (isActive ? stage.color : stage.bg) + '; border: 2px solid ' + (isActive ? stage.color : (count > 0 ? stage.color + '40' : '#e0e0e0')) + '; cursor: pointer; text-align: center; transition: all 0.2s; opacity: ' + (isAll || isActive ? '1' : '0.7') + ';">';
                pipelineHtml += '<div style="font-size: 24px; font-weight: 700; color: ' + (isActive ? '#fff' : stage.color) + ';">' + count + '</div>';
                pipelineHtml += '<div style="font-size: 11px; font-weight: 600; color: ' + (isActive ? 'rgba(255,255,255,0.9)' : stage.color) + '; margin-bottom: 2px;">' + stage.label + '</div>';
                pipelineHtml += '<div style="font-size: 11px; color: ' + (isActive ? 'rgba(255,255,255,0.7)' : '#6c757d') + ';">$' + (value / 1000).toFixed(1) + 'k</div>';
                if (i < stages.length - 1) pipelineHtml += '</div><div style="display: flex; align-items: center; color: #ccc; font-size: 18px;">‚Ä∫</div>';
                else pipelineHtml += '</div>';
            });
            pipelineHtml += '</div>';

            // Summary bar
            pipelineHtml += '<div style="display: flex; gap: 16px; margin-bottom: 20px; align-items: center;">';
            pipelineHtml += '<div style="font-size: 14px; color: #6c757d;"><strong>' + totalActive + '</strong> active jobs &nbsp;¬∑&nbsp; <strong>$' + totalValue.toLocaleString() + '</strong> in pipeline</div>';
            pipelineHtml += '<div style="flex: 1;"></div>';
            pipelineHtml += '<button onclick="filterPipeline(\'all\')" class="btn ' + (pipelineFilter === 'all' ? 'btn-primary' : 'btn-secondary') + '" style="padding: 6px 14px; font-size: 13px;">All</button>';
            pipelineHtml += '<select onchange="filterPipelineTerritory(this.value)" id="pipelineTerritoryFilter" class="form-input" style="width: 160px; padding: 6px 10px; font-size: 13px;">';
            pipelineHtml += '<option value="all">All Territories</option><option value="Original">Original (KY/TN)</option><option value="Southern">Southern (AL/FL)</option></select>';
            pipelineHtml += '</div>';

            // Filter jobs for table
            var filtered = allJobs;
            if (pipelineFilter !== 'all') {
                filtered = filtered.filter(function(j) { return j.status === pipelineFilter; });
            }
            var territoryFilter = document.getElementById('pipelineTerritoryFilter');
            var tVal = territoryFilter ? territoryFilter.value : 'all';
            if (tVal !== 'all') {
                filtered = filtered.filter(function(j) { return j.territory === tVal; });
            }

            // Sort: active statuses first (by pipeline order), then by date desc
            var statusOrder = {};
            stages.forEach(function(s, i) { statusOrder[s.key] = i; });
            filtered.sort(function(a, b) {
                var sa = statusOrder[a.status] || 0;
                var sb = statusOrder[b.status] || 0;
                if (sa !== sb) return sa - sb;
                return (b.date || '').localeCompare(a.date || '');
            });

            // Table
            pipelineHtml += '<div class="card"><div class="card-body" style="padding: 0;">';
            if (filtered.length === 0) {
                pipelineHtml += '<div style="padding: 40px; text-align: center; color: #6c757d;">No jobs match the current filter</div>';
            } else {
                pipelineHtml += '<div style="overflow-x: auto;"><table class="data-table" style="margin: 0;">';
                pipelineHtml += '<thead><tr><th style="width: 80px;">Job #</th><th style="width: 70px;">Type</th><th>Customer</th><th>Location</th><th>Description</th><th style="width: 120px;">Status</th><th style="width: 90px; text-align: right;">Amount</th></tr></thead>';
                pipelineHtml += '<tbody>';
                filtered.forEach(function(job) {
                    var stageInfo = stages.find(function(s) { return s.key === job.status; }) || stages[0];
                    var rowBg = job.status === 'Pink' ? '#fff5f5' : '';
                    pipelineHtml += '<tr style="' + (rowBg ? 'background:' + rowBg + ';' : '') + '">';
                    pipelineHtml += '<td><span style="color: #0066cc; font-weight: 600; font-size: 13px;">' + job.jobNumber + '</span></td>';
                    pipelineHtml += '<td><span style="font-size: 12px; color: #6c757d;">' + job.jobType + '</span></td>';
                    pipelineHtml += '<td style="font-weight: 500;">' + job.customer + '</td>';
                    pipelineHtml += '<td style="font-size: 13px; color: #6c757d;">' + job.location + '</td>';
                    pipelineHtml += '<td style="font-size: 13px; max-width: 280px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="' + (job.description || '').replace(/"/g, '&quot;') + '">' + job.description + '</td>';
                    pipelineHtml += '<td><span style="display: inline-block; padding: 3px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; background: ' + stageInfo.bg + '; color: ' + stageInfo.color + '; border: 1px solid ' + stageInfo.color + '30;">' + job.status + (job.pinkReason ? ' - ' + job.pinkReason : '') + '</span></td>';
                    pipelineHtml += '<td style="text-align: right; font-weight: 600;">$' + job.amount.toLocaleString() + '</td>';
                    pipelineHtml += '</tr>';
                });
                pipelineHtml += '</tbody></table></div>';
            }
            pipelineHtml += '</div></div>';

            container.innerHTML = pipelineHtml;
        }

        function filterPipeline(status) {
            pipelineFilter = (pipelineFilter === status) ? 'all' : status;
            loadPipeline();
        }

        function filterPipelineTerritory(val) {
            loadPipeline();
        }

        function loadAccounts(filter = '') {
            const list = document.getElementById('accountsList');
            const countEl = document.getElementById('accountCount');
            const searchTerm = filter.toLowerCase();

            const filteredCustomers = CUSTOMERS.filter(c => {
                if (!searchTerm) return true;
                if (c.name.toLowerCase().includes(searchTerm)) return true;
                if (c.locations.some(l => l.name.toLowerCase().includes(searchTerm))) return true;
                return false;
            });

            countEl.textContent = `${filteredCustomers.length} customers`;

            list.innerHTML = filteredCustomers.map(customer => {
                const typeIcon = customer.type === 'county' ? 'üèõÔ∏è' : 'üè´';
                const typeLabel = customer.type === 'county' ? 'County' : 'Private';
                const typeBadgeClass = customer.type === 'county' ? 'badge-info' : 'badge-warning';

                return `
                <div class="inspection-item" onclick="viewCustomerDetail('${customer.id}')" style="cursor: pointer;">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                        <div>
                            <div style="margin-bottom: 8px;">
                                <span style="font-size: 18px;">${typeIcon}</span>
                                <strong style="margin-left: 8px; font-size: 16px;">${customer.name}</strong>
                                <span class="badge ${typeBadgeClass}" style="margin-left: 8px;">${typeLabel}</span>
                            </div>
                            <p style="font-size: 13px; color: #6c757d;">${customer.billingAddress}</p>
                            <p style="font-size: 12px; color: #6c757d; margin-top: 4px;">${customer.contact} ‚Ä¢ ${customer.phone}</p>
                            <div style="margin-top: 12px; display: flex; gap: 8px; flex-wrap: wrap;">
                                ${customer.locations.map(loc => `
                                    <span style="background: #e9ecef; padding: 4px 8px; border-radius: 4px; font-size: 12px;">${loc.name}</span>
                                `).join('')}
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 24px; font-weight: 700; color: #4CAF50;">${customer.locations.length}</div>
                            <div style="font-size: 11px; color: #6c757d;">Locations</div>
                        </div>
                    </div>
                </div>
            `}).join('');
        }

        function filterAccounts() {
            const searchTerm = document.getElementById('accountSearch').value;
            loadAccounts(searchTerm);
        }

        function viewCustomerDetail(customerId) {
            const customer = CUSTOMERS.find(c => c.id === customerId);
            if (!customer) return;

            // Populate header
            const typeIcon = customer.type === 'county' ? 'üèõÔ∏è' : 'üè´';
            document.getElementById('custDetailName').textContent = `${typeIcon} ${customer.name}`;
            document.getElementById('custDetailType').textContent = customer.type === 'county' ? 'County' : 'Private';
            document.getElementById('custDetailType').className = `badge ${customer.type === 'county' ? 'badge-info' : 'badge-warning'}`;

            // Populate info
            document.getElementById('custDetailAddress').textContent = customer.billingAddress;
            document.getElementById('custDetailContact').textContent = customer.contact;
            document.getElementById('custDetailPhone').textContent = customer.phone;

            // Stats (sample data)
            document.getElementById('custDetailLocations').textContent = customer.locations.length;
            document.getElementById('custDetailJobs').textContent = Math.floor(Math.random() * 30) + 10;
            document.getElementById('custDetailRevenue').textContent = '$' + (Math.floor(Math.random() * 50000) + 10000).toLocaleString();

            // Populate locations
            const locList = document.getElementById('custLocationsList');
            locList.innerHTML = customer.locations.map(loc => `
                <div class="inspection-item">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                        <div>
                            <strong>${loc.name}</strong>
                            <p style="font-size: 13px; color: #6c757d; margin-top: 4px;">${loc.address}</p>
                            <p style="font-size: 12px; color: #6c757d; margin-top: 4px;">${loc.contact} ‚Ä¢ ${loc.phone}</p>
                        </div>
                        <div>
                            <button class="btn btn-outline" style="font-size: 12px; padding: 6px 12px;">View Jobs</button>
                        </div>
                    </div>
                </div>
            `).join('');

            // Show detail view
            showView('customerDetail');
        }

        function showCustomerTab(tab) {
            // Hide all tabs
            document.getElementById('customerLocationsTab').classList.add('hidden');
            document.getElementById('customerHistoryTab').classList.add('hidden');
            document.getElementById('customerEquipmentTab').classList.add('hidden');

            // Reset tab styles
            document.getElementById('tabLocations').style.borderBottom = 'none';
            document.getElementById('tabLocations').style.background = 'transparent';
            document.getElementById('tabLocations').style.color = '#6c757d';
            document.getElementById('tabHistory').style.borderBottom = 'none';
            document.getElementById('tabHistory').style.background = 'transparent';
            document.getElementById('tabHistory').style.color = '#6c757d';
            document.getElementById('tabEquipment').style.borderBottom = 'none';
            document.getElementById('tabEquipment').style.background = 'transparent';
            document.getElementById('tabEquipment').style.color = '#6c757d';

            // Show selected tab
            if (tab === 'locations') {
                document.getElementById('customerLocationsTab').classList.remove('hidden');
                document.getElementById('tabLocations').style.borderBottom = '3px solid #4CAF50';
                document.getElementById('tabLocations').style.color = '#212529';
            } else if (tab === 'history') {
                document.getElementById('customerHistoryTab').classList.remove('hidden');
                document.getElementById('tabHistory').style.borderBottom = '3px solid #4CAF50';
                document.getElementById('tabHistory').style.color = '#212529';
            } else if (tab === 'equipment') {
                document.getElementById('customerEquipmentTab').classList.remove('hidden');
                document.getElementById('tabEquipment').style.borderBottom = '3px solid #4CAF50';
                document.getElementById('tabEquipment').style.color = '#212529';
            }
        }

        // Tech Functions
        function loadTechDashboard() {
            updateDashboardStats();
        }

        function loadTechInspections() {
            const list = document.getElementById('techInspectionsList');

            if (inspections.length === 0) {
                list.innerHTML = '<div class="empty-state"><div class="empty-icon">üìã</div><p>No inspections yet</p><p style="font-size: 14px; margin-top: 8px;">Click "New Inspection" to get started</p></div>';
            } else {
                list.innerHTML = inspections.map(insp => {
                    const typeIcon = insp.inspectionType === 'basketball' ? 'üèÄ' :
                                     insp.inspectionType === 'bleacher' ? 'üèüÔ∏è' :
                                     insp.inspectionType === 'outdoor' ? 'ü™ë' : 'üìã';
                    const typeLabel = insp.inspectionType === 'basketball' ? 'Basketball' :
                                      insp.inspectionType === 'bleacher' ? 'Indoor Bleacher' :
                                      insp.inspectionType === 'outdoor' ? 'Outdoor Bleacher' : 'PSF';
                    return `
                    <div class="inspection-item">
                        <div class="flex-between">
                            <div>
                                <div style="margin-bottom: 4px;">
                                    <span class="badge badge-info">${typeIcon} ${typeLabel}</span>
                                </div>
                                <strong>${insp.customerName}</strong>
                                <p style="font-size: 13px; color: #6c757d; margin-top: 4px;">${insp.location || 'No location'}</p>
                                <p style="font-size: 12px; color: #6c757d; margin-top: 4px;">
                                    ${new Date(insp.createdAt).toLocaleDateString()} ‚Ä¢ ${insp.selectedParts?.length || 0} parts
                                </p>
                            </div>
                            <span class="badge badge-success">submitted</span>
                        </div>
                    </div>
                `}).join('');
            }
        }

        function loadOfficeInspections() {
            const list = document.getElementById('officeInspectionsList');
            const count = document.getElementById('officeInspectionsCount');
            const inProgressCount = document.getElementById('officeInProgressCount');
            const totalBanks = document.getElementById('officeTotalBanks');

            // Use new inspectionJobs array
            const submitted = inspectionJobs.filter(j => j.status === 'submitted');
            const inProgress = inspectionJobs.filter(j => j.status === 'in_progress');

            // Count total banks
            let bankCount = 0;
            inspectionJobs.forEach(j => bankCount += (j.banks?.length || 0));

            // Update stat cards
            if (count) count.textContent = submitted.length;
            if (inProgressCount) inProgressCount.textContent = inProgress.length;
            if (totalBanks) totalBanks.textContent = bankCount;

            if (inspectionJobs.length === 0) {
                list.innerHTML = '<div class="empty-state"><div class="empty-icon">üìã</div><p>No inspections yet</p><p style="font-size: 14px; margin-top: 8px;">Click "New Inspection" to get started</p></div>';
            } else {
                // Show all jobs with status
                list.innerHTML = inspectionJobs.map(job => {
                    const typeIcon = job.inspectionType === 'basketball' ? 'üèÄ' :
                                     job.inspectionType === 'bleacher' ? 'üèüÔ∏è' :
                                     job.inspectionType === 'outdoor' ? 'ü™ë' : 'üìã';
                    const typeLabel = job.inspectionType === 'basketball' ? 'Basketball' :
                                      job.inspectionType === 'bleacher' ? 'Indoor Bleacher' :
                                      job.inspectionType === 'outdoor' ? 'Outdoor Bleacher' : 'Inspection';
                    const statusBadge = job.status === 'submitted' ?
                        '<span class="badge badge-success">Submitted</span>' :
                        '<span class="badge badge-warning" style="background: #fff3e0; color: #e65100;">In Progress</span>';
                    const bankCount = job.banks?.length || 0;
                    const issueCount = job.banks?.reduce((sum, bank) => {
                        return sum + (bank.understructureIssues?.length || 0) + (bank.topSideIssues?.length || 0);
                    }, 0) || 0;

                    return `
                    <div class="inspection-item" onclick="viewSubmittedJob(${job.jobNumber})" style="cursor: pointer;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                            <div>
                                <div style="margin-bottom: 8px;">
                                    <span class="part-number" style="color: #0066cc; font-size: 14px;">${job.jobNumber}</span>
                                    <span style="margin-left: 8px; font-size: 12px; color: #6c757d;">${typeIcon} ${typeLabel}</span>
                                </div>
                                <strong>${job.locationName}</strong>
                                <p style="font-size: 12px; color: #6c757d; margin-top: 2px;">${job.customerName}</p>
                                <p style="font-size: 13px; color: #6c757d; margin-top: 8px;">
                                    ${bankCount} bank${bankCount !== 1 ? 's' : ''} ‚Ä¢ ${issueCount} issue${issueCount !== 1 ? 's' : ''} found
                                </p>
                                <p style="font-size: 12px; color: #999; margin-top: 4px;">
                                    Inspector: ${job.inspectorName || 'Unknown'} ‚Ä¢ ${new Date(job.createdAt).toLocaleDateString()}
                                </p>
                            </div>
                            <div style="text-align: right;">
                                ${statusBadge}
                                <div style="color: #4CAF50; font-size: 20px; margin-top: 8px;">‚Üí</div>
                            </div>
                        </div>
                    </div>
                `}).join('');
            }
        }

        function startNewInspection() {
            currentInspection = { selectedParts: [] };
            currentInspectionType = '';
            goalInspections = [];
            issuesList = [];

            // Reset form
            document.getElementById('inspectionTypeSelect').value = '';
            document.getElementById('inspectionFormFields').classList.add('hidden');
            document.getElementById('basketballFields').classList.add('hidden');
            document.getElementById('bleacherFields').classList.add('hidden');
            document.getElementById('outdoorFields').classList.add('hidden');
            document.getElementById('manufacturerSection').classList.add('hidden');

            if (currentRole === 'office') {
                // Hide all office views
                document.querySelectorAll('[id$="View"]').forEach(el => el.classList.add('hidden'));
                // Show techDashboard temporarily to access the inspection form
                document.getElementById('officeDashboard').classList.add('hidden');
                document.getElementById('techDashboard').classList.remove('hidden');
            }

            document.querySelectorAll('#techDashboard [id^="tech"][id$="View"]').forEach(el => el.classList.add('hidden'));
            document.getElementById('newInspectionView').classList.remove('hidden');
            renderSelectedParts();
        }

        function goBackFromInspection() {
            // Hide all inspection-related views
            document.getElementById('newJobSetupView')?.classList.add('hidden');
            document.getElementById('bankInspectionView')?.classList.add('hidden');
            document.getElementById('jobSummaryView')?.classList.add('hidden');
            document.getElementById('newInspectionView')?.classList.add('hidden');

            if (currentRole === 'office') {
                document.getElementById('techDashboard').classList.add('hidden');
                document.getElementById('officeDashboard').classList.remove('hidden');
                showView('inspections');
                loadInspectionJobs(); // Refresh job list
            } else {
                showTechView('create');
            }
        }

        function updateCustomerInfo() {
            const selectEl = document.getElementById('customerSelect');
            const locationId = selectEl.value;
            const info = document.getElementById('customerInfo');

            if (locationId) {
                const selectedOption = selectEl.options[selectEl.selectedIndex];
                const customerId = selectedOption.dataset.customerId;
                const customerName = selectedOption.dataset.customerName;
                const customerType = selectedOption.dataset.customerType;

                // Find full customer and location data
                const customer = CUSTOMERS.find(c => c.id === customerId);
                const location = customer?.locations.find(l => l.id === locationId);

                if (customer && location) {
                    // Billing entity info
                    const typeIcon = customer.type === 'county' ? 'üèõÔ∏è' : 'üè´';
                    document.getElementById('billingEntityName').textContent = `${typeIcon} ${customer.name}`;
                    document.getElementById('billingEntityContact').textContent = `${customer.contact} ‚Ä¢ ${customer.phone}`;

                    // Service location info
                    document.getElementById('customerName').textContent = location.name;
                    document.getElementById('customerAddress').textContent = location.address;
                    document.getElementById('customerContact').textContent = `${location.contact} ‚Ä¢ ${location.phone}`;

                    info.classList.remove('hidden');

                    // Store in current inspection
                    currentInspection.customerId = customerId;
                    currentInspection.customerName = customer.name;
                    currentInspection.customerType = customer.type;
                    currentInspection.locationId = locationId;
                    currentInspection.locationName = location.name;
                    currentInspection.locationAddress = location.address;
                    currentInspection.locationContact = location.contact;
                    currentInspection.locationPhone = location.phone;
                    currentInspection.billingContact = customer.contact;
                    currentInspection.billingPhone = customer.phone;
                    currentInspection.location = document.getElementById('locationInput').value || location.address;
                }
            } else {
                info.classList.add('hidden');
            }
        }

        async function searchParts() {
            const searchTerm = document.getElementById('partSearch').value.trim();
            const category = document.getElementById('vendorFilter').value;
            const results = document.getElementById('partsResults');

            if (!searchTerm && !category) {
                results.innerHTML = '<div style="text-align: center; padding: 20px; color: #6c757d;">Enter a search term or select a category</div>';
                return;
            }

            results.innerHTML = '<div style="text-align: center; padding: 40px; color: #6c757d;">üîç Searching 2,142 Hussey parts...</div>';

            try {
                // Build Airtable filter formula
                let filters = [];
                if (searchTerm) {
                    filters.push(`OR(
                        FIND(LOWER("${searchTerm}"), LOWER({Product Name})),
                        FIND(LOWER("${searchTerm}"), LOWER({Part Number})),
                        FIND(LOWER("${searchTerm}"), LOWER({Description})),
                        FIND(LOWER("${searchTerm}"), LOWER({Category})),
                        FIND(LOWER("${searchTerm}"), LOWER({Subcategory})),
                        FIND(LOWER("${searchTerm}"), LOWER({Product Line})),
                        FIND(LOWER("${searchTerm}"), LOWER({Model Info}))
                    )`);
                }
                if (category) {
                    filters.push(`{Category} = "${category}"`);
                }

                const formula = filters.length > 1 ? `AND(${filters.join(',')})` : filters[0];
                const url = `https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_TABLE_ID}?filterByFormula=${encodeURIComponent(formula)}&pageSize=50`;

                const response = await fetch(url, {
                    headers: { 'Authorization': `Bearer ${AIRTABLE_API_KEY}` }
                });

                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }

                const data = await response.json();
                const records = data.records;

                // Store results for selection
                searchResults = {};
                records.forEach(r => { searchResults[r.id] = r.fields; });

                if (records.length === 0) {
                    results.innerHTML = '<div style="text-align: center; padding: 20px; color: #6c757d;">No parts found matching your search</div>';
                } else {
                    results.innerHTML = `
                        <p style="font-size: 12px; color: #6c757d; margin: 12px 0;">Found ${records.length} parts from Hussey catalog</p>
                        ${records.map(record => {
                            const part = record.fields;
                            const price = parseFloat(part['Price 2025']) || 0;
                            const priceDisplay = part['Price 2025'] === 'Call for Price' ? 'Call for Price' : (price > 0 ? `$${price.toFixed(2)}` : 'N/A');
                            return `
                                <div class="part-result" onclick="selectPart('${record.id}')">
                                    <div style="margin-bottom: 8px;">
                                        <span class="part-number">${part['Part Number'] || '‚Äî'}</span>
                                        <span class="part-vendor">Hussey Seating Co</span>
                                    </div>
                                    <div class="part-description">${part['Product Name'] || 'Unknown Part'}</div>
                                    <div class="part-meta">
                                        <span class="part-category">${part['Category'] || ''}</span>
                                        <span class="part-price">${priceDisplay}</span>
                                    </div>
                                    ${part['Product Line'] ? `<div style="font-size: 11px; color: #888; margin-top: 4px;">${part['Product Line']}</div>` : ''}
                                </div>
                            `;
                        }).join('')}
                    `;
                }
            } catch (err) {
                results.innerHTML = `<div style="text-align: center; padding: 20px; color: #dc3545;">Search failed: ${err.message}</div>`;
            }
        }

        function selectPart(recordId) {
            // Get part data from stored search results
            const partData = searchResults[recordId];
            if (!partData) {
                console.error('Part not found in search results');
                return;
            }

            const partName = partData['Product Name'] || 'Unknown Part';
            const quantity = parseInt(prompt(`How many "${partName}"?`, '1'));

            if (quantity > 0) {
                if (!currentInspection.selectedParts) currentInspection.selectedParts = [];

                // Convert Airtable format to our internal format
                const part = {
                    id: recordId,
                    partNumber: partData['Part Number'] || '‚Äî',
                    description: partData['Product Name'] || 'Unknown Part',
                    vendor: 'Hussey Seating Co',
                    category: partData['Category'] || '',
                    price: parseFloat(partData['Price 2025']) || 0,
                    productLine: partData['Product Line'] || '',
                    quantity: quantity
                };

                currentInspection.selectedParts.push(part);
                renderSelectedParts();

                // Clear search after selection
                document.getElementById('partSearch').value = '';
                document.getElementById('partsResults').innerHTML = '<div style="text-align: center; padding: 20px; color: #4CAF50;">‚úì Part added! Search for more parts above.</div>';
            }
        }

        function renderSelectedParts() {
            const list = document.getElementById('selectedPartsList');
            const count = document.getElementById('partsCount');

            if (!currentInspection.selectedParts || currentInspection.selectedParts.length === 0) {
                list.innerHTML = '<div class="empty-state"><div class="empty-icon">üì¶</div><p>No parts added yet</p><p style="font-size: 14px; margin-top: 8px;">Search and select parts above</p></div>';
                count.textContent = '0';
            } else {
                const total = currentInspection.selectedParts.reduce((sum, p) => sum + (p.price * p.quantity), 0);
                count.textContent = currentInspection.selectedParts.length;

                list.innerHTML = currentInspection.selectedParts.map((part, index) => `
                    <div class="selected-part">
                        <div style="flex: 1;">
                            <div style="margin-bottom: 8px;">
                                <span class="part-number">${part.partNumber}</span>
                                <span class="part-vendor">${part.vendor}</span>
                            </div>
                            <div style="font-size: 14px; font-weight: 500; margin-bottom: 4px;">${part.description}</div>
                            <div style="font-size: 14px; color: #6c757d;">
                                Qty: ${part.quantity} √ó $${part.price.toFixed(2)} = <strong style="color: #4CAF50;">$${(part.quantity * part.price).toFixed(2)}</strong>
                            </div>
                        </div>
                        <button class="remove-btn" onclick="removePart(${index})">√ó</button>
                    </div>
                `).join('') + `
                    <div class="selected-part" style="background: #4CAF50; color: white;">
                        <div style="flex: 1;">
                            <div class="flex-between">
                                <span style="font-size: 16px; font-weight: 700;">Total Parts</span>
                                <span style="font-size: 24px; font-weight: 700;">$${total.toFixed(2)}</span>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        function removePart(index) {
            currentInspection.selectedParts.splice(index, 1);
            renderSelectedParts();
        }

        function submitInspection() {
            if (!currentInspectionType) {
                alert('Please select an inspection type');
                return;
            }

            if (!currentInspection.customerId) {
                alert('Please select a customer');
                return;
            }

            // Common fields
            currentInspection.inspectionType = currentInspectionType;
            currentInspection.location = document.getElementById('locationInput').value || currentInspection.location;
            currentInspection.manufacturer = document.getElementById('manufacturerSelect')?.value || '';
            currentInspection.model = document.getElementById('modelInput')?.value || '';
            currentInspection.laborHours = parseFloat(document.getElementById('laborHours').value) || 0;
            currentInspection.notes = document.getElementById('serviceNotes').value;
            currentInspection.safetyIssues = document.getElementById('safetyIssues')?.value || '';
            currentInspection.mechanicalIssues = document.getElementById('mechanicalIssues')?.value || '';
            currentInspection.cosmeticIssues = document.getElementById('cosmeticIssues')?.value || '';

            // Type-specific fields
            if (currentInspectionType === 'basketball') {
                currentInspection.brand = document.getElementById('bbBrand')?.value;
                currentInspection.goalCount = document.getElementById('bbGoalCount')?.value;
                currentInspection.gymType = document.getElementById('bbGymType')?.value;
                currentInspection.paddingColor = document.getElementById('bbPaddingColor')?.value;
                currentInspection.paddingDimensions = document.getElementById('bbPaddingDimensions')?.value;
                currentInspection.ceilingType = document.getElementById('bbCeilingType')?.value;
                currentInspection.goals = collectGoalData();
                currentInspection.checklist = collectChecklist('bbChecklist', CHECKLISTS.basketball);
            } else if (currentInspectionType === 'bleacher') {
                currentInspection.banks = document.getElementById('blBanks')?.value;
                currentInspection.tiers = document.getElementById('blTiers')?.value;
                currentInspection.rise = document.getElementById('blRise')?.value;
                currentInspection.rowSpacing = document.getElementById('blRowSpacing')?.value;
                currentInspection.bleacherType = document.getElementById('blType')?.value;
                currentInspection.seatType = document.getElementById('blSeatType')?.value;
                currentInspection.material = document.getElementById('blMaterial')?.value;
                currentInspection.color = document.getElementById('blColor')?.value;
                currentInspection.motorPhase = document.getElementById('blMotorPhase')?.value;
                currentInspection.motorHP = document.getElementById('blMotorHP')?.value;
                currentInspection.motorCount = document.getElementById('blMotorCount')?.value;
                currentInspection.sections = document.getElementById('blSections')?.value;
                currentInspection.rows = document.getElementById('blRows')?.value;
                currentInspection.aisles = document.getElementById('blAisles')?.value;
                currentInspection.understructureChecklist = collectChecklist('blUnderstructureChecklist', CHECKLISTS.bleacherUnderstructure);
                currentInspection.topSideChecklist = collectChecklist('blTopSideChecklist', CHECKLISTS.bleacherTopSide);
                currentInspection.issues = collectIssues();
            } else if (currentInspectionType === 'outdoor') {
                currentInspection.bleacherType = document.getElementById('outType')?.value;
                currentInspection.tiers = document.getElementById('outTiers')?.value;
                currentInspection.length = document.getElementById('outLength')?.value;
                currentInspection.side = document.getElementById('outSide')?.value;
                currentInspection.seatDimensions = document.getElementById('outSeatDimensions')?.value;
                currentInspection.seatColor = document.getElementById('outSeatColor')?.value;
                currentInspection.sections = document.getElementById('outSections')?.value;
                currentInspection.rows = document.getElementById('outRows')?.value;
                currentInspection.rise = document.getElementById('outRise')?.value;
                currentInspection.run = document.getElementById('outRun')?.value;
                currentInspection.codeIssues = document.getElementById('outCodeIssues')?.value;
                currentInspection.understructureChecklist = collectChecklist('outUnderstructureChecklist', CHECKLISTS.outdoorUnderstructure);
                currentInspection.topSideChecklist = collectChecklist('outTopSideChecklist', CHECKLISTS.outdoorTopSide);
                currentInspection.issues = collectIssues();
            }

            currentInspection.id = 'INS-' + Date.now();
            currentInspection.createdAt = new Date().toISOString();
            currentInspection.status = 'submitted';

            inspections.push(currentInspection);
            localStorage.setItem('inspections', JSON.stringify(inspections));

            const typeLabel = currentInspectionType === 'basketball' ? 'Basketball Goal' :
                              currentInspectionType === 'bleacher' ? 'Indoor Bleacher' : 'Outdoor Bleacher';

            alert(`‚úÖ ${typeLabel} Inspection submitted successfully!\n\nüéâ NO after-hours work needed - you're done!\n\nOffice staff can now review and generate a QuickBooks estimate.`);

            currentInspection = {};
            currentInspectionType = '';
            updateDashboardStats();
            goBackFromInspection();
        }

        // Collect goal inspection data
        function collectGoalData() {
            const goals = [];
            for (let i = 1; i <= goalInspections.length; i++) {
                goals.push({
                    goalNumber: i,
                    type: document.getElementById(`goal${i}_type`)?.value,
                    backboard: document.getElementById(`goal${i}_backboard`)?.value,
                    winch: document.getElementById(`goal${i}_winch`)?.value,
                    mast: document.getElementById(`goal${i}_mast`)?.value,
                    safetyStrap: document.getElementById(`goal${i}_safetyStrap`)?.value,
                    anchor: document.getElementById(`goal${i}_anchor`)?.value,
                    recommendations: document.getElementById(`goal${i}_recommendations`)?.value
                });
            }
            return goals;
        }

        // Collect checklist data
        function collectChecklist(containerId, items) {
            return items.map((item, i) => ({
                item: item,
                checked: document.getElementById(`${containerId}_${i}`)?.checked || false,
                na: document.getElementById(`${containerId}_${i}_na`)?.checked || false
            }));
        }

        // Collect issues data
        function collectIssues() {
            const issues = [];
            for (let i = 1; i <= issuesList.length; i++) {
                const desc = document.getElementById(`issue${i}_desc`)?.value;
                if (desc) {
                    issues.push({
                        frame: document.getElementById(`issue${i}_frame`)?.value,
                        tier: document.getElementById(`issue${i}_tier`)?.value,
                        description: desc
                    });
                }
            }
            return issues;
        }

        // ==========================================
        // SCHEDULING FUNCTIONS
        // ==========================================

        // Techs/Crews list
        const TECHS = [
            'Danny (overnight)',
            'Jon (overnight)',
            'Floyd (overnight)',
            'Sam (overnight)',
            'Blake & Rick (overnight)',
            'Chris & Blake (overnight)',
            'Troy & Rick (overnight)',
            'Alex W & Michael (overnight)',
            'Chris & Owen (overnight)',
            'Troy, Alex & Rick (overnight)',
            'Floyd, Anthony, Blake & Seth (overnight)',
            'Alex M (overnight)',
            'Danny',
            'Jon',
            'Floyd',
            'Sam',
            'Blake & Rick',
            'Chris & Blake',
            'Troy & Rick',
            'Alex W & Michael',
            'Chris & Owen',
            'Troy',
            'Alex',
            'Rick',
            'Blake',
            'Chris',
            'Michael',
            'Owen',
            'Anthony',
            'Seth',
            'Alex M'
        ];

        // Current week offset (0 = current week, -1 = last week, 1 = next week)
        let scheduleWeekOffset = 0;
        let currentScheduleTab = 'thisWeek';
        let currentTerritory = 'original'; // 'original' or 'southern'
        let myJobsWeekOffset = 0;
        let teamScheduleWeekOffset = 0;
        let currentTeamTerritory = 'original';

        // Schedule data per territory
        let scheduleDataOriginal = {};
        let scheduleDataSouthern = {};

        // Active schedule data reference (points to current territory)
        let scheduleData = {};

        // Initialize with sample data from the Excel trackers
        function initializeSampleScheduleData() {
            // Week of Feb 3, 2025 - ORIGINAL TERRITORY (KY/TN)
            scheduleDataOriginal = {
                '2025-02-03': [
                    {
                        id: 's1', type: 'job',
                        school: 'Montgomery Co HS, KY',
                        details: 'FACING: Labor to install seat back hardware and a RH end cap FACING UPPER: Labor to install LH and RH end caps BEHIND: Labor to replace a LH tier catch BEHIND UPPER: Labor to install aisle step hardware and clean/prep/install safety tape END: Labor to install aisle step hardware and skirt board bracket hardware. FOOTBALL HOME: Labor to install curved bullnose. BASEBALL: Labor to install riser board hardware SOCCER: Labor to replace an end cap',
                        tech: 'Sam (overnight)',
                        partsLocation: 'Sams Truck',
                        isPink: false
                    },
                    {
                        id: 's2', type: 'job',
                        school: 'Menifee Co, KY',
                        details: 'Indoor Bleacher Inspections: Menifee Central K-8 and Menifee HS',
                        tech: 'Sam (overnight)',
                        partsLocation: '',
                        isPink: false
                    },
                    {
                        id: 's3', type: 'job',
                        school: 'Fairview ES, Blount Co, TN',
                        details: 'Labor to raise wall buck to new height, march bleachers back and attach bleacher to wall. Reinstall seats if removed',
                        tech: 'Troy & Alex M (overnight)',
                        partsLocation: 'UPS: 1Z66W7040311645722 estimated delivery 2/2 end of day - shipping to school',
                        isPink: false
                    },
                    {
                        id: 's4', type: 'job',
                        school: 'Motlow State Community College - Tullahoma Campus, TN',
                        details: 'FACING UPPER: Labor to install step end caps',
                        tech: 'Chris & Owen (overnight)',
                        partsLocation: 'TN Shop- pick up 1/30',
                        isPink: false
                    },
                    {
                        id: 's5', type: 'job',
                        school: 'East MS, Tullahoma City, TN',
                        details: 'Labor to replace 4 damaged seats *Customer provided seats*',
                        tech: 'Chris & Owen (overnight)',
                        partsLocation: 'School',
                        isPink: false
                    },
                    {
                        id: 's6', type: 'job',
                        school: 'Tullahoma HS, Tullahoma, TN',
                        details: 'Go-see, possible bleacher warranty issue, school contact is John Olive (AD)',
                        tech: 'Chris & Owen (overnight)',
                        partsLocation: '',
                        isPink: false
                    },
                    {
                        id: 's7', type: 'job',
                        school: 'Forrest HS, Marshall Co, TN',
                        details: 'LOWER FACING: Labor to replace a gear motor',
                        tech: 'Chris & Owen (overnight)',
                        partsLocation: 'TN Shop- pick up 1/30',
                        isPink: false
                    },
                    {
                        id: 's8', type: 'note',
                        school: '',
                        details: 'Stop at shop to pick up parts',
                        tech: 'Alex W & Michael (overnight)',
                        partsLocation: '',
                        isPink: false
                    },
                    {
                        id: 's9', type: 'job',
                        school: 'Ravenwood HS, Williamson Co, TN',
                        details: '*Grab leftover NRS parts for Centennial HS* FACING: Labor to replace deck stabilizers and casterhorn guides, clean/prep/install safety tape, secure loose anchors, and slide deck boards into place BEHIND: Labor to install tier catch and replace a flex row rod assembly AUX: Labor to install seats, skirt board hardware, install concrete anchors in wall buck, clean/prep/install safety tape, install seat end caps, secure outrigger hardware (2), and secure skirt panel bracket hardware FOOTBALL HOME: Labor to install seat boards, splices, footboards, fence ties, end caps, clip sets, stair handrail hardware, realign and secure aisle steps (16), and reattach front surround pipe FOOTBALL VISITOR: Labor to install fence ties, splices, seat boards, end caps, clip sets, fence support hardware, install pipe straps, and secure a footboard BASEBALL HOME: Labor to secure handrail hardware, clip sets and secure seat hardware (2) BASKETBALL 3rd: Labor to install end caps and fence ties SOCCER: Labor to straighten rear surround pipe spindles (2) SOFTBALL 1st: Labor to adjust footboard clips',
                        tech: 'Alex W & Michael (overnight)',
                        partsLocation: 'TN Shop/ School',
                        isPink: false
                    },
                    {
                        id: 's10', type: 'job',
                        school: 'Dyersburg State Community College, Dyersburg, TN',
                        details: 'FACING LEFT: Labor to adjust motor tension FACING RIGHT: Labor to install floor step feet BEHIND LEFT: Labor to install floor mount hardware and replace L brackets BEHIND RIGHT: Labor to install floor mount hardware and skirt board hardware, and replace L brackets',
                        tech: 'Floyd (overnight)',
                        partsLocation: 'TN Shop- Ship to Floyd UPS: 1Z66W7040304500696',
                        isPink: false
                    },
                    {
                        id: 's11', type: 'note',
                        school: '',
                        details: 'Blake & Seth to Southern Territory',
                        tech: '',
                        partsLocation: '',
                        isPink: false
                    }
                ],
                '2025-02-04': [
                    {
                        id: 's12', type: 'job',
                        school: 'EKU, Richmond, KY',
                        details: 'Additional measurements needed for end rails, call Lisa for details + Pick up seats that Alex W left at the school and bring back to TN Shop',
                        tech: 'Sam (overnight)',
                        partsLocation: '',
                        isPink: false
                    },
                    {
                        id: 's13', type: 'job',
                        school: 'Fentress Co, TN',
                        details: 'Indoor Bleacher Inspections: Clarkrange HS, Allardt ES, Pine Haven ES, South Fentress ES, and York ES',
                        tech: 'Sam (overnight)',
                        partsLocation: '',
                        isPink: false
                    },
                    {
                        id: 's14', type: 'job',
                        school: 'Rhea Co, TN',
                        details: 'Indoor/Outdoor Bleacher Inspections: Rhea MS, Spring City MS (Gym, Baseball, and Football) and Rhea County HS (Gym, Baseball, Softball, and Football)',
                        tech: 'Matt (overnight)',
                        partsLocation: '',
                        isPink: false
                    },
                    {
                        id: 's15', type: 'job',
                        school: 'Meade Co, KY',
                        details: 'Indoor Bleacher Inspections w/ PM: DT Wilson ES, Ekron ES, Flaherty ES, Stuart Pepper MS, Flaherty PS, Payneville ES, Barry Hahn ES, Indoor/Outdoor & Basketball Inspections w/PM- Meade Co HS (Freshman Academy Gym, Main Gym and Football *Customer to provide lift*) Stuart Pepper MS (Soccer and Football)',
                        tech: 'Danny (overnight)',
                        partsLocation: '',
                        isPink: false
                    },
                    {
                        id: 's16', type: 'continued',
                        school: 'Fairview ES, Blount Co, TN',
                        details: 'Continued',
                        tech: 'Troy & Alex M (overnight)',
                        partsLocation: '',
                        isPink: false
                    },
                    {
                        id: 's17', type: 'job',
                        school: 'Spencer ES, Spencer, TN',
                        details: '**Truck to arrive 9:30am, Removal of exiting pads and dumpster for dunnage is customer responsibility** Labor to replace wall pads',
                        tech: 'Chris & Owen (overnight)',
                        partsLocation: 'School',
                        isPink: true
                    },
                    {
                        id: 's18', type: 'continued',
                        school: 'Ravenwood HS, Williamson Co, TN',
                        details: 'Continued',
                        tech: 'Alex W & Michael (overnight)',
                        partsLocation: '',
                        isPink: false
                    },
                    {
                        id: 's19', type: 'job',
                        school: 'Trousdale Co HS, TN',
                        details: 'FACING: Labor to replace RH and LH tier catches, replace an aisle rail socket, grease deck supports, elevate wiring harness, and put a power frame back on track BEHIND: Labor to grease deck supports AUDITORIUM: Labor to replace a gearbox, install flex row handles and flex row rods FOOTBALL HOME: Labor to install an end cap and secure loose frame hardware, surround support hardware and ADA ramp hardware',
                        tech: 'Floyd (overnight)',
                        partsLocation: 'School/ TN Shop',
                        isPink: false
                    }
                ],
                '2025-02-05': [],
                '2025-02-06': [],
                '2025-02-07': []
            };

            // Week of Feb 3, 2025 - SOUTHERN TERRITORY (AL/FL)
            scheduleDataSouthern = {
                '2025-02-03': [
                    {
                        id: 'ss1',
                        type: 'job',
                        school: 'Dauphin JHS, Enterprise City Schools, AL',
                        details: '*Have customer get parts over to install area, Bring FL Shop lift?, Customer to provide lift & Dumpster* Labor to demo 2 goals and install 2 new goals',
                        tech: 'Floyd, Anthony, Blake & Seth (overnight)',
                        partsLocation: 'School',
                        isPink: false
                    },
                    {
                        id: 'ss2',
                        type: 'job',
                        school: 'Dale Co HS, Dale Co, AL',
                        details: 'MAIN GYM: Labor to replace motor/gearmotor and install safety skid tape (18). AUX GYM: Labor to install pendant clasp.',
                        tech: 'Jon (overnight)',
                        partsLocation: 'FL Shop',
                        isPink: false
                    }
                ],
                '2025-02-04': [
                    {
                        id: 'ss3',
                        type: 'continued',
                        school: 'Dauphin JHS, Enterprise City Schools, AL',
                        details: 'Continued',
                        tech: 'Floyd, Anthony, Blake & Seth (overnight)',
                        partsLocation: '',
                        isPink: false
                    },
                    {
                        id: 'ss4',
                        type: 'job',
                        school: 'Houston Co HS, Houston Co, AL',
                        details: 'Indoor Bleacher Inspections: Houston Co HS (Main & Aux), Houston Co MS, Wicksburg HS',
                        tech: 'Danny (overnight)',
                        partsLocation: '',
                        isPink: false
                    }
                ],
                '2025-02-05': [
                    {
                        id: 'ss5',
                        type: 'continued',
                        school: 'Houston Co, AL',
                        details: 'Continued',
                        tech: 'Danny (overnight)',
                        partsLocation: '',
                        isPink: false
                    },
                    {
                        id: 'ss6',
                        type: 'job',
                        school: 'Dothan City Schools, AL',
                        details: 'Indoor Bleacher Inspections: Dothan HS, Northview HS, Carver HS, Girard MS, Honeysuckle MS',
                        tech: 'Jon (overnight)',
                        partsLocation: '',
                        isPink: false
                    }
                ]
            };

            // Set active schedule based on current territory
            scheduleData = currentTerritory === 'original' ? scheduleDataOriginal : scheduleDataSouthern;
        }

        // Backlog jobs per territory
        let readyToScheduleJobs = [
            {
                id: 'r1',
                jobNumber: '17215',
                type: 'Repair',
                county: 'Williamson Co',
                school: 'Brentwood HS',
                state: 'TN',
                details: '*Lift required, need to take bungee for safety strap* Go-see, find out why safety strap retractors are not installed correctly on goals 2, 3, & 5 in main gym',
                laborAmount: 850,
                partsLocation: 'TN Shop',
                estimateDate: '2024-12-15',
                acceptedDate: '2024-12-20'
            },
            {
                id: 'r2',
                jobNumber: '17220',
                type: 'Repair',
                county: 'Robertson Co',
                school: 'Springfield HS',
                state: 'TN',
                details: 'MAIN GYM: Labor to replace motor/gearmotor and install safety skid tape (24). Labor to install pendant clasp and tension drive frame hardware.',
                laborAmount: 2450,
                partsLocation: 'TN Shop',
                estimateDate: '2024-12-18',
                acceptedDate: '2024-12-22'
            },
            {
                id: 'r3',
                jobNumber: '17225',
                type: 'Inspection',
                county: 'Davidson Co',
                school: 'Metro Nashville Schools - Multiple',
                state: 'TN',
                details: 'Indoor Bleacher Inspections: Hillsboro HS, Hillwood HS, Hunters Lane HS, Maplewood HS, McGavock HS (Main & Aux), Pearl-Cohn HS, Stratford HS',
                laborAmount: 4200,
                partsLocation: '',
                estimateDate: '2024-12-10',
                acceptedDate: '2024-12-12'
            },
            {
                id: 'r4',
                jobNumber: '17230',
                type: 'Service Call',
                county: 'Rutherford Co',
                school: 'Siegel HS',
                state: 'TN',
                details: 'Service call - Bleacher will not retract, possible motor issue. Customer says it makes grinding noise.',
                laborAmount: 650,
                partsLocation: '',
                estimateDate: '2024-12-28',
                acceptedDate: '2024-12-30'
            },
            {
                id: 'r5',
                jobNumber: '17235',
                type: 'Repair',
                county: 'Sumner Co',
                school: 'Hendersonville HS',
                state: 'TN',
                details: 'FACING LOGO: Labor to install flex row roller bracket with hardware and nose cap. BEHIND LOGO: Labor to replace pendant clasp and install tier catch hardware.',
                laborAmount: 1875,
                partsLocation: 'TN Shop. Picked up by Rick 1.2.25',
                estimateDate: '2024-12-05',
                acceptedDate: '2024-12-08'
            },
            {
                id: 'r6',
                jobNumber: '17240',
                type: 'Go See',
                county: 'Warren Co',
                school: 'Warren Co HS',
                state: 'KY',
                details: 'Go-see, customer reporting bleacher alignment issues and squeaking during operation',
                laborAmount: 350,
                partsLocation: '',
                estimateDate: '2025-01-02',
                acceptedDate: '2025-01-03'
            }
        ];

        // Southern territory backlog
        let backlogSouthern = [
            {
                id: 'rs1',
                jobNumber: 'AL515920',
                type: 'Repair',
                county: 'Houston Co',
                school: 'Houston Co HS',
                state: 'AL',
                details: 'MAIN GYM: Labor to replace 2 motors and install safety skid tape (12). AUX: Labor to install pendant clasp and tier catch hardware.',
                laborAmount: 3200,
                partsLocation: 'FL Shop',
                estimateDate: '2025-11-15',
                acceptedDate: '2025-11-20'
            },
            {
                id: 'rs2',
                jobNumber: 'AL515925',
                type: 'Inspection',
                county: 'Baldwin Co',
                school: 'Baldwin Co Schools - Multiple',
                state: 'AL',
                details: 'Indoor Bleacher Inspections: Baldwin Co HS, Robertsdale HS, Foley HS (Main & Aux), Daphne HS, Spanish Fort HS',
                laborAmount: 5600,
                partsLocation: '',
                estimateDate: '2025-11-20',
                acceptedDate: '2025-11-22'
            },
            {
                id: 'rs3',
                jobNumber: 'AL515930',
                type: 'Service Call',
                county: 'Escambia Co',
                school: 'Escambia Co HS',
                state: 'AL',
                details: 'Service call - Bleacher binding up during retraction, customer reports loud pop noise',
                laborAmount: 450,
                partsLocation: '',
                estimateDate: '2025-12-01',
                acceptedDate: '2025-12-02'
            }
        ];

        // Shit List - Pink Jobs (incomplete/return visits)
        let shitListJobs = [
            {
                id: 'sl1',
                jobNumber: '17180',
                type: 'Repair',
                county: 'Coffee Co',
                school: 'Spencer ES',
                state: 'TN',
                details: 'Labor to replace wall pads. **Truck to arrive 9:30am, Removal of exiting pads and dumpster for dunnage is customer responsibility**',
                reason: 'Wrong Part',
                reasonDetails: 'Wrong size wall pads shipped - need to reorder correct dimensions',
                tech: 'Chris & Owen',
                originalDate: '2025-01-20',
                laborAmount: 1200,
                partsLocation: 'School',
                measurements: '8ft x 6ft panels, 2" thick'
            },
            {
                id: 'sl2',
                jobNumber: '17195',
                type: 'Repair',
                county: 'Rutherford Co',
                school: 'Riverdale HS',
                state: 'TN',
                details: 'MAIN GYM: Labor to replace motor/gearmotor and install new pendant control',
                reason: 'Wrong Part',
                reasonDetails: 'Motor sent was 1/2 HP, needs 3/4 HP motor for this bank size',
                tech: 'Floyd',
                originalDate: '2025-01-22',
                laborAmount: 1850,
                partsLocation: 'TN Shop',
                measurements: ''
            },
            {
                id: 'sl3',
                jobNumber: '17202',
                type: 'Service Call',
                county: 'Wilson Co',
                school: 'Mt Juliet HS',
                state: 'TN',
                details: 'Service call - Bleacher making grinding noise, discovered additional frame damage during visit',
                reason: 'Additional Work',
                reasonDetails: 'Found 3 additional damaged frames that need replacement. New estimate needed.',
                tech: 'Sam',
                originalDate: '2025-01-25',
                laborAmount: 650,
                partsLocation: '',
                measurements: ''
            },
            {
                id: 'sl4',
                jobNumber: '17210',
                type: 'Repair',
                county: 'Sumner Co',
                school: 'Gallatin HS',
                state: 'TN',
                details: 'BEHIND LOGO: Labor to install flex row handles and replace gear motor',
                reason: "Can't Access",
                reasonDetails: 'Gym was being used for basketball tournament, could not get access. Need to reschedule after Feb 15.',
                tech: 'Alex W & Michael',
                originalDate: '2025-01-28',
                laborAmount: 2100,
                partsLocation: 'TN Shop',
                measurements: ''
            }
        ];

        let shitListSouthern = [
            {
                id: 'sls1',
                jobNumber: 'AL515910',
                type: 'Repair',
                county: 'Lee Co',
                school: 'Beauregard HS',
                state: 'AL',
                details: 'MAIN GYM: Labor to replace 2 tier catches and install safety skid tape',
                reason: 'Equipment Issue',
                reasonDetails: 'Lift broke down on site. Need to bring replacement lift.',
                tech: 'Jon',
                originalDate: '2025-01-15',
                laborAmount: 1450,
                partsLocation: 'FL Shop',
                measurements: ''
            }
        ];

        // Get active backlog based on territory
        function getActiveBacklog() {
            return currentTerritory === 'original' ? readyToScheduleJobs : backlogSouthern;
        }

        // Get week start date (Monday)
        function getWeekStart(offset = 0) {
            const today = new Date();
            const dayOfWeek = today.getDay();
            const diff = today.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1) + (offset * 7);
            const monday = new Date(today.setDate(diff));
            monday.setHours(0, 0, 0, 0);
            return monday;
        }

        // Format date as YYYY-MM-DD
        function formatDateKey(date) {
            return date.toISOString().split('T')[0];
        }

        // Format date for display
        function formatDateDisplay(date) {
            const options = { weekday: 'short', month: 'numeric', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }

        // Get week label
        function getWeekLabel(offset = 0) {
            const weekStart = getWeekStart(offset);
            const options = { month: 'short', day: 'numeric', year: 'numeric' };
            return `Week of ${weekStart.toLocaleDateString('en-US', options)}`;
        }

        // Load schedule view
        function loadSchedule() {
            initializeSampleScheduleData();
            // Set offset to show the week containing sample data
            const sampleDate = new Date('2025-02-03');
            const currentMonday = getWeekStart(0);
            scheduleWeekOffset = Math.round((sampleDate - currentMonday) / (7 * 24 * 60 * 60 * 1000));
            updateWeekLabel();
            renderWeeklySchedule();
            loadBacklog();
            loadShitList();
            populateTechDropdowns();
            // Re-show the active tab (showView hides all elements ending with "View")
            switchScheduleTab(currentScheduleTab);
        }

        // Switch territory (Office view)
        function switchTerritory(territory) {
            currentTerritory = territory;
            scheduleData = territory === 'original' ? scheduleDataOriginal : scheduleDataSouthern;

            // Update territory tab styles
            document.getElementById('officeOriginalTab').classList.toggle('active', territory === 'original');
            document.getElementById('officeSouthernTab').classList.toggle('active', territory === 'southern');

            renderWeeklySchedule();
            loadBacklog();
            loadShitList();
        }

        // Update week label
        function updateWeekLabel() {
            document.getElementById('scheduleWeekLabel').textContent = getWeekLabel(scheduleWeekOffset);
        }

        // Navigate weeks
        function previousWeek() {
            scheduleWeekOffset--;
            updateWeekLabel();
            renderWeeklySchedule();
        }

        function nextWeek() {
            scheduleWeekOffset++;
            updateWeekLabel();
            renderWeeklySchedule();
        }

        // Switch schedule tabs
        function switchScheduleTab(tab) {
            currentScheduleTab = tab;

            // Update tab styles - only the sub-tabs, not territory tabs
            document.getElementById('thisWeekTab').classList.remove('active');
            document.getElementById('planningTab').classList.remove('active');
            document.getElementById('backlogTab').classList.remove('active');
            document.getElementById('shitListTab').classList.remove('active');
            document.getElementById(tab + 'Tab').classList.add('active');

            // Show/hide views
            document.getElementById('thisWeekView').classList.add('hidden');
            document.getElementById('planningView').classList.add('hidden');
            document.getElementById('backlogView').classList.add('hidden');
            document.getElementById('shitListView').classList.add('hidden');

            if (tab === 'thisWeek') {
                document.getElementById('thisWeekView').classList.remove('hidden');
            } else if (tab === 'planning') {
                document.getElementById('planningView').classList.remove('hidden');
                renderPlanningSchedule();
            } else if (tab === 'backlog') {
                document.getElementById('backlogView').classList.remove('hidden');
                loadBacklog();
            } else if (tab === 'shitList') {
                document.getElementById('shitListView').classList.remove('hidden');
                loadShitList();
            }
        }

        // Render weekly schedule grid (table-based layout)
        function renderWeeklySchedule() {
            const container = document.getElementById('weeklyScheduleGrid');
            const weekStart = getWeekStart(scheduleWeekOffset);
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            let html = '<table class="schedule-table">';
            html += '<thead><tr><th class="col-school">School / Location</th><th>Job Details</th><th class="col-tech">Tech(s)</th><th class="col-parts">Parts</th></tr></thead>';
            html += '<tbody>';

            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];

            for (let i = 0; i < 5; i++) {
                const dayDate = new Date(weekStart);
                dayDate.setDate(weekStart.getDate() + i);
                const dateKey = formatDateKey(dayDate);
                const isToday = dayDate.getTime() === today.getTime();
                const dayJobs = scheduleData[dateKey] || [];
                const dayLabel = days[i] + ' ' + (dayDate.getMonth() + 1) + '/' + dayDate.getDate();

                html += '<tr class="schedule-day-row ' + (isToday ? 'schedule-today-row' : '') + '">';
                html += '<td colspan="4">' + dayLabel + '</td>';
                html += '</tr>';

                if (dayJobs.length === 0) {
                    if (i === 4) {
                        html += '<tr><td colspan="4" style="padding: 14px; text-align: center; color: #adb5bd; font-style: italic;">Floating day</td></tr>';
                    } else {
                        html += '<tr><td colspan="4" style="padding: 14px; text-align: center; color: #adb5bd;">No jobs scheduled</td></tr>';
                    }
                } else {
                    dayJobs.forEach(function(job) {
                        var isNote = job.type === 'note';
                        var isContinued = job.type === 'continued';
                        var isPink = job.isPink === true;

                        var formattedDetails = job.details || '';
                        formattedDetails = formattedDetails.replace(/\*([^*]+)\*/g, '<span style="color: #bf360c; font-weight: 600; background: #fff3e0; padding: 1px 5px; border-radius: 3px;">$1</span>');

                        if (isNote) {
                            html += '<tr class="schedule-note-row">';
                            html += '<td colspan="4">' + formattedDetails + (job.tech ? ' &mdash; ' + job.tech : '') + '</td>';
                            html += '</tr>';
                        } else {
                            var rowClass = '';
                            if (isPink) rowClass = 'schedule-pink-row';
                            else if (isContinued) rowClass = 'schedule-continued-row';

                            html += '<tr class="' + rowClass + '">';
                            html += '<td style="font-weight: 600;">' + job.school + '</td>';
                            html += '<td>' + (isContinued ? '<em style="color: #1565c0;">Continued</em>' : formattedDetails) + '</td>';
                            html += '<td>' + (job.tech || '') + '</td>';
                            html += '<td style="color: #e65100; font-weight: 500;">' + (job.partsLocation || '') + '</td>';
                            html += '</tr>';
                        }
                    });
                }
            }

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // Render planning schedule (table-based layout, editable)
        function renderPlanningSchedule() {
            const container = document.getElementById('planningScheduleGrid');
            // Use next week for planning
            const weekStart = getWeekStart(scheduleWeekOffset + 1);

            let html = '<div style="margin-bottom: 16px; padding: 12px; background: #e8f5e9; border-radius: 8px;">';
            html += '<strong>Planning for: Week of ' + weekStart.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) + '</strong>';
            html += '</div>';

            html += '<table class="schedule-table">';
            html += '<thead><tr><th class="col-school">School/Location</th><th>Job Details</th><th class="col-tech">Tech(s)</th><th class="col-parts">Parts</th></tr></thead>';
            html += '<tbody>';

            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];

            for (let i = 0; i < 5; i++) {
                const dayDate = new Date(weekStart);
                dayDate.setDate(weekStart.getDate() + i);
                const dayLabel = days[i] + ' ' + (dayDate.getMonth() + 1) + '/' + dayDate.getDate();

                html += '<tr class="schedule-day-row">';
                html += '<td colspan="3">' + dayLabel + '</td>';
                html += '<td style="text-align: right; background: inherit;"><button class="btn btn-sm" style="padding: 2px 10px; font-size: 11px;" onclick="addJobToDay(\'' + formatDateKey(dayDate) + '\')">+ Add</button></td>';
                html += '</tr>';
                html += '<tr><td colspan="4" style="padding: 12px; text-align: center; color: #adb5bd; font-size: 12px;">Drag jobs here or click + Add</td></tr>';
            }

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // Load backlog
        function loadBacklog() {
            const container = document.getElementById('readyJobsList');
            const activeBacklog = getActiveBacklog();

            // Update stats
            const partsReceivedCount = activeBacklog.filter(j => j.partsLocation).length;
            const inspectionsCount = activeBacklog.filter(j => j.type === 'Inspection').length;
            const totalLabor = activeBacklog.reduce((sum, j) => sum + j.laborAmount, 0);

            document.getElementById('readyPartsReceived').textContent = partsReceivedCount;
            document.getElementById('readyInspectionsOnly').textContent = inspectionsCount;
            document.getElementById('readyTotalLabor').textContent = '$' + totalLabor.toLocaleString();
            document.getElementById('backlogCount').textContent = activeBacklog.length;

            // Populate county filter
            const counties = [...new Set(activeBacklog.map(j => j.county))].sort();
            const countyFilter = document.getElementById('readyFilterCounty');
            countyFilter.innerHTML = '<option value="">All Counties</option>' +
                counties.map(c => `<option value="${c}">${c}</option>`).join('');

            // Render jobs
            if (activeBacklog.length === 0) {
                container.innerHTML = '<div style="padding: 40px; text-align: center; color: #6c757d;">No jobs in backlog</div>';
                return;
            }

            let html = '';
            activeBacklog.forEach(job => {
                html += `
                    <div class="ready-job-item" onclick="addJobToSchedule('${job.id}')">
                        <div style="flex: 1;">
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                                <span class="part-number" style="color: #0066cc;">${job.jobNumber}</span>
                                <span class="badge ${job.type === 'Repair' ? 'badge-warning' : job.type === 'Inspection' ? 'badge-info' : 'badge-secondary'}">${job.type}</span>
                                ${job.partsLocation ? '<span class="badge badge-success">Parts Ready</span>' : ''}
                            </div>
                            <div style="font-weight: 600; margin-bottom: 4px;">${job.school}, ${job.state}</div>
                            <div style="font-size: 12px; color: #6c757d; margin-bottom: 6px;">${job.county}</div>
                            <div style="font-size: 13px; color: #495057; line-height: 1.4;">${truncateText(job.details, 150)}</div>
                            ${job.partsLocation ? `<div style="margin-top: 8px; font-size: 12px; color: #e65100;"><strong>Parts:</strong> ${job.partsLocation}</div>` : ''}
                        </div>
                        <div style="text-align: right; min-width: 100px;">
                            <div style="font-weight: 600; font-size: 16px; color: #2e7d32;">$${job.laborAmount.toLocaleString()}</div>
                            <div style="font-size: 11px; color: #6c757d; margin-top: 4px;">Accepted ${new Date(job.acceptedDate).toLocaleDateString()}</div>
                            <button class="btn btn-sm btn-primary" style="margin-top: 12px;" onclick="event.stopPropagation(); addJobToSchedule('${job.id}')">Add to Schedule</button>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Filter ready jobs
        function filterReadyJobs() {
            const countyFilter = document.getElementById('readyFilterCounty').value;
            const typeFilter = document.getElementById('readyFilterType').value;

            // For now just reload - in production would filter the list
            loadReadyPool();
        }

        // Populate tech dropdowns
        function populateTechDropdowns() {
            const techSelect = document.getElementById('entryTech');
            const jobSelect = document.getElementById('entryJobSelect');

            techSelect.innerHTML = '<option value="">-- Select tech(s) --</option>' +
                TECHS.map(t => `<option value="${t}">${t}</option>`).join('');

            jobSelect.innerHTML = '<option value="">-- Select a job --</option>' +
                getActiveBacklog().map(j => `<option value="${j.id}">${j.jobNumber} - ${j.school} (${j.type})</option>`).join('');
        }

        // Add Entry Modal
        function openAddEntryModal() {
            document.getElementById('addEntryModal').classList.remove('hidden');
            populateTechDropdowns();
        }

        function closeAddEntryModal() {
            document.getElementById('addEntryModal').classList.add('hidden');
        }

        function toggleEntryFields() {
            const entryType = document.getElementById('entryType').value;
            document.getElementById('jobEntryFields').classList.add('hidden');
            document.getElementById('noteEntryFields').classList.add('hidden');
            document.getElementById('customEntryFields').classList.add('hidden');

            if (entryType === 'job') {
                document.getElementById('jobEntryFields').classList.remove('hidden');
            } else if (entryType === 'note') {
                document.getElementById('noteEntryFields').classList.remove('hidden');
            } else if (entryType === 'custom') {
                document.getElementById('customEntryFields').classList.remove('hidden');
            }
        }

        function saveScheduleEntry() {
            const entryType = document.getElementById('entryType').value;
            const day = document.getElementById('entryDay').value;
            const tech = document.getElementById('entryTech').value;
            const partsLocation = document.getElementById('entryPartsLocation').value;
            const confirmation = document.getElementById('entryConfirmation').value;
            const notes = document.getElementById('entryNotes').value;

            // Get the date key for the selected day
            const weekStart = getWeekStart(scheduleWeekOffset);
            const dayIndex = ['mon', 'tue', 'wed', 'thu', 'fri'].indexOf(day);
            const targetDate = new Date(weekStart);
            targetDate.setDate(weekStart.getDate() + dayIndex);
            const dateKey = formatDateKey(targetDate);

            let newEntry = {
                id: 's' + Date.now(),
                tech: tech,
                partsLocation: partsLocation,
                confirmation: confirmation,
                notes: notes
            };

            if (entryType === 'job') {
                const jobId = document.getElementById('entryJobSelect').value;
                const job = getActiveBacklog().find(j => j.id === jobId);
                if (job) {
                    newEntry.type = 'job';
                    newEntry.school = job.school + ', ' + job.county + ', ' + job.state;
                    newEntry.details = job.details;
                    newEntry.estimateNumber = job.jobNumber;
                }
            } else if (entryType === 'note') {
                newEntry.type = 'note';
                newEntry.school = '';
                newEntry.details = document.getElementById('entryNote').value;
            } else if (entryType === 'custom') {
                newEntry.type = 'job';
                newEntry.school = document.getElementById('entrySchool').value;
                newEntry.details = document.getElementById('entryDescription').value;
            }

            // Add to schedule data
            if (!scheduleData[dateKey]) {
                scheduleData[dateKey] = [];
            }
            scheduleData[dateKey].push(newEntry);

            // Refresh view
            renderWeeklySchedule();
            closeAddEntryModal();

            alert('Entry added to schedule!');
        }

        function addJobToSchedule(jobId) {
            const job = getActiveBacklog().find(j => j.id === jobId);
            if (job) {
                document.getElementById('entryType').value = 'job';
                toggleEntryFields();
                openAddEntryModal();
                document.getElementById('entryJobSelect').value = jobId;
                document.getElementById('entryPartsLocation').value = job.partsLocation || '';
            }
        }

        function addJobToDay(dateKey) {
            // Open modal pre-set for that day
            openAddEntryModal();
            // Would need to set the day dropdown based on dateKey
        }

        function publishSchedule() {
            if (confirm('Publish this schedule and move it to This Week view?')) {
                alert('Schedule published! (In production this would save and notify the team)');
                switchScheduleTab('thisWeek');
            }
        }

        // Load Shit List
        function loadShitList() {
            const container = document.getElementById('shitListJobsList');
            if (!container) return;
            const activeList = currentTerritory === 'original' ? shitListJobs : shitListSouthern;

            // Update stats
            const total = activeList.length;
            const wrongPart = activeList.filter(function(j) { return j.reason === 'Wrong Part'; }).length;
            const other = total - wrongPart;

            document.getElementById('shitListTotal').textContent = total;
            document.getElementById('shitListWrongPart').textContent = wrongPart;
            document.getElementById('shitListOther').textContent = other;
            document.getElementById('shitListCount').textContent = total;

            if (activeList.length === 0) {
                container.innerHTML = '<div style="padding: 40px; text-align: center; color: #6c757d;">No pink jobs - nice work!</div>';
                return;
            }

            var html = '';
            activeList.forEach(function(job) {
                var reasonColors = {
                    'Wrong Part': { bg: '#fff3e0', color: '#e65100', icon: '&#x1F527;' },
                    "Can't Access": { bg: '#e3f2fd', color: '#1565c0', icon: '&#x1F6AA;' },
                    'Additional Work': { bg: '#fff3e0', color: '#e65100', icon: '&#x26A0;' },
                    'Equipment Issue': { bg: '#fce4ec', color: '#c62828', icon: '&#x1F3D7;' },
                    'Other': { bg: '#f5f5f5', color: '#616161', icon: '&#x1F4DD;' }
                };
                var rc = reasonColors[job.reason] || reasonColors['Other'];

                html += '<div style="display: flex; justify-content: space-between; align-items: flex-start; padding: 16px; border-bottom: 1px solid #f0f0f0; border-left: 4px solid #c62828;">';
                html += '<div style="flex: 1;">';
                html += '<div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px; flex-wrap: wrap;">';
                html += '<span class="part-number" style="color: #c62828; font-weight: 700;">#' + job.jobNumber + '</span>';
                html += '<span class="badge" style="background: ' + rc.bg + '; color: ' + rc.color + ';">' + rc.icon + ' ' + job.reason + '</span>';
                html += '<span class="badge badge-secondary">' + job.type + '</span>';
                html += '</div>';
                html += '<div style="font-weight: 600; margin-bottom: 4px;">' + job.school + ', ' + job.county + ', ' + job.state + '</div>';
                html += '<div style="font-size: 13px; color: #495057; line-height: 1.4; margin-bottom: 8px;">' + job.details + '</div>';
                html += '<div style="font-size: 13px; color: #c62828; background: #fff0f0; padding: 8px 12px; border-radius: 6px; margin-bottom: 8px;">';
                html += '<strong>Why:</strong> ' + job.reasonDetails;
                html += '</div>';
                html += '<div style="display: flex; gap: 16px; font-size: 12px; color: #6c757d; flex-wrap: wrap;">';
                html += '<span><strong>Tech:</strong> ' + job.tech + '</span>';
                html += '<span><strong>Original Date:</strong> ' + new Date(job.originalDate).toLocaleDateString() + '</span>';
                if (job.measurements) {
                    html += '<span><strong>Measurements:</strong> ' + job.measurements + '</span>';
                }
                if (job.partsLocation) {
                    html += '<span style="color: #e65100;"><strong>Parts:</strong> ' + job.partsLocation + '</span>';
                }
                html += '</div>';
                html += '</div>';
                html += '<div style="text-align: right; min-width: 100px;">';
                html += '<div style="font-weight: 600; font-size: 16px; color: #c62828;">$' + job.laborAmount.toLocaleString() + '</div>';
                html += '<button class="btn btn-sm btn-primary" style="margin-top: 12px;" onclick="event.stopPropagation(); addJobToSchedule(\'' + job.id + '\')">Reschedule</button>';
                html += '</div>';
                html += '</div>';
            });

            container.innerHTML = html;
        }

        function filterShitList() {
            // For now just reload
            loadShitList();
        }

        // Truncate text helper
        function truncateText(text, maxLength) {
            if (!text) return '';
            if (text.length <= maxLength) return text;
            return text.substring(0, maxLength) + '...';
        }

        // ==========================================
        // FIELD STAFF SEARCH
        // ==========================================

        function performTechSearch() {
            const query = document.getElementById('techSearchInput').value.trim().toLowerCase();
            const container = document.getElementById('techSearchResults');

            if (!query || query.length < 2) {
                container.innerHTML = '<div style="text-align: center; padding: 60px 20px; color: #6c757d;"><div style="font-size: 48px; margin-bottom: 16px;">üîç</div><p style="font-size: 15px;">Search for a school, job number, or keyword to find work orders and inspections.</p></div>';
                return;
            }

            let results = [];

            // Search work orders
            Object.keys(TECH_WORK_ORDERS || {}).forEach(function(key) {
                const wo = TECH_WORK_ORDERS[key];
                const searchText = (wo.jobNumber + ' ' + wo.locationName + ' ' + (wo.description || '') + ' ' + (wo.address || '')).toLowerCase();
                if (searchText.includes(query)) {
                    results.push({ type: 'workorder', key: key, data: wo });
                }
            });

            // Search inspection jobs
            (window.inspectionJobs || []).forEach(function(job) {
                const searchText = (job.jobNumber + ' ' + (job.customerName || '') + ' ' + (job.locationName || '') + ' ' + job.status).toLowerCase();
                if (searchText.includes(query)) {
                    results.push({ type: 'inspection', data: job });
                }
            });

            // Search schedule data for school names
            var allScheduleData = Object.assign({}, scheduleDataOriginal, scheduleDataSouthern);
            Object.keys(allScheduleData).forEach(function(dateKey) {
                (allScheduleData[dateKey] || []).forEach(function(entry) {
                    if (entry.type === 'note') return;
                    var searchText = ((entry.school || '') + ' ' + (entry.details || '')).toLowerCase();
                    if (searchText.includes(query)) {
                        results.push({ type: 'schedule', date: dateKey, data: entry });
                    }
                });
            });

            if (results.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px 20px; color: #6c757d;"><p>No results found for "' + query + '"</p></div>';
                return;
            }

            var html = '<div style="font-size: 13px; color: #6c757d; margin-bottom: 12px;">' + results.length + ' result' + (results.length !== 1 ? 's' : '') + '</div>';

            results.forEach(function(r) {
                if (r.type === 'workorder') {
                    html += '<div class="card" style="margin-bottom: 8px; cursor: pointer;" onclick="showTechView(\'workorderdetail\'); openTechWorkOrder(\'' + r.key + '\')">';
                    html += '<div class="card-body" style="padding: 12px 16px;">';
                    html += '<div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">';
                    html += '<span class="badge badge-info">Work Order</span>';
                    html += '<span style="font-weight: 600;">#' + r.data.jobNumber + '</span>';
                    html += '<span class="badge badge-secondary">' + (r.data.jobType || '') + '</span>';
                    html += '</div>';
                    html += '<div style="font-weight: 500;">' + r.data.locationName + '</div>';
                    html += '<div style="font-size: 12px; color: #6c757d;">' + (r.data.address || '') + '</div>';
                    html += '</div></div>';
                } else if (r.type === 'inspection') {
                    html += '<div class="card" style="margin-bottom: 8px; cursor: pointer;" onclick="showTechView(\'inspections\')">';
                    html += '<div class="card-body" style="padding: 12px 16px;">';
                    html += '<div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">';
                    html += '<span class="badge" style="background: #e8f5e9; color: #2e7d32;">Inspection</span>';
                    html += '<span style="font-weight: 600;">#' + r.data.jobNumber + '</span>';
                    html += '<span class="badge badge-secondary">' + r.data.status + '</span>';
                    html += '</div>';
                    html += '<div style="font-weight: 500;">' + (r.data.customerName || '') + '</div>';
                    html += '<div style="font-size: 12px; color: #6c757d;">' + (r.data.locationName || '') + '</div>';
                    html += '</div></div>';
                } else if (r.type === 'schedule') {
                    var d = new Date(r.date + 'T12:00:00');
                    var dateStr = d.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
                    html += '<div class="card" style="margin-bottom: 8px;">';
                    html += '<div class="card-body" style="padding: 12px 16px;">';
                    html += '<div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">';
                    html += '<span class="badge" style="background: #e3f2fd; color: #1565c0;">Scheduled</span>';
                    html += '<span style="font-size: 12px; color: #6c757d;">' + dateStr + '</span>';
                    html += '</div>';
                    html += '<div style="font-weight: 500;">' + (r.data.school || '') + '</div>';
                    html += '<div style="font-size: 12px; color: #495057; line-height: 1.4; margin-top: 4px;">' + (r.data.details || '').substring(0, 150) + (r.data.details && r.data.details.length > 150 ? '...' : '') + '</div>';
                    if (r.data.tech) html += '<div style="font-size: 12px; color: #6c757d; margin-top: 4px;">Tech: ' + r.data.tech + '</div>';
                    html += '</div></div>';
                }
            });

            container.innerHTML = html;
        }

        // ==========================================
        // OFFICE SEARCH
        // ==========================================

        function performOfficeSearch() {
            var query = document.getElementById('officeSearchInput').value.trim().toLowerCase();
            var container = document.getElementById('officeSearchResults');

            if (!query || query.length < 2) {
                container.innerHTML = '<div style="text-align: center; padding: 60px 20px; color: #6c757d;"><div style="font-size: 48px; margin-bottom: 16px;">üîç</div><p style="font-size: 15px;">Search for a school, job number, or keyword to find work orders, inspections, and scheduled jobs.</p></div>';
                return;
            }

            var results = [];

            // Search office work orders
            Object.keys(OFFICE_WORK_ORDERS || {}).forEach(function(key) {
                var wo = OFFICE_WORK_ORDERS[key];
                var searchText = (wo.jobNumber + ' ' + wo.locationName + ' ' + (wo.description || '') + ' ' + (wo.address || '') + ' ' + (wo.assignedTo || '')).toLowerCase();
                if (searchText.includes(query)) {
                    results.push({ type: 'workorder', key: key, data: wo });
                }
            });

            // Search field work orders too
            Object.keys(TECH_WORK_ORDERS || {}).forEach(function(key) {
                var wo = TECH_WORK_ORDERS[key];
                // Avoid duplicates (same job number already found in office WOs)
                var isDup = results.some(function(r) { return r.type === 'workorder' && r.data.jobNumber === wo.jobNumber; });
                if (isDup) return;
                var searchText = (wo.jobNumber + ' ' + wo.locationName + ' ' + (wo.description || '') + ' ' + (wo.address || '')).toLowerCase();
                if (searchText.includes(query)) {
                    results.push({ type: 'workorder', key: key, data: wo });
                }
            });

            // Search inspection jobs
            (window.inspectionJobs || []).forEach(function(job) {
                var searchText = (job.jobNumber + ' ' + (job.customerName || '') + ' ' + (job.locationName || '') + ' ' + job.status).toLowerCase();
                if (searchText.includes(query)) {
                    results.push({ type: 'inspection', data: job });
                }
            });

            // Search schedule data
            var allScheduleData = Object.assign({}, scheduleDataOriginal, scheduleDataSouthern);
            Object.keys(allScheduleData).forEach(function(dateKey) {
                (allScheduleData[dateKey] || []).forEach(function(entry) {
                    if (entry.type === 'note') return;
                    var searchText = ((entry.school || '') + ' ' + (entry.details || '') + ' ' + (entry.tech || '')).toLowerCase();
                    if (searchText.includes(query)) {
                        results.push({ type: 'schedule', date: dateKey, data: entry });
                    }
                });
            });

            if (results.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px 20px; color: #6c757d;"><p>No results found for "' + query + '"</p></div>';
                return;
            }

            var html = '<div style="font-size: 13px; color: #6c757d; margin-bottom: 12px;">' + results.length + ' result' + (results.length !== 1 ? 's' : '') + '</div>';

            results.forEach(function(r) {
                if (r.type === 'workorder') {
                    html += '<div class="card" style="margin-bottom: 8px; cursor: pointer;" onclick="viewWorkOrderDetail(\'' + r.key + '\')">';
                    html += '<div class="card-body" style="padding: 12px 16px;">';
                    html += '<div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">';
                    html += '<span class="badge badge-info">Work Order</span>';
                    html += '<span style="font-weight: 600;">#' + r.data.jobNumber + '</span>';
                    html += '<span class="badge badge-secondary">' + (r.data.jobType || '') + '</span>';
                    if (r.data.status === 'Pink') html += '<span class="badge badge-danger">Pink</span>';
                    html += '</div>';
                    html += '<div style="font-weight: 500;">' + r.data.locationName + '</div>';
                    html += '<div style="font-size: 12px; color: #6c757d;">' + (r.data.address || '') + '</div>';
                    if (r.data.assignedTo) html += '<div style="font-size: 12px; color: #6c757d; margin-top: 4px;">Assigned: ' + r.data.assignedTo + '</div>';
                    html += '</div></div>';
                } else if (r.type === 'inspection') {
                    html += '<div class="card" style="margin-bottom: 8px; cursor: pointer;" onclick="showView(\'inspections\')">';
                    html += '<div class="card-body" style="padding: 12px 16px;">';
                    html += '<div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">';
                    html += '<span class="badge" style="background: #e8f5e9; color: #2e7d32;">Inspection</span>';
                    html += '<span style="font-weight: 600;">#' + r.data.jobNumber + '</span>';
                    html += '<span class="badge badge-secondary">' + r.data.status + '</span>';
                    html += '</div>';
                    html += '<div style="font-weight: 500;">' + (r.data.customerName || '') + '</div>';
                    html += '<div style="font-size: 12px; color: #6c757d;">' + (r.data.locationName || '') + '</div>';
                    html += '</div></div>';
                } else if (r.type === 'schedule') {
                    var d = new Date(r.date + 'T12:00:00');
                    var dateStr = d.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
                    html += '<div class="card" style="margin-bottom: 8px; cursor: pointer;" onclick="showView(\'scheduling\')">';
                    html += '<div class="card-body" style="padding: 12px 16px;">';
                    html += '<div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">';
                    html += '<span class="badge" style="background: #e3f2fd; color: #1565c0;">Scheduled</span>';
                    html += '<span style="font-size: 12px; color: #6c757d;">' + dateStr + '</span>';
                    html += '</div>';
                    html += '<div style="font-weight: 500;">' + (r.data.school || '') + '</div>';
                    html += '<div style="font-size: 12px; color: #495057; line-height: 1.4; margin-top: 4px;">' + (r.data.details || '').substring(0, 150) + (r.data.details && r.data.details.length > 150 ? '...' : '') + '</div>';
                    if (r.data.tech) html += '<div style="font-size: 12px; color: #6c757d; margin-top: 4px;">Tech: ' + r.data.tech + '</div>';
                    html += '</div></div>';
                }
            });

            container.innerHTML = html;
        }

        // ==========================================
        // OFFICE CREATE FORM
        // ==========================================

        var officeCreatePhoto = null;

        function initOfficeCreateForm() {
            var select = document.getElementById('officeCreateCustomerSelect');
            var html = '<option value="">Select a customer...</option>';
            CUSTOMERS.forEach(function(cust) {
                cust.locations.forEach(function(loc) {
                    html += '<option value="' + loc.id + '" data-customer-id="' + cust.id + '" data-customer-name="' + cust.name + '" data-location-name="' + loc.name + '" data-location-address="' + loc.address + '" data-contact="' + (loc.contact || '') + '" data-phone="' + (loc.phone || '') + '">  ' + loc.name + ' (' + cust.name + ')</option>';
                });
            });
            select.innerHTML = html;

            // Reset all fields
            document.getElementById('officeCreateTypeSelect').value = '';
            document.getElementById('officeCreateCustomerSelect').value = '';
            document.getElementById('officeCreateCustomerInfo').classList.add('hidden');
            document.getElementById('officeCreateFormFields').classList.add('hidden');
            document.getElementById('officeCreateSubmitBtn').classList.add('hidden');
            document.getElementById('officeCreateInspectionFields').classList.add('hidden');
            document.getElementById('officeCreateWorkOrderFields').classList.add('hidden');
            document.getElementById('officeCreateDescriptionGroup').classList.add('hidden');
            document.getElementById('officeCreatePhotoGroup').classList.add('hidden');
            document.getElementById('officeCreateNotes').value = '';
            var descEl = document.getElementById('officeCreateDescription');
            if (descEl) descEl.value = '';
            document.getElementById('officeCreatePhotoPreview').innerHTML = '';
            officeCreatePhoto = null;
        }

        function onOfficeCreateTypeChange() {
            var type = document.getElementById('officeCreateTypeSelect').value;
            if (!type) {
                document.getElementById('officeCreateFormFields').classList.add('hidden');
                document.getElementById('officeCreateSubmitBtn').classList.add('hidden');
                return;
            }

            document.getElementById('officeCreateFormFields').classList.remove('hidden');
            document.getElementById('officeCreateSubmitBtn').classList.remove('hidden');

            // Hide all type-specific fields first
            document.getElementById('officeCreateInspectionFields').classList.add('hidden');
            document.getElementById('officeCreateWorkOrderFields').classList.add('hidden');
            document.getElementById('officeCreateDescriptionGroup').classList.add('hidden');
            document.getElementById('officeCreatePhotoGroup').classList.add('hidden');

            var btn = document.getElementById('officeCreateSubmitBtn');

            if (type === 'inspection') {
                document.getElementById('officeCreateInspectionFields').classList.remove('hidden');
                document.getElementById('officeCreateJobNumber').value = nextJobNumber;
                document.getElementById('officeCreateJobDate').value = new Date().toISOString().split('T')[0];
                btn.textContent = 'Create Inspection';
            } else if (type === 'work_order') {
                document.getElementById('officeCreateWorkOrderFields').classList.remove('hidden');
                document.getElementById('officeCreateDescriptionGroup').classList.remove('hidden');
                document.getElementById('officeCreatePhotoGroup').classList.remove('hidden');
                document.getElementById('officeCreateDescription').placeholder = 'What needs to be done...';
                btn.textContent = 'Create Work Order';
            } else if (type === 'parts_spec') {
                document.getElementById('officeCreateDescriptionGroup').classList.remove('hidden');
                document.getElementById('officeCreatePhotoGroup').classList.remove('hidden');
                document.getElementById('officeCreateDescription').placeholder = 'What parts are needed for...';
                btn.textContent = 'Create Parts Spec';
            }
        }

        function updateOfficeCreateCustomerInfo() {
            var select = document.getElementById('officeCreateCustomerSelect');
            var locId = select.value;
            var infoEl = document.getElementById('officeCreateCustomerInfo');
            if (!locId) { infoEl.classList.add('hidden'); return; }
            var option = select.options[select.selectedIndex];
            var address = option.dataset.locationAddress || '';
            var contact = option.dataset.contact || '';
            var phone = option.dataset.phone || '';
            document.getElementById('officeCreateAddress').textContent = address;
            document.getElementById('officeCreateContact').textContent = contact + (phone ? ' - ' + phone : '');
            infoEl.classList.remove('hidden');
        }

        function handleOfficeCreatePhoto(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    officeCreatePhoto = e.target.result;
                    document.getElementById('officeCreatePhotoPreview').innerHTML = '<img src="' + e.target.result + '" style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px;">';
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function submitOfficeCreate() {
            var type = document.getElementById('officeCreateTypeSelect').value;
            var select = document.getElementById('officeCreateCustomerSelect');
            var locId = select.value;

            if (!locId) { alert('Please select a customer.'); return; }

            var option = select.options[select.selectedIndex];
            var locationName = option.dataset.locationName || '';
            var customerName = option.dataset.customerName || '';
            var address = option.dataset.locationAddress || '';
            var customerId = option.dataset.customerId || '';

            if (type === 'inspection') {
                // Wire into existing inspection flow
                currentJob = {
                    jobNumber: nextJobNumber,
                    banks: [],
                    selectedParts: [],
                    status: 'in_progress',
                    createdAt: new Date().toISOString()
                };
                currentJob.customerId = customerId;
                currentJob.customerName = customerName;
                currentJob.locationId = locId;
                currentJob.locationName = locationName;
                currentJob.locationAddress = address;
                currentJob.inspectionType = document.getElementById('officeCreateInspectionType').value;
                currentJob.inspectionDate = document.getElementById('officeCreateJobDate').value;

                nextJobNumber++;
                localStorage.setItem('nextJobNumber', nextJobNumber);

                currentBankIndex = 0;
                currentJob.banks.push(createNewBank('East Side'));

                // For office, switch to tech dashboard to use bank inspection form
                document.getElementById('officeDashboard').classList.add('hidden');
                document.getElementById('techDashboard').classList.remove('hidden');
                showBankInspection();

            } else if (type === 'work_order') {
                var desc = document.getElementById('officeCreateDescription').value.trim();
                if (!desc) { alert('Please add a description.'); return; }

                var jobType = document.getElementById('officeCreateWoJobType').value;
                var notes = document.getElementById('officeCreateNotes').value.trim();

                var nextNum = parseInt(localStorage.getItem('nextJobNumber') || '17500');
                var jobNumber = '' + nextNum;
                localStorage.setItem('nextJobNumber', '' + (nextNum + 1));

                var key = 'wo_' + jobNumber;
                OFFICE_WORK_ORDERS[key] = {
                    jobNumber: jobNumber,
                    jobType: jobType,
                    status: 'Scheduled',
                    locationName: locationName,
                    address: address,
                    contactName: '',
                    contactPhone: '',
                    description: desc,
                    partsLocation: '',
                    specialInstructions: notes,
                    scheduledDate: '',
                    scheduledTime: '',
                    assignedTo: ''
                };

                alert('Work Order #' + jobNumber + ' created for ' + locationName);
                showView('officeCreate');

            } else if (type === 'parts_spec') {
                var desc = document.getElementById('officeCreateDescription').value.trim();
                if (!desc) { alert('Please add a description.'); return; }

                var nextNum = parseInt(localStorage.getItem('nextJobNumber') || '17500');
                var jobNumber = '' + nextNum;
                localStorage.setItem('nextJobNumber', '' + (nextNum + 1));

                alert('Parts Spec #' + jobNumber + ' created for ' + locationName);
                showView('officeCreate');
            }
        }

        // ==========================================
        // MY JOBS (Field Staff Personal Schedule)
        // ==========================================

        function loadMyJobs() {
            initializeSampleScheduleData();
            // Set offset to show sample data week
            const sampleDate = new Date('2025-02-03');
            const currentMonday = getWeekStart(0);
            myJobsWeekOffset = Math.round((sampleDate - currentMonday) / (7 * 24 * 60 * 60 * 1000));
            const label = document.getElementById('myJobsWeekLabel');
            label.textContent = getWeekLabel(myJobsWeekOffset);

            // Use original territory schedule data and filter for logged-in tech
            // For demo, show Danny's jobs from the sample data
            const currentTech = 'Danny';
            const weekStart = getWeekStart(myJobsWeekOffset);
            const container = document.getElementById('myJobsWeekGrid');
            const allData = scheduleDataOriginal;
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            let html = '';

            for (let i = 0; i < 5; i++) {
                const dayDate = new Date(weekStart);
                dayDate.setDate(weekStart.getDate() + i);
                const dateKey = formatDateKey(dayDate);
                const isToday = dayDate.getTime() === today.getTime();

                // Filter for this tech's jobs
                const allDayJobs = allData[dateKey] || [];
                const myDayJobs = allDayJobs.filter(j =>
                    j.tech && j.tech.toLowerCase().includes(currentTech.toLowerCase())
                );

                if (myDayJobs.length === 0) continue; // Skip empty days

                html += `
                    <div class="schedule-day">
                        <div class="schedule-day-header ${isToday ? 'today' : ''}">
                            <span>${days[i]} ${dayDate.getMonth() + 1}/${dayDate.getDate()}</span>
                            <span style="font-size: 12px; opacity: 0.8;">${myDayJobs.length} ${myDayJobs.length === 1 ? 'job' : 'jobs'}</span>
                        </div>
                        <div class="schedule-day-jobs">
                `;

                myDayJobs.forEach(job => {
                    const isNote = job.type === 'note';
                    const isContinued = job.type === 'continued';

                    if (isNote) {
                        html += `
                            <div style="padding: 12px 16px; background: #fffde7; display: flex; align-items: center; gap: 8px;">
                                <span style="color: #f9a825;">üìå</span>
                                <span style="color: #6c757d;">${job.details}</span>
                            </div>
                        `;
                    } else {
                        html += `
                            <div style="padding: 16px; border-bottom: 1px solid #f0f0f0; ${isContinued ? 'background: #f0f7ff;' : ''}">
                                <div style="font-weight: 600; font-size: 15px; margin-bottom: 6px;">${job.school}</div>
                                <div style="color: #495057; font-size: 14px; line-height: 1.5; margin-bottom: 8px;">
                                    ${isContinued ? '<em>Continued from previous day</em>' : job.details}
                                </div>
                                ${job.partsLocation ? `<div style="color: #e65100; font-size: 13px; margin-bottom: 4px;"><strong>Parts:</strong> ${job.partsLocation}</div>` : ''}
                                ${job.notes ? `<div style="color: #6c757d; font-size: 12px;">${job.notes}</div>` : ''}
                                ${job.confirmation === 'XX' ? '<span class="badge badge-success" style="margin-top: 8px;">Confirmed</span>' : job.confirmation === 'X' ? '<span class="badge badge-warning" style="margin-top: 8px;">Confirmation Pending</span>' : ''}
                            </div>
                        `;
                    }
                });

                html += `
                        </div>
                    </div>
                `;
            }

            if (!html) {
                html = `
                    <div class="card">
                        <div class="card-body" style="text-align: center; padding: 40px; color: #6c757d;">
                            <div style="font-size: 48px; margin-bottom: 16px;">üìÖ</div>
                            <p>No jobs scheduled for you this week.</p>
                        </div>
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        function prevMyJobsWeek() {
            myJobsWeekOffset--;
            loadMyJobs();
        }

        function nextMyJobsWeek() {
            myJobsWeekOffset++;
            loadMyJobs();
        }

        // ==========================================
        // TEAM SCHEDULE (Field Staff Read-Only)
        // ==========================================

        function loadTeamSchedule() {
            initializeSampleScheduleData();
            // Set offset to show sample data week
            const sampleDate = new Date('2025-02-03');
            const currentMonday = getWeekStart(0);
            teamScheduleWeekOffset = Math.round((sampleDate - currentMonday) / (7 * 24 * 60 * 60 * 1000));
            const label = document.getElementById('teamWeekLabel');
            label.textContent = getWeekLabel(teamScheduleWeekOffset);
            renderTeamScheduleGrid();
        }

        function renderTeamScheduleGrid() {
            const container = document.getElementById('teamScheduleGrid');
            const weekStart = getWeekStart(teamScheduleWeekOffset);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const activeData = currentTeamTerritory === 'original' ? scheduleDataOriginal : scheduleDataSouthern;
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];

            let html = '<table class="schedule-table">';
            html += '<thead><tr><th class="col-school">School / Location</th><th>Job Details</th><th class="col-tech">Tech(s)</th><th class="col-parts">Parts</th></tr></thead>';
            html += '<tbody>';

            for (let i = 0; i < 5; i++) {
                const dayDate = new Date(weekStart);
                dayDate.setDate(weekStart.getDate() + i);
                const dateKey = formatDateKey(dayDate);
                const isToday = dayDate.getTime() === today.getTime();
                const dayJobs = activeData[dateKey] || [];
                const dayLabel = days[i] + ' ' + (dayDate.getMonth() + 1) + '/' + dayDate.getDate();

                html += '<tr class="schedule-day-row ' + (isToday ? 'schedule-today-row' : '') + '">';
                html += '<td colspan="4">' + dayLabel + '</td>';
                html += '</tr>';

                if (dayJobs.length === 0) {
                    if (i === 4) {
                        html += '<tr><td colspan="4" style="padding: 14px; text-align: center; color: #adb5bd; font-style: italic;">Floating day</td></tr>';
                    } else {
                        html += '<tr><td colspan="4" style="padding: 14px; text-align: center; color: #adb5bd;">No jobs scheduled</td></tr>';
                    }
                } else {
                    dayJobs.forEach(function(job) {
                        var isNote = job.type === 'note';
                        var isContinued = job.type === 'continued';
                        var isPink = job.isPink === true;

                        var formattedDetails = job.details || '';
                        formattedDetails = formattedDetails.replace(/\*([^*]+)\*/g, '<span style="color: #bf360c; font-weight: 600; background: #fff3e0; padding: 1px 5px; border-radius: 3px;">$1</span>');

                        if (isNote) {
                            html += '<tr class="schedule-note-row">';
                            html += '<td colspan="4">' + formattedDetails + (job.tech ? ' &mdash; ' + job.tech : '') + '</td>';
                            html += '</tr>';
                        } else {
                            var rowClass = '';
                            if (isPink) rowClass = 'schedule-pink-row';
                            else if (isContinued) rowClass = 'schedule-continued-row';

                            html += '<tr class="' + rowClass + '">';
                            html += '<td style="font-weight: 600;">' + job.school + '</td>';
                            html += '<td>' + (isContinued ? '<em style="color: #1565c0;">Continued</em>' : formattedDetails) + '</td>';
                            html += '<td>' + (job.tech || '') + '</td>';
                            html += '<td style="color: #e65100; font-weight: 500;">' + (job.partsLocation || '') + '</td>';
                            html += '</tr>';
                        }
                    });
                }
            }

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function switchTeamTerritory(territory) {
            currentTeamTerritory = territory;
            document.getElementById('teamOriginalTab').classList.toggle('active', territory === 'original');
            document.getElementById('teamSouthernTab').classList.toggle('active', territory === 'southern');
            renderTeamScheduleGrid();
        }

        function prevTeamWeek() {
            teamScheduleWeekOffset--;
            loadTeamSchedule();
        }

        function nextTeamWeek() {
            teamScheduleWeekOffset++;
            loadTeamSchedule();
        }

        // ========== ADMIN: EMPLOYEES ==========

        var EMPLOYEES = JSON.parse(localStorage.getItem('employees') || 'null') || [
            { id: 'emp1', firstName: 'Danny', lastName: 'Mendl', role: 'Inspector', email: 'danny@bleachers.com', phone: '(615) 555-0101', territory: 'Original' },
            { id: 'emp2', firstName: 'Jon', lastName: 'Roberts', role: 'Technician', email: 'jon@bleachers.com', phone: '(615) 555-0102', territory: 'Original' },
            { id: 'emp3', firstName: 'Floyd', lastName: 'Davis', role: 'Technician', email: 'floyd@bleachers.com', phone: '(615) 555-0103', territory: 'Original' },
            { id: 'emp4', firstName: 'Alex', lastName: 'Wiker', role: 'Technician', email: 'alex@bleachers.com', phone: '(615) 555-0104', territory: 'Original' },
            { id: 'emp5', firstName: 'Blake', lastName: 'Turner', role: 'Technician', email: 'blake@bleachers.com', phone: '(615) 555-0105', territory: 'Both' },
            { id: 'emp6', firstName: 'Troy', lastName: 'Martinez', role: 'Technician', email: 'troy@bleachers.com', phone: '(615) 555-0106', territory: 'Original' },
            { id: 'emp7', firstName: 'Sam', lastName: 'Cooper', role: 'Technician', email: 'sam@bleachers.com', phone: '(615) 555-0107', territory: 'Southern' },
            { id: 'emp8', firstName: 'Kat', lastName: 'Phillips', role: 'Office', email: 'kat@bleachers.com', phone: '(615) 555-0201', territory: 'Both' },
            { id: 'emp9', firstName: 'Charles', lastName: 'Reed', role: 'Office', email: 'charles@bleachers.com', phone: '(615) 555-0202', territory: 'Both' },
            { id: 'emp10', firstName: 'Bea', lastName: 'Santos', role: 'Office', email: 'bea@bleachers.com', phone: '(615) 555-0203', territory: 'Both' },
            { id: 'emp11', firstName: 'Lisa', lastName: 'Grant', role: 'Office', email: 'lisa@bleachers.com', phone: '(615) 555-0204', territory: 'Both' },
            { id: 'emp12', firstName: 'Samantha', lastName: 'Brooks', role: 'Office', email: 'samantha@bleachers.com', phone: '(615) 555-0205', territory: 'Both' },
            { id: 'emp13', firstName: 'Story', lastName: 'Nelson', role: 'Office', email: 'story@bleachers.com', phone: '(615) 555-0206', territory: 'Both' },
            { id: 'emp14', firstName: 'Christian', lastName: 'B', role: 'Admin', email: 'admin@bleachers.com', phone: '(615) 555-0001', territory: 'Both' }
        ];

        var editingEmployeeId = null;

        function saveEmployeesData() {
            localStorage.setItem('employees', JSON.stringify(EMPLOYEES));
        }

        function loadEmployees() {
            var tbody = document.getElementById('employeesTableBody');
            var roleColors = { Admin: '#dc3545', Office: '#0066cc', Inspector: '#28a745', Technician: '#6f42c1' };
            var html = '';
            EMPLOYEES.forEach(function(emp) {
                var color = roleColors[emp.role] || '#6c757d';
                html += '<tr style="border-bottom: 1px solid #f0f2f5;">' +
                    '<td style="padding: 12px 16px; font-weight: 600;">' + emp.firstName + ' ' + emp.lastName + '</td>' +
                    '<td style="padding: 12px 16px;"><span style="background:' + color + '15; color:' + color + '; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600;">' + emp.role + '</span></td>' +
                    '<td style="padding: 12px 16px; color: #495057;">' + (emp.email || '‚Äî') + '</td>' +
                    '<td style="padding: 12px 16px; color: #495057;">' + (emp.phone || '‚Äî') + '</td>' +
                    '<td style="padding: 12px 16px; color: #495057;">' + emp.territory + '</td>' +
                    '<td style="padding: 12px 16px; text-align: center;">' +
                        '<button class="btn btn-sm" onclick="editEmployee(\'' + emp.id + '\')" style="padding: 4px 10px; font-size: 12px; margin-right: 4px;">Edit</button>' +
                        '<button class="btn btn-sm" onclick="deleteEmployee(\'' + emp.id + '\')" style="padding: 4px 10px; font-size: 12px; color: #dc3545;">Delete</button>' +
                    '</td></tr>';
            });
            tbody.innerHTML = html;
        }

        function showAddEmployeeModal() {
            editingEmployeeId = null;
            document.getElementById('employeeModalTitle').textContent = 'Add Employee';
            document.getElementById('empFirstName').value = '';
            document.getElementById('empLastName').value = '';
            document.getElementById('empRole').value = 'Technician';
            document.getElementById('empEmail').value = '';
            document.getElementById('empPhone').value = '';
            document.getElementById('empTerritory').value = 'Original';
            var modal = document.getElementById('employeeModal');
            modal.classList.remove('hidden');
            modal.style.display = 'flex';
        }

        function editEmployee(id) {
            var emp = EMPLOYEES.find(function(e) { return e.id === id; });
            if (!emp) return;
            editingEmployeeId = id;
            document.getElementById('employeeModalTitle').textContent = 'Edit Employee';
            document.getElementById('empFirstName').value = emp.firstName;
            document.getElementById('empLastName').value = emp.lastName;
            document.getElementById('empRole').value = emp.role;
            document.getElementById('empEmail').value = emp.email || '';
            document.getElementById('empPhone').value = emp.phone || '';
            document.getElementById('empTerritory').value = emp.territory || 'Original';
            var modal = document.getElementById('employeeModal');
            modal.classList.remove('hidden');
            modal.style.display = 'flex';
        }

        function saveEmployee() {
            var first = document.getElementById('empFirstName').value.trim();
            var last = document.getElementById('empLastName').value.trim();
            if (!first || !last) { alert('First and last name are required.'); return; }
            var data = {
                firstName: first,
                lastName: last,
                role: document.getElementById('empRole').value,
                email: document.getElementById('empEmail').value.trim(),
                phone: document.getElementById('empPhone').value.trim(),
                territory: document.getElementById('empTerritory').value
            };
            if (editingEmployeeId) {
                var idx = EMPLOYEES.findIndex(function(e) { return e.id === editingEmployeeId; });
                if (idx !== -1) { data.id = editingEmployeeId; EMPLOYEES[idx] = data; }
            } else {
                data.id = 'emp' + Date.now();
                EMPLOYEES.push(data);
            }
            saveEmployeesData();
            closeEmployeeModal();
            loadEmployees();
        }

        function deleteEmployee(id) {
            if (!confirm('Delete this employee?')) return;
            EMPLOYEES = EMPLOYEES.filter(function(e) { return e.id !== id; });
            saveEmployeesData();
            loadEmployees();
        }

        function closeEmployeeModal() {
            var modal = document.getElementById('employeeModal');
            modal.classList.add('hidden');
            modal.style.display = 'none';
        }

        // ========== ADMIN: DATA MANAGEMENT ==========

        var ADMIN_PARTS = JSON.parse(localStorage.getItem('adminParts') || 'null') || [
            { id: 'p1', partNum: '302-1000', name: 'Gear Motor Assembly', category: 'Power & Electrical', vendor: 'Hussey', price: 1245.00 },
            { id: 'p2', partNum: '150-2040', name: 'Deck Board - 10ft', category: 'Lumber & Decking', vendor: 'Hussey', price: 89.50 },
            { id: 'p3', partNum: '205-3100', name: 'Frame Mounting Bracket', category: 'Frames & Supports', vendor: 'Hussey', price: 17.85 },
            { id: 'p4', partNum: '400-1010', name: 'Wheel Assembly - 6in', category: 'Wheels & Bearings', vendor: 'Hussey', price: 134.00 },
            { id: 'p5', partNum: '110-5050', name: 'Seat Slat - Standard', category: 'Seating', vendor: 'Hussey', price: 42.75 },
            { id: 'p6', partNum: '110-5055', name: 'Seat Slat - Wide', category: 'Seating', vendor: 'Hussey', price: 56.25 },
            { id: 'p7', partNum: '302-1050', name: 'Motor Controller Board', category: 'Power & Electrical', vendor: 'Hussey', price: 387.00 },
            { id: 'p8', partNum: '250-1010', name: 'Aisle Rail - 42in', category: 'Rails & Steps', vendor: 'Hussey', price: 165.00 },
            { id: 'p9', partNum: 'DRP-8010', name: 'Basketball Goal Winch', category: 'Power & Electrical', vendor: 'Draper', price: 892.00 },
            { id: 'p10', partNum: 'DRP-8020', name: 'Backstop Pad - 6ft', category: 'Other', vendor: 'Draper', price: 225.00 },
            { id: 'p11', partNum: 'DRP-8030', name: 'Goal Height Adjuster', category: 'Hardware', vendor: 'Draper', price: 145.50 },
            { id: 'p12', partNum: 'IRW-3001', name: 'Irwin Frame Support Arm', category: 'Frames & Supports', vendor: 'Irwin', price: 78.00 },
            { id: 'p13', partNum: 'PKR-100', name: 'Porter Backboard - Glass', category: 'Other', vendor: 'Porter', price: 1850.00 },
            { id: 'p14', partNum: 'JP-2200', name: 'Jaypro Net System', category: 'Other', vendor: 'Jaypro', price: 340.00 },
            { id: 'p15', partNum: 'DB-500', name: 'Duckbill Anchor Kit', category: 'Hardware', vendor: 'Duckbill', price: 62.00 }
        ];

        var VENDORS = JSON.parse(localStorage.getItem('vendors') || 'null') || [
            { id: 'v1', name: 'Hussey Seating Co', contact: 'Regional Rep', phone: '(207) 676-2271', email: 'sales@husseyseating.com', tier: '1', notes: 'Exclusive territory: KY, TN, AL, FL. ~70% of business. CSV pricing available.' },
            { id: 'v2', name: 'Draper', contact: 'Account Manager', phone: '(765) 987-7999', email: 'sales@draperinc.com', tier: '1', notes: 'Partnership deal for basketball equipment. CSV pricing available.' },
            { id: 'v3', name: 'Interkal', contact: '', phone: '', email: '', tier: '2', notes: 'Competitor dealer - bleachers' },
            { id: 'v4', name: 'Porter', contact: '', phone: '', email: '', tier: '2', notes: 'Basketball equipment' },
            { id: 'v5', name: 'Jaypro', contact: '', phone: '', email: '', tier: '2', notes: 'Sports equipment' },
            { id: 'v6', name: 'Irwin', contact: '', phone: '', email: '', tier: '2', notes: 'Seating' },
            { id: 'v7', name: 'Kodiak', contact: '', phone: '', email: '', tier: '2', notes: 'Seating' },
            { id: 'v8', name: 'Duckbill', contact: '', phone: '', email: '', tier: '3', notes: 'Anchor systems' },
            { id: 'v9', name: 'APDC', contact: '', phone: '', email: '', tier: '3', notes: 'Specialty parts' }
        ];

        var editingPartId = null;
        var editingVendorId = null;
        var csvImportData = [];

        function saveAdminParts() { localStorage.setItem('adminParts', JSON.stringify(ADMIN_PARTS)); }
        function saveVendors() { localStorage.setItem('vendors', JSON.stringify(VENDORS)); }

        function loadDataManagement() {
            switchDataTab('parts');
        }

        function switchDataTab(tab) {
            document.getElementById('dmPartsTab').classList.add('hidden');
            document.getElementById('dmImportTab').classList.add('hidden');
            document.getElementById('dmVendorsTab').classList.add('hidden');
            document.getElementById('dmTabParts').style.borderBottomColor = 'transparent';
            document.getElementById('dmTabParts').style.color = '#6c757d';
            document.getElementById('dmTabImport').style.borderBottomColor = 'transparent';
            document.getElementById('dmTabImport').style.color = '#6c757d';
            document.getElementById('dmTabVendors').style.borderBottomColor = 'transparent';
            document.getElementById('dmTabVendors').style.color = '#6c757d';

            if (tab === 'parts') {
                document.getElementById('dmPartsTab').classList.remove('hidden');
                document.getElementById('dmTabParts').style.borderBottomColor = '#4f46e5';
                document.getElementById('dmTabParts').style.color = '#4f46e5';
                loadAdminParts();
            } else if (tab === 'import') {
                document.getElementById('dmImportTab').classList.remove('hidden');
                document.getElementById('dmTabImport').style.borderBottomColor = '#4f46e5';
                document.getElementById('dmTabImport').style.color = '#4f46e5';
            } else if (tab === 'vendors') {
                document.getElementById('dmVendorsTab').classList.remove('hidden');
                document.getElementById('dmTabVendors').style.borderBottomColor = '#4f46e5';
                document.getElementById('dmTabVendors').style.color = '#4f46e5';
                loadVendors();
            }
        }

        // Parts Catalog
        function loadAdminParts() {
            // Populate category filter
            var cats = {};
            ADMIN_PARTS.forEach(function(p) { if (p.category) cats[p.category] = true; });
            var catSelect = document.getElementById('dmPartsCategoryFilter');
            var currentVal = catSelect.value;
            catSelect.innerHTML = '<option value="">All Categories</option>';
            Object.keys(cats).sort().forEach(function(c) {
                catSelect.innerHTML += '<option value="' + c + '">' + c + '</option>';
            });
            catSelect.value = currentVal;
            filterAdminParts();
        }

        function filterAdminParts() {
            var search = (document.getElementById('dmPartsSearch').value || '').toLowerCase();
            var cat = document.getElementById('dmPartsCategoryFilter').value;
            var filtered = ADMIN_PARTS.filter(function(p) {
                var matchSearch = !search || (p.partNum || '').toLowerCase().indexOf(search) !== -1 || (p.name || '').toLowerCase().indexOf(search) !== -1 || (p.category || '').toLowerCase().indexOf(search) !== -1 || (p.vendor || '').toLowerCase().indexOf(search) !== -1;
                var matchCat = !cat || p.category === cat;
                return matchSearch && matchCat;
            });
            var tbody = document.getElementById('dmPartsTableBody');
            var html = '';
            filtered.slice(0, 100).forEach(function(p) {
                html += '<tr style="border-bottom: 1px solid #f0f2f5;">' +
                    '<td style="padding: 10px 12px; font-family: monospace; font-size: 12px;">' + (p.partNum || '‚Äî') + '</td>' +
                    '<td style="padding: 10px 12px; font-weight: 500;">' + p.name + '</td>' +
                    '<td style="padding: 10px 12px; color: #6c757d;">' + (p.category || '‚Äî') + '</td>' +
                    '<td style="padding: 10px 12px; color: #6c757d;">' + p.vendor + '</td>' +
                    '<td style="padding: 10px 12px; text-align: right; font-weight: 600;">$' + (p.price || 0).toFixed(2) + '</td>' +
                    '<td style="padding: 10px 12px; text-align: center;">' +
                        '<button class="btn btn-sm" onclick="editPart(\'' + p.id + '\')" style="padding: 4px 10px; font-size: 12px; margin-right: 4px;">Edit</button>' +
                        '<button class="btn btn-sm" onclick="deletePart(\'' + p.id + '\')" style="padding: 4px 10px; font-size: 12px; color: #dc3545;">Delete</button>' +
                    '</td></tr>';
            });
            tbody.innerHTML = html || '<tr><td colspan="6" style="padding: 24px; text-align: center; color: #6c757d;">No parts found</td></tr>';
            document.getElementById('dmPartsCount').textContent = 'Showing ' + Math.min(filtered.length, 100) + ' of ' + filtered.length + ' parts (' + ADMIN_PARTS.length + ' total)';
        }

        function showAddPartModal() {
            editingPartId = null;
            document.getElementById('partModalTitle').textContent = 'Add Part';
            document.getElementById('partNumInput').value = '';
            document.getElementById('partNameInput').value = '';
            document.getElementById('partCategoryInput').value = '';
            document.getElementById('partVendorInput').value = 'Hussey';
            document.getElementById('partPriceInput').value = '';
            var modal = document.getElementById('partModal');
            modal.classList.remove('hidden');
            modal.style.display = 'flex';
        }

        function editPart(id) {
            var part = ADMIN_PARTS.find(function(p) { return p.id === id; });
            if (!part) return;
            editingPartId = id;
            document.getElementById('partModalTitle').textContent = 'Edit Part';
            document.getElementById('partNumInput').value = part.partNum || '';
            document.getElementById('partNameInput').value = part.name || '';
            document.getElementById('partCategoryInput').value = part.category || '';
            document.getElementById('partVendorInput').value = part.vendor || 'Hussey';
            document.getElementById('partPriceInput').value = part.price || '';
            var modal = document.getElementById('partModal');
            modal.classList.remove('hidden');
            modal.style.display = 'flex';
        }

        function savePart() {
            var name = document.getElementById('partNameInput').value.trim();
            if (!name) { alert('Part name is required.'); return; }
            var data = {
                partNum: document.getElementById('partNumInput').value.trim(),
                name: name,
                category: document.getElementById('partCategoryInput').value,
                vendor: document.getElementById('partVendorInput').value,
                price: parseFloat(document.getElementById('partPriceInput').value) || 0
            };
            if (editingPartId) {
                var idx = ADMIN_PARTS.findIndex(function(p) { return p.id === editingPartId; });
                if (idx !== -1) { data.id = editingPartId; ADMIN_PARTS[idx] = data; }
            } else {
                data.id = 'p' + Date.now();
                ADMIN_PARTS.push(data);
            }
            saveAdminParts();
            closePartModal();
            loadAdminParts();
        }

        function deletePart(id) {
            if (!confirm('Delete this part?')) return;
            ADMIN_PARTS = ADMIN_PARTS.filter(function(p) { return p.id !== id; });
            saveAdminParts();
            filterAdminParts();
        }

        function closePartModal() {
            var modal = document.getElementById('partModal');
            modal.classList.add('hidden');
            modal.style.display = 'none';
        }

        // CSV Import
        function handleCsvDrop(event) {
            var file = event.dataTransfer.files[0];
            if (file) handleCsvFile(file);
        }

        function handleCsvFile(file) {
            if (!file || !file.name.endsWith('.csv')) { alert('Please select a CSV file.'); return; }
            var vendor = document.getElementById('importVendor').value;
            if (!vendor) { alert('Please select a vendor first.'); return; }
            var reader = new FileReader();
            reader.onload = function(e) {
                var text = e.target.result;
                var lines = text.split('\n');
                if (lines.length < 2) { alert('CSV file appears empty.'); return; }
                var headers = lines[0].split(',').map(function(h) { return h.trim().toLowerCase().replace(/"/g, ''); });
                var partNumCol = headers.findIndex(function(h) { return h.indexOf('part') !== -1 && h.indexOf('num') !== -1 || h === 'sku' || h === 'item' || h === 'part #' || h === 'part number'; });
                var priceCol = headers.findIndex(function(h) { return h.indexOf('price') !== -1 || h.indexOf('cost') !== -1; });
                var nameCol = headers.findIndex(function(h) { return h.indexOf('name') !== -1 || h.indexOf('description') !== -1 || h.indexOf('desc') !== -1 || h.indexOf('product') !== -1; });
                if (partNumCol === -1 || priceCol === -1) { alert('CSV must have Part Number and Price columns. Found headers: ' + headers.join(', ')); return; }

                csvImportData = [];
                for (var i = 1; i < lines.length; i++) {
                    if (!lines[i].trim()) continue;
                    var cols = lines[i].split(',').map(function(c) { return c.trim().replace(/"/g, ''); });
                    var partNum = cols[partNumCol] || '';
                    var newPrice = parseFloat(cols[priceCol]) || 0;
                    var name = nameCol !== -1 ? (cols[nameCol] || '') : '';
                    if (!partNum || !newPrice) continue;
                    var existing = ADMIN_PARTS.find(function(p) { return p.partNum === partNum; });
                    csvImportData.push({
                        partNum: partNum,
                        name: name || (existing ? existing.name : ''),
                        currentPrice: existing ? existing.price : null,
                        newPrice: newPrice,
                        isNew: !existing,
                        vendor: vendor
                    });
                }

                // Show preview
                var tbody = document.getElementById('csvPreviewBody');
                var html = '';
                csvImportData.forEach(function(row) {
                    var changeHtml = '';
                    if (row.isNew) {
                        changeHtml = '<span style="color: #28a745; font-weight: 600;">NEW</span>';
                    } else {
                        var diff = row.newPrice - row.currentPrice;
                        if (Math.abs(diff) < 0.01) {
                            changeHtml = '<span style="color: #6c757d;">No change</span>';
                        } else {
                            var pct = ((diff / row.currentPrice) * 100).toFixed(1);
                            var color = diff > 0 ? '#dc3545' : '#28a745';
                            changeHtml = '<span style="color:' + color + '; font-weight: 600;">' + (diff > 0 ? '+' : '') + '$' + diff.toFixed(2) + ' (' + (diff > 0 ? '+' : '') + pct + '%)</span>';
                        }
                    }
                    html += '<tr style="border-bottom: 1px solid #f0f2f5;">' +
                        '<td style="padding: 8px 12px; font-family: monospace; font-size: 12px;">' + row.partNum + '</td>' +
                        '<td style="padding: 8px 12px;">' + row.name + '</td>' +
                        '<td style="padding: 8px 12px; text-align: right;">' + (row.currentPrice !== null ? '$' + row.currentPrice.toFixed(2) : '‚Äî') + '</td>' +
                        '<td style="padding: 8px 12px; text-align: right; font-weight: 600;">$' + row.newPrice.toFixed(2) + '</td>' +
                        '<td style="padding: 8px 12px; text-align: right;">' + changeHtml + '</td>' +
                    '</tr>';
                });
                tbody.innerHTML = html;
                var newCount = csvImportData.filter(function(r) { return r.isNew; }).length;
                var updateCount = csvImportData.filter(function(r) { return !r.isNew; }).length;
                document.getElementById('csvPreviewCount').textContent = updateCount + ' updates, ' + newCount + ' new parts';
                document.getElementById('csvPreview').classList.remove('hidden');
            };
            reader.readAsText(file);
        }

        function applyCsvImport() {
            var vendor = document.getElementById('importVendor').value;
            var updated = 0;
            var added = 0;
            csvImportData.forEach(function(row) {
                var idx = ADMIN_PARTS.findIndex(function(p) { return p.partNum === row.partNum; });
                if (idx !== -1) {
                    ADMIN_PARTS[idx].price = row.newPrice;
                    updated++;
                } else {
                    ADMIN_PARTS.push({
                        id: 'p' + Date.now() + Math.random().toString(36).substr(2, 4),
                        partNum: row.partNum,
                        name: row.name,
                        category: '',
                        vendor: vendor,
                        price: row.newPrice
                    });
                    added++;
                }
            });
            saveAdminParts();

            // Add to import history
            var historyBody = document.getElementById('importHistoryBody');
            var today = new Date();
            var dateStr = today.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
            var fileName = document.getElementById('csvFileInput').files[0] ? document.getElementById('csvFileInput').files[0].name : 'manual-import.csv';
            historyBody.innerHTML = '<tr style="border-bottom: 1px solid #f0f2f5;">' +
                '<td style="padding: 10px 12px;">' + dateStr + '</td>' +
                '<td style="padding: 10px 12px;">' + vendor + '</td>' +
                '<td style="padding: 10px 12px;">' + fileName + '</td>' +
                '<td style="padding: 10px 12px; text-align: right;">' + (updated + added).toLocaleString() + '</td>' +
                '<td style="padding: 10px 12px;">Admin</td>' +
            '</tr>' + historyBody.innerHTML;

            alert('Import complete: ' + updated + ' parts updated, ' + added + ' new parts added.');
            cancelCsvImport();
        }

        function cancelCsvImport() {
            document.getElementById('csvPreview').classList.add('hidden');
            document.getElementById('csvFileInput').value = '';
            csvImportData = [];
        }

        // Vendors
        function loadVendors() {
            var list = document.getElementById('vendorsList');
            var tierLabels = { '1': 'Tier 1 ‚Äî Primary Partner', '2': 'Tier 2 ‚Äî Secondary', '3': 'Tier 3 ‚Äî Occasional/Specialty' };
            var tierColors = { '1': '#28a745', '2': '#0066cc', '3': '#6c757d' };
            var html = '';
            ['1', '2', '3'].forEach(function(tier) {
                var tierVendors = VENDORS.filter(function(v) { return v.tier === tier; });
                if (tierVendors.length === 0) return;
                html += '<h3 style="font-size: 14px; font-weight: 700; color: ' + tierColors[tier] + '; margin-bottom: 12px; margin-top: ' + (tier === '1' ? '0' : '24px') + ';">' + tierLabels[tier] + '</h3>';
                tierVendors.forEach(function(v) {
                    var partCount = ADMIN_PARTS.filter(function(p) { return p.vendor === v.name.split(' ')[0]; }).length;
                    html += '<div class="card" style="margin-bottom: 12px;">' +
                        '<div class="card-body" style="display: flex; justify-content: space-between; align-items: center;">' +
                            '<div>' +
                                '<h4 style="font-size: 16px; font-weight: 700; margin-bottom: 4px;">' + v.name + '</h4>' +
                                '<div style="font-size: 13px; color: #6c757d;">' +
                                    (v.contact ? v.contact + ' ‚Ä¢ ' : '') +
                                    (v.phone ? v.phone + ' ‚Ä¢ ' : '') +
                                    (v.email ? v.email : '') +
                                '</div>' +
                                (v.notes ? '<div style="font-size: 12px; color: #495057; margin-top: 4px;">' + v.notes + '</div>' : '') +
                                '<div style="font-size: 12px; color: #6c757d; margin-top: 4px;">' + partCount + ' parts in catalog</div>' +
                            '</div>' +
                            '<div>' +
                                '<button class="btn btn-sm" onclick="editVendor(\'' + v.id + '\')" style="padding: 6px 14px; font-size: 12px; margin-right: 4px;">Edit</button>' +
                                '<button class="btn btn-sm" onclick="deleteVendor(\'' + v.id + '\')" style="padding: 6px 14px; font-size: 12px; color: #dc3545;">Delete</button>' +
                            '</div>' +
                        '</div></div>';
                });
            });
            list.innerHTML = html;
        }

        function showAddVendorModal() {
            editingVendorId = null;
            document.getElementById('vendorModalTitle').textContent = 'Add Vendor';
            document.getElementById('vendorNameInput').value = '';
            document.getElementById('vendorContactInput').value = '';
            document.getElementById('vendorPhoneInput').value = '';
            document.getElementById('vendorEmailInput').value = '';
            document.getElementById('vendorTierInput').value = '2';
            document.getElementById('vendorNotesInput').value = '';
            var modal = document.getElementById('vendorModal');
            modal.classList.remove('hidden');
            modal.style.display = 'flex';
        }

        function editVendor(id) {
            var v = VENDORS.find(function(x) { return x.id === id; });
            if (!v) return;
            editingVendorId = id;
            document.getElementById('vendorModalTitle').textContent = 'Edit Vendor';
            document.getElementById('vendorNameInput').value = v.name;
            document.getElementById('vendorContactInput').value = v.contact || '';
            document.getElementById('vendorPhoneInput').value = v.phone || '';
            document.getElementById('vendorEmailInput').value = v.email || '';
            document.getElementById('vendorTierInput').value = v.tier || '2';
            document.getElementById('vendorNotesInput').value = v.notes || '';
            var modal = document.getElementById('vendorModal');
            modal.classList.remove('hidden');
            modal.style.display = 'flex';
        }

        function saveVendor() {
            var name = document.getElementById('vendorNameInput').value.trim();
            if (!name) { alert('Vendor name is required.'); return; }
            var data = {
                name: name,
                contact: document.getElementById('vendorContactInput').value.trim(),
                phone: document.getElementById('vendorPhoneInput').value.trim(),
                email: document.getElementById('vendorEmailInput').value.trim(),
                tier: document.getElementById('vendorTierInput').value,
                notes: document.getElementById('vendorNotesInput').value.trim()
            };
            if (editingVendorId) {
                var idx = VENDORS.findIndex(function(x) { return x.id === editingVendorId; });
                if (idx !== -1) { data.id = editingVendorId; VENDORS[idx] = data; }
            } else {
                data.id = 'v' + Date.now();
                VENDORS.push(data);
            }
            saveVendors();
            closeVendorModal();
            loadVendors();
        }

        function deleteVendor(id) {
            if (!confirm('Delete this vendor?')) return;
            VENDORS = VENDORS.filter(function(x) { return x.id !== id; });
            saveVendors();
            loadVendors();
        }

        function closeVendorModal() {
            var modal = document.getElementById('vendorModal');
            modal.classList.add('hidden');
            modal.style.display = 'none';
        }

        // Initialize on load
        init();
    </script>
</body>
</html>
